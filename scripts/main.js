'use strict';window.DOMHandler=class{constructor(d,a){this._iRuntime=d;this._componentId=a;this._hasTickCallback=!1;this._tickCallback=()=>this.Tick()}Attach(){}PostToRuntime(d,a,b,e){this._iRuntime.PostToRuntimeComponent(this._componentId,d,a,b,e)}PostToRuntimeAsync(d,a,b,e){return this._iRuntime.PostToRuntimeComponentAsync(this._componentId,d,a,b,e)}_PostToRuntimeMaybeSync(d,a,b){this._iRuntime.UsesWorker()?this.PostToRuntime(d,a,b):this._iRuntime._GetLocalRuntime()._OnMessageFromDOM({type:"event",
component:this._componentId,handler:d,dispatchOpts:b||null,data:a,responseId:null})}AddRuntimeMessageHandler(d,a){this._iRuntime.AddRuntimeComponentMessageHandler(this._componentId,d,a)}AddRuntimeMessageHandlers(d){for(const [a,b]of d)this.AddRuntimeMessageHandler(a,b)}GetRuntimeInterface(){return this._iRuntime}GetComponentID(){return this._componentId}_StartTicking(){this._hasTickCallback||(this._iRuntime._AddRAFCallback(this._tickCallback),this._hasTickCallback=!0)}_StopTicking(){this._hasTickCallback&&
(this._iRuntime._RemoveRAFCallback(this._tickCallback),this._hasTickCallback=!1)}Tick(){}};
window.RateLimiter=class{constructor(d,a){this._callback=d;this._interval=a;this._timerId=-1;this._lastCallTime=-Infinity;this._timerCallFunc=()=>this._OnTimer();this._canRunImmediate=this._ignoreReset=!1}SetCanRunImmediate(d){this._canRunImmediate=!!d}Call(){if(-1===this._timerId){var d=Date.now(),a=d-this._lastCallTime,b=this._interval;a>=b&&this._canRunImmediate?(this._lastCallTime=d,this._RunCallback()):this._timerId=self.setTimeout(this._timerCallFunc,Math.max(b-a,4))}}_RunCallback(){this._ignoreReset=
!0;this._callback();this._ignoreReset=!1}Reset(){this._ignoreReset||(this._CancelTimer(),this._lastCallTime=Date.now())}_OnTimer(){this._timerId=-1;this._lastCallTime=Date.now();this._RunCallback()}_CancelTimer(){-1!==this._timerId&&(self.clearTimeout(this._timerId),this._timerId=-1)}Release(){this._CancelTimer();this._timerCallFunc=this._callback=null}};"use strict";
window.DOMElementHandler=class extends self.DOMHandler{constructor(d,a){super(d,a);this._elementMap=new Map;this._autoAttach=!0;this.AddRuntimeMessageHandlers([["create",b=>this._OnCreate(b)],["destroy",b=>this._OnDestroy(b)],["set-visible",b=>this._OnSetVisible(b)],["update-position",b=>this._OnUpdatePosition(b)],["update-state",b=>this._OnUpdateState(b)],["focus",b=>this._OnSetFocus(b)],["set-css-style",b=>this._OnSetCssStyle(b)],["set-attribute",b=>this._OnSetAttribute(b)],["remove-attribute",
b=>this._OnRemoveAttribute(b)]]);this.AddDOMElementMessageHandler("get-element",b=>b)}SetAutoAttach(d){this._autoAttach=!!d}AddDOMElementMessageHandler(d,a){this.AddRuntimeMessageHandler(d,b=>{const e=this._elementMap.get(b.elementId);return a(e,b)})}_OnCreate(d){const a=d.elementId,b=this.CreateElement(a,d);this._elementMap.set(a,b);b.style.boxSizing="border-box";d.isVisible||(b.style.display="none");d=this._GetFocusElement(b);d.addEventListener("focus",e=>this._OnFocus(a));d.addEventListener("blur",
e=>this._OnBlur(a));this._autoAttach&&document.body.appendChild(b)}CreateElement(d,a){throw Error("required override");}DestroyElement(d){}_OnDestroy(d){d=d.elementId;const a=this._elementMap.get(d);this.DestroyElement(a);this._autoAttach&&a.parentElement.removeChild(a);this._elementMap.delete(d)}PostToRuntimeElement(d,a,b){b||(b={});b.elementId=a;this.PostToRuntime(d,b)}_PostToRuntimeElementMaybeSync(d,a,b){b||(b={});b.elementId=a;this._PostToRuntimeMaybeSync(d,b)}_OnSetVisible(d){this._autoAttach&&
(this._elementMap.get(d.elementId).style.display=d.isVisible?"":"none")}_OnUpdatePosition(d){if(this._autoAttach){var a=this._elementMap.get(d.elementId);a.style.left=d.left+"px";a.style.top=d.top+"px";a.style.width=d.width+"px";a.style.height=d.height+"px";d=d.fontSize;null!==d&&(a.style.fontSize=d+"em")}}_OnUpdateState(d){const a=this._elementMap.get(d.elementId);this.UpdateState(a,d)}UpdateState(d,a){throw Error("required override");}_GetFocusElement(d){return d}_OnFocus(d){this.PostToRuntimeElement("elem-focused",
d)}_OnBlur(d){this.PostToRuntimeElement("elem-blurred",d)}_OnSetFocus(d){const a=this._GetFocusElement(this._elementMap.get(d.elementId));d.focus?a.focus():a.blur()}_OnSetCssStyle(d){this._elementMap.get(d.elementId).style[d.prop]=d.val}_OnSetAttribute(d){this._elementMap.get(d.elementId).setAttribute(d.name,d.val)}_OnRemoveAttribute(d){this._elementMap.get(d.elementId).removeAttribute(d.name)}GetElementById(d){return this._elementMap.get(d)}};"use strict";
{const d=/(iphone|ipod|ipad|macos|macintosh|mac os x)/i.test(navigator.userAgent),a=/android/i.test(navigator.userAgent);let b=0;function e(r){const n=document.createElement("script");n.async=!1;n.type="module";return r.isStringSrc?new Promise(v=>{const A="c3_resolve_"+b;++b;self[A]=v;n.textContent=r.str+`\n\nself["${A}"]();`;document.head.appendChild(n)}):new Promise((v,A)=>{n.onload=v;n.onerror=A;n.src=r;document.head.appendChild(n)})}let k=!1,w=!1;function y(){if(!k){try{new Worker("blob://",{get type(){w=
!0}})}catch(r){}k=!0}return w}let h=new Audio;const m={"audio/webm; codecs=opus":!!h.canPlayType("audio/webm; codecs=opus"),"audio/ogg; codecs=opus":!!h.canPlayType("audio/ogg; codecs=opus"),"audio/webm; codecs=vorbis":!!h.canPlayType("audio/webm; codecs=vorbis"),"audio/ogg; codecs=vorbis":!!h.canPlayType("audio/ogg; codecs=vorbis"),"audio/mp4":!!h.canPlayType("audio/mp4"),"audio/mpeg":!!h.canPlayType("audio/mpeg")};h=null;async function c(r){r=await f(r);return(new TextDecoder("utf-8")).decode(r)}
function f(r){return new Promise((n,v)=>{const A=new FileReader;A.onload=C=>n(C.target.result);A.onerror=C=>v(C);A.readAsArrayBuffer(r)})}const t=[];let z=0;window.RealFile=window.File;const g=[],l=new Map,p=new Map;let u=0;const x=[];self.runOnStartup=function(r){if("function"!==typeof r)throw Error("runOnStartup called without a function");x.push(r)};const B=new Set(["cordova","playable-ad","instant-games"]);function G(r){return B.has(r)}let q=!1;window.RuntimeInterface=class r{constructor(n){this._useWorker=
n.useWorker;this._messageChannelPort=null;this._baseUrl="";this._scriptFolder=n.scriptFolder;this._workerScriptURLs={};this._localRuntime=this._worker=null;this._domHandlers=[];this._jobScheduler=this._canvas=this._runtimeDomHandler=null;this._rafId=-1;this._rafFunc=()=>this._OnRAFCallback();this._rafCallbacks=[];this._exportType=n.exportType;this._isFileProtocol="file"===location.protocol.substr(0,4);!this._useWorker||"undefined"!==typeof OffscreenCanvas&&navigator.userActivation&&y()||(this._useWorker=
!1);if("playable-ad"===this._exportType||"instant-games"===this._exportType)this._useWorker=!1;if("cordova"===this._exportType&&this._useWorker)if(a){const v=/Chrome\/(\d+)/i.exec(navigator.userAgent);v&&90<=parseInt(v[1],10)||(this._useWorker=!1)}else this._useWorker=!1;this._localFileStrings=this._localFileBlobs=null;"html5"!==this._exportType&&"playable-ad"!==this._exportType||!this._isFileProtocol||alert("Exported games won't work until you upload them. (When running on the file: protocol, browsers block many features from working for security reasons.)");
"html5"!==this._exportType||window.isSecureContext||console.warn("[Construct 3] Warning: the browser indicates this is not a secure context. Some features may be unavailable. Use secure (HTTPS) hosting to ensure all features are available.");this.AddRuntimeComponentMessageHandler("runtime","cordova-fetch-local-file",v=>this._OnCordovaFetchLocalFile(v));this.AddRuntimeComponentMessageHandler("runtime","create-job-worker",v=>this._OnCreateJobWorker(v));"cordova"===this._exportType?document.addEventListener("deviceready",
()=>this._Init(n)):this._Init(n)}Release(){this._CancelAnimationFrame();this._messageChannelPort&&(this._messageChannelPort=this._messageChannelPort.onmessage=null);this._worker&&(this._worker.terminate(),this._worker=null);this._localRuntime&&(this._localRuntime.Release(),this._localRuntime=null);this._canvas&&(this._canvas.parentElement.removeChild(this._canvas),this._canvas=null)}GetCanvas(){return this._canvas}GetBaseURL(){return this._baseUrl}UsesWorker(){return this._useWorker}GetExportType(){return this._exportType}IsFileProtocol(){return this._isFileProtocol}GetScriptFolder(){return this._scriptFolder}IsiOSCordova(){return d&&
"cordova"===this._exportType}IsiOSWebView(){const n=navigator.userAgent;return d&&G(this._exportType)||navigator.standalone||/crios\/|fxios\/|edgios\//i.test(n)}IsAndroid(){return a}IsAndroidWebView(){return a&&G(this._exportType)}async _Init(n){"macos-wkwebview"===this._exportType&&this._SendWrapperMessage({type:"ready"});if("playable-ad"===this._exportType){this._localFileBlobs=self.c3_base64files;this._localFileStrings={};await this._ConvertDataUrisToBlobs();for(let A=0,C=n.engineScripts.length;A<
C;++A){var v=n.engineScripts[A].toLowerCase();this._localFileStrings.hasOwnProperty(v)?n.engineScripts[A]={isStringSrc:!0,str:this._localFileStrings[v]}:this._localFileBlobs.hasOwnProperty(v)&&(n.engineScripts[A]=URL.createObjectURL(this._localFileBlobs[v]))}}n.baseUrl?this._baseUrl=n.baseUrl:(v=location.origin,this._baseUrl=("null"===v?"file:///":v)+location.pathname,v=this._baseUrl.lastIndexOf("/"),-1!==v&&(this._baseUrl=this._baseUrl.substr(0,v+1)));n.workerScripts&&(this._workerScriptURLs=n.workerScripts);
v=new MessageChannel;this._messageChannelPort=v.port1;this._messageChannelPort.onmessage=A=>this._OnMessageFromRuntime(A.data);window.c3_addPortMessageHandler&&window.c3_addPortMessageHandler(A=>this._OnMessageFromDebugger(A));this._jobScheduler=new self.JobSchedulerDOM(this);await this._jobScheduler.Init();"object"===typeof window.StatusBar&&window.StatusBar.hide();"object"===typeof window.AndroidFullScreen&&window.AndroidFullScreen.immersiveMode();this._useWorker?await this._InitWorker(n,v.port2):
await this._InitDOM(n,v.port2)}_GetWorkerURL(n){n=this._workerScriptURLs.hasOwnProperty(n)?this._workerScriptURLs[n]:n.endsWith("/workermain.js")&&this._workerScriptURLs.hasOwnProperty("workermain.js")?this._workerScriptURLs["workermain.js"]:"playable-ad"===this._exportType&&this._localFileBlobs.hasOwnProperty(n.toLowerCase())?this._localFileBlobs[n.toLowerCase()]:n;n instanceof Blob&&(n=URL.createObjectURL(n));return n}async CreateWorker(n,v,A){if(n.startsWith("blob:"))return new Worker(n,A);if("cordova"===
this._exportType&&this._isFileProtocol)return n=await this.CordovaFetchLocalFileAsArrayBuffer(A.isC3MainWorker?n:this._scriptFolder+n),n=new Blob([n],{type:"application/javascript"}),new Worker(URL.createObjectURL(n),A);n=new URL(n,v);if(location.origin!==n.origin){n=await fetch(n);if(!n.ok)throw Error("failed to fetch worker script");n=await n.blob();return new Worker(URL.createObjectURL(n),A)}return new Worker(n,A)}_GetWindowInnerWidth(){return Math.max(window.innerWidth,1)}_GetWindowInnerHeight(){return Math.max(window.innerHeight,
1)}_GetCommonRuntimeOptions(n){return{baseUrl:this._baseUrl,windowInnerWidth:this._GetWindowInnerWidth(),windowInnerHeight:this._GetWindowInnerHeight(),devicePixelRatio:window.devicePixelRatio,isFullscreen:r.IsDocumentFullscreen(),projectData:n.projectData,previewImageBlobs:window.cr_previewImageBlobs||this._localFileBlobs,previewProjectFileBlobs:window.cr_previewProjectFileBlobs,previewProjectFileSWUrls:window.cr_previewProjectFiles,swClientId:window.cr_swClientId||"",exportType:n.exportType,isDebug:-1<
self.location.search.indexOf("debug"),ife:!!self.ife,jobScheduler:this._jobScheduler.GetPortData(),supportedAudioFormats:m,opusWasmScriptUrl:window.cr_opusWasmScriptUrl||this._scriptFolder+"opus.wasm.js",opusWasmBinaryUrl:window.cr_opusWasmBinaryUrl||this._scriptFolder+"opus.wasm.wasm",isFileProtocol:this._isFileProtocol,isiOSCordova:this.IsiOSCordova(),isiOSWebView:this.IsiOSWebView(),isFBInstantAvailable:"undefined"!==typeof self.FBInstant}}async _InitWorker(n,v){var A=this._GetWorkerURL(n.workerMainUrl);
this._worker=await this.CreateWorker(A,this._baseUrl,{type:"module",name:"Runtime",isC3MainWorker:!0});this._canvas=document.createElement("canvas");this._canvas.style.display="none";A=this._canvas.transferControlToOffscreen();document.body.appendChild(this._canvas);window.c3canvas=this._canvas;let C=n.workerDependencyScripts||[],E=n.engineScripts;C=await Promise.all(C.map(D=>this._MaybeGetCordovaScriptURL(D)));E=await Promise.all(E.map(D=>this._MaybeGetCordovaScriptURL(D)));if("cordova"===this._exportType)for(let D=
0,F=n.projectScripts.length;D<F;++D){const H=n.projectScripts[D],I=H[0];if(I===n.mainProjectScript||"scriptsInEvents.js"===I||I.endsWith("/scriptsInEvents.js"))H[1]=await this._MaybeGetCordovaScriptURL(I)}this._worker.postMessage(Object.assign(this._GetCommonRuntimeOptions(n),{type:"init-runtime",isInWorker:!0,messagePort:v,canvas:A,workerDependencyScripts:C,engineScripts:E,projectScripts:n.projectScripts,mainProjectScript:n.mainProjectScript,projectScriptsStatus:self.C3_ProjectScriptsStatus}),[v,
A,...this._jobScheduler.GetPortTransferables()]);this._domHandlers=g.map(D=>new D(this));this._FindRuntimeDOMHandler();self.c3_callFunction=(D,F)=>this._runtimeDomHandler._InvokeFunctionFromJS(D,F);"preview"===this._exportType&&(self.goToLastErrorScript=()=>this.PostToRuntimeComponent("runtime","go-to-last-error-script"))}async _InitDOM(n,v){this._canvas=document.createElement("canvas");this._canvas.style.display="none";document.body.appendChild(this._canvas);window.c3canvas=this._canvas;this._domHandlers=
g.map(D=>new D(this));this._FindRuntimeDOMHandler();var A=n.engineScripts.map(D=>"string"===typeof D?(new URL(D,this._baseUrl)).toString():D);Array.isArray(n.workerDependencyScripts)&&A.unshift(...n.workerDependencyScripts);A=await Promise.all(A.map(D=>this._MaybeGetCordovaScriptURL(D)));await Promise.all(A.map(D=>e(D)));A=self.C3_ProjectScriptsStatus;const C=n.mainProjectScript,E=n.projectScripts;for(let [D,F]of E)if(F||(F=D),D===C)try{F=await this._MaybeGetCordovaScriptURL(F),await e(F),"preview"!==
this._exportType||A[D]||this._ReportProjectMainScriptError(D,"main script did not run to completion")}catch(H){this._ReportProjectMainScriptError(D,H)}else if("scriptsInEvents.js"===D||D.endsWith("/scriptsInEvents.js"))F=await this._MaybeGetCordovaScriptURL(F),await e(F);"preview"===this._exportType&&"object"!==typeof self.C3.ScriptsInEvents?(this._RemoveLoadingMessage(),console.error("[C3 runtime] Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax."),alert("Failed to load JavaScript code used in events. Check all your JavaScript code has valid syntax.")):
(n=Object.assign(this._GetCommonRuntimeOptions(n),{isInWorker:!1,messagePort:v,canvas:this._canvas,runOnStartupFunctions:x}),this._OnBeforeCreateRuntime(),this._localRuntime=self.C3_CreateRuntime(n),await self.C3_InitRuntime(this._localRuntime,n))}_ReportProjectMainScriptError(n,v){this._RemoveLoadingMessage();console.error(`[Preview] Failed to load project main script (${n}): `,v);alert(`Failed to load project main script (${n}). Check all your JavaScript code has valid syntax. Press F12 and check the console for error details.`)}_OnBeforeCreateRuntime(){this._RemoveLoadingMessage()}_RemoveLoadingMessage(){const n=
window.cr_previewLoadingElem;n&&(n.parentElement.removeChild(n),window.cr_previewLoadingElem=null)}async _OnCreateJobWorker(n){n=await this._jobScheduler._CreateJobWorker();return{outputPort:n,transferables:[n]}}_GetLocalRuntime(){if(this._useWorker)throw Error("not available in worker mode");return this._localRuntime}PostToRuntimeComponent(n,v,A,C,E){this._messageChannelPort.postMessage({type:"event",component:n,handler:v,dispatchOpts:C||null,data:A,responseId:null},E)}PostToRuntimeComponentAsync(n,
v,A,C,E){const D=u++,F=new Promise((H,I)=>{p.set(D,{resolve:H,reject:I})});this._messageChannelPort.postMessage({type:"event",component:n,handler:v,dispatchOpts:C||null,data:A,responseId:D},E);return F}["_OnMessageFromRuntime"](n){const v=n.type;if("event"===v)return this._OnEventFromRuntime(n);if("result"===v)this._OnResultFromRuntime(n);else if("runtime-ready"===v)this._OnRuntimeReady();else if("alert-error"===v)this._RemoveLoadingMessage(),alert(n.message);else if("creating-runtime"===v)this._OnBeforeCreateRuntime();
else throw Error(`unknown message '${v}'`);}_OnEventFromRuntime(n){const v=n.component,A=n.handler,C=n.data,E=n.responseId;if(n=l.get(v))if(n=n.get(A)){var D=null;try{D=n(C)}catch(F){console.error(`Exception in '${v}' handler '${A}':`,F);null!==E&&this._PostResultToRuntime(E,!1,""+F);return}if(null===E)return D;D&&D.then?D.then(F=>this._PostResultToRuntime(E,!0,F)).catch(F=>{console.error(`Rejection from '${v}' handler '${A}':`,F);this._PostResultToRuntime(E,!1,""+F)}):this._PostResultToRuntime(E,
!0,D)}else console.warn(`[DOM] No handler '${A}' for component '${v}'`);else console.warn(`[DOM] No event handlers for component '${v}'`)}_PostResultToRuntime(n,v,A){let C;A&&A.transferables&&(C=A.transferables);this._messageChannelPort.postMessage({type:"result",responseId:n,isOk:v,result:A},C)}_OnResultFromRuntime(n){const v=n.responseId,A=n.isOk;n=n.result;const C=p.get(v);A?C.resolve(n):C.reject(n);p.delete(v)}AddRuntimeComponentMessageHandler(n,v,A){let C=l.get(n);C||(C=new Map,l.set(n,C));if(C.has(v))throw Error(`[DOM] Component '${n}' already has handler '${v}'`);
C.set(v,A)}static AddDOMHandlerClass(n){if(g.includes(n))throw Error("DOM handler already added");g.push(n)}_FindRuntimeDOMHandler(){for(const n of this._domHandlers)if("runtime"===n.GetComponentID()){this._runtimeDomHandler=n;return}throw Error("cannot find runtime DOM handler");}_OnMessageFromDebugger(n){this.PostToRuntimeComponent("debugger","message",n)}_OnRuntimeReady(){for(const n of this._domHandlers)n.Attach()}static IsDocumentFullscreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||
document.mozFullScreenElement||q)}static _SetWrapperIsFullscreenFlag(n){q=!!n}async GetRemotePreviewStatusInfo(){return await this.PostToRuntimeComponentAsync("runtime","get-remote-preview-status-info")}_AddRAFCallback(n){this._rafCallbacks.push(n);this._RequestAnimationFrame()}_RemoveRAFCallback(n){n=this._rafCallbacks.indexOf(n);if(-1===n)throw Error("invalid callback");this._rafCallbacks.splice(n,1);this._rafCallbacks.length||this._CancelAnimationFrame()}_RequestAnimationFrame(){-1===this._rafId&&
this._rafCallbacks.length&&(this._rafId=requestAnimationFrame(this._rafFunc))}_CancelAnimationFrame(){-1!==this._rafId&&(cancelAnimationFrame(this._rafId),this._rafId=-1)}_OnRAFCallback(){this._rafId=-1;for(const n of this._rafCallbacks)n();this._RequestAnimationFrame()}TryPlayMedia(n){this._runtimeDomHandler.TryPlayMedia(n)}RemovePendingPlay(n){this._runtimeDomHandler.RemovePendingPlay(n)}_PlayPendingMedia(){this._runtimeDomHandler._PlayPendingMedia()}SetSilent(n){this._runtimeDomHandler.SetSilent(n)}IsAudioFormatSupported(n){return!!m[n]}async _WasmDecodeWebMOpus(n){n=
await this.PostToRuntimeComponentAsync("runtime","opus-decode",{arrayBuffer:n},null,[n]);return new Float32Array(n)}IsAbsoluteURL(n){return/^(?:[a-z\-]+:)?\/\//.test(n)||"data:"===n.substr(0,5)||"blob:"===n.substr(0,5)}IsRelativeURL(n){return!this.IsAbsoluteURL(n)}async _MaybeGetCordovaScriptURL(n){return"cordova"===this._exportType&&(n.startsWith("file:")||this._isFileProtocol&&this.IsRelativeURL(n))?(n.startsWith(this._baseUrl)&&(n=n.substr(this._baseUrl.length)),n=await this.CordovaFetchLocalFileAsArrayBuffer(n),
n=new Blob([n],{type:"application/javascript"}),URL.createObjectURL(n)):n}async _OnCordovaFetchLocalFile(n){const v=n.filename;switch(n.as){case "text":return await this.CordovaFetchLocalFileAsText(v);case "buffer":return await this.CordovaFetchLocalFileAsArrayBuffer(v);default:throw Error("unsupported type");}}_GetPermissionAPI(){const n=window.cordova&&window.cordova.plugins&&window.cordova.plugins.permissions;if("object"!==typeof n)throw Error("Permission API is not loaded");return n}_MapPermissionID(n,
v){n=n[v];if("string"!==typeof n)throw Error("Invalid permission name");return n}_HasPermission(n){const v=this._GetPermissionAPI();return new Promise((A,C)=>v.checkPermission(this._MapPermissionID(v,n),E=>A(!!E.hasPermission),C))}_RequestPermission(n){const v=this._GetPermissionAPI();return new Promise((A,C)=>v.requestPermission(this._MapPermissionID(v,n),E=>A(!!E.hasPermission),C))}async RequestPermissions(n){if("cordova"!==this.GetExportType()||this.IsiOSCordova())return!0;for(const v of n)if(!await this._HasPermission(v)&&
!1===await this._RequestPermission(v))return!1;return!0}async RequirePermissions(...n){if(!1===await this.RequestPermissions(n))throw Error("Permission not granted");}CordovaFetchLocalFile(n){const v=window.cordova.file.applicationDirectory+"www/"+n.toLowerCase();return new Promise((A,C)=>{window.resolveLocalFileSystemURL(v,E=>{E.file(A,C)},C)})}async CordovaFetchLocalFileAsText(n){n=await this.CordovaFetchLocalFile(n);return await c(n)}_CordovaMaybeStartNextArrayBufferRead(){if(t.length&&!(8<=z)){z++;
var n=t.shift();this._CordovaDoFetchLocalFileAsAsArrayBuffer(n.filename,n.successCallback,n.errorCallback)}}CordovaFetchLocalFileAsArrayBuffer(n){return new Promise((v,A)=>{t.push({filename:n,successCallback:C=>{z--;this._CordovaMaybeStartNextArrayBufferRead();v(C)},errorCallback:C=>{z--;this._CordovaMaybeStartNextArrayBufferRead();A(C)}});this._CordovaMaybeStartNextArrayBufferRead()})}async _CordovaDoFetchLocalFileAsAsArrayBuffer(n,v,A){try{const C=await this.CordovaFetchLocalFile(n),E=await f(C);
v(E)}catch(C){A(C)}}_SendWrapperMessage(n){if("windows-webview2"===this._exportType)window.chrome.webview.postMessage(JSON.stringify(n));else if("macos-wkwebview"===this._exportType)window.webkit.messageHandlers.C3Wrapper.postMessage(JSON.stringify(n));else throw Error("cannot send wrapper message");}async _ConvertDataUrisToBlobs(){const n=[];for(const [v,A]of Object.entries(this._localFileBlobs))n.push(this._ConvertDataUriToBlobs(v,A));await Promise.all(n)}async _ConvertDataUriToBlobs(n,v){if("object"===
typeof v)this._localFileBlobs[n]=new Blob([v.str],{type:v.type}),this._localFileStrings[n]=v.str;else{let A=await this._FetchDataUri(v);A||(A=this._DataURIToBinaryBlobSync(v));this._localFileBlobs[n]=A}}async _FetchDataUri(n){try{return await (await fetch(n)).blob()}catch(v){return console.warn("Failed to fetch a data: URI. Falling back to a slower workaround. This is probably because the Content Security Policy unnecessarily blocked it. Allow data: URIs in your CSP to avoid this.",v),null}}_DataURIToBinaryBlobSync(n){n=
this._ParseDataURI(n);return this._BinaryStringToBlob(n.data,n.mime_type)}_ParseDataURI(n){var v=n.indexOf(",");if(0>v)throw new URIError("expected comma in data: uri");var A=n.substring(5,v);n=n.substring(v+1);v=A.split(";");A=v[0]||"";const C=v[2];n="base64"===v[1]||"base64"===C?atob(n):decodeURIComponent(n);return{mime_type:A,data:n}}_BinaryStringToBlob(n,v){var A=n.length;let C=A>>2,E=new Uint8Array(A),D=new Uint32Array(E.buffer,0,C),F,H;for(H=F=0;F<C;++F)D[F]=n.charCodeAt(H++)|n.charCodeAt(H++)<<
8|n.charCodeAt(H++)<<16|n.charCodeAt(H++)<<24;for(A&=3;A--;)E[H]=n.charCodeAt(H),++H;return new Blob([E],{type:v})}}}"use strict";
{const d=self.RuntimeInterface;function a(q){return q.sourceCapabilities&&q.sourceCapabilities.firesTouchEvents||q.originalEvent&&q.originalEvent.sourceCapabilities&&q.originalEvent.sourceCapabilities.firesTouchEvents}const b=new Map([["OSLeft","MetaLeft"],["OSRight","MetaRight"]]),e={dispatchRuntimeEvent:!0,dispatchUserScriptEvent:!0},k={dispatchUserScriptEvent:!0},w={dispatchRuntimeEvent:!0};function y(q){return new Promise((r,n)=>{const v=document.createElement("link");v.onload=()=>r(v);v.onerror=
A=>n(A);v.rel="stylesheet";v.href=q;document.head.appendChild(v)})}function h(q){return new Promise((r,n)=>{const v=new Image;v.onload=()=>r(v);v.onerror=A=>n(A);v.src=q})}async function m(q){q=URL.createObjectURL(q);try{return await h(q)}finally{URL.revokeObjectURL(q)}}function c(q){return new Promise((r,n)=>{let v=new FileReader;v.onload=A=>r(A.target.result);v.onerror=A=>n(A);v.readAsText(q)})}async function f(q,r,n){if(!/firefox/i.test(navigator.userAgent))return await m(q);var v=await c(q);v=
(new DOMParser).parseFromString(v,"image/svg+xml");const A=v.documentElement;if(A.hasAttribute("width")&&A.hasAttribute("height")){const C=A.getAttribute("width"),E=A.getAttribute("height");if(!C.includes("%")&&!E.includes("%"))return await m(q)}A.setAttribute("width",r+"px");A.setAttribute("height",n+"px");v=(new XMLSerializer).serializeToString(v);q=new Blob([v],{type:"image/svg+xml"});return await m(q)}function t(q){do{if(q.parentNode&&q.hasAttribute("contenteditable"))return!0;q=q.parentNode}while(q);
return!1}const z=new Set(["input","textarea","datalist","select"]);function g(q){return z.has(q.tagName.toLowerCase())||t(q)}const l=new Set(["canvas","body","html"]);function p(q){const r=q.target.tagName.toLowerCase();l.has(r)&&q.preventDefault()}function u(q){(q.metaKey||q.ctrlKey)&&q.preventDefault()}self.C3_GetSvgImageSize=async function(q){q=await m(q);if(0<q.width&&0<q.height)return[q.width,q.height];{q.style.position="absolute";q.style.left="0px";q.style.top="0px";q.style.visibility="hidden";
document.body.appendChild(q);const r=q.getBoundingClientRect();document.body.removeChild(q);return[r.width,r.height]}};self.C3_RasterSvgImageBlob=async function(q,r,n,v,A){q=await f(q,r,n);const C=document.createElement("canvas");C.width=v;C.height=A;C.getContext("2d").drawImage(q,0,0,r,n);return C};let x=!1;document.addEventListener("pause",()=>x=!0);document.addEventListener("resume",()=>x=!1);function B(){try{return window.parent&&window.parent.document.hasFocus()}catch(q){return!1}}function G(){const q=
document.activeElement;if(!q)return!1;const r=q.tagName.toLowerCase(),n=new Set("email number password search tel text url".split(" "));return"textarea"===r?!0:"input"===r?n.has(q.type.toLowerCase()||"text"):t(q)}d.AddDOMHandlerClass(class extends self.DOMHandler{constructor(q){super(q,"runtime");this._isFirstSizeUpdate=!0;this._simulatedResizeTimerId=-1;this._targetOrientation="any";this._attachedDeviceMotionEvent=this._attachedDeviceOrientationEvent=!1;this._lastPointerRawUpdateEvent=this._pointerRawUpdateRateLimiter=
this._debugHighlightElem=null;this._pointerRawMovementY=this._pointerRawMovementX=0;this._lastWindowWidth=q._GetWindowInnerWidth();this._lastWindowHeight=q._GetWindowInnerHeight();this._virtualKeyboardHeight=0;q.AddRuntimeComponentMessageHandler("canvas","update-size",v=>this._OnUpdateCanvasSize(v));q.AddRuntimeComponentMessageHandler("runtime","invoke-download",v=>this._OnInvokeDownload(v));q.AddRuntimeComponentMessageHandler("runtime","raster-svg-image",v=>this._OnRasterSvgImage(v));q.AddRuntimeComponentMessageHandler("runtime",
"get-svg-image-size",v=>this._OnGetSvgImageSize(v));q.AddRuntimeComponentMessageHandler("runtime","set-target-orientation",v=>this._OnSetTargetOrientation(v));q.AddRuntimeComponentMessageHandler("runtime","register-sw",()=>this._OnRegisterSW());q.AddRuntimeComponentMessageHandler("runtime","post-to-debugger",v=>this._OnPostToDebugger(v));q.AddRuntimeComponentMessageHandler("runtime","go-to-script",v=>this._OnPostToDebugger(v));q.AddRuntimeComponentMessageHandler("runtime","before-start-ticking",()=>
this._OnBeforeStartTicking());q.AddRuntimeComponentMessageHandler("runtime","debug-highlight",v=>this._OnDebugHighlight(v));q.AddRuntimeComponentMessageHandler("runtime","enable-device-orientation",()=>this._AttachDeviceOrientationEvent());q.AddRuntimeComponentMessageHandler("runtime","enable-device-motion",()=>this._AttachDeviceMotionEvent());q.AddRuntimeComponentMessageHandler("runtime","add-stylesheet",v=>this._OnAddStylesheet(v));q.AddRuntimeComponentMessageHandler("runtime","alert",v=>this._OnAlert(v));
q.AddRuntimeComponentMessageHandler("runtime","hide-cordova-splash",()=>this._OnHideCordovaSplash());const r=new Set(["input","textarea","datalist"]);window.addEventListener("contextmenu",v=>{const A=v.target,C=A.tagName.toLowerCase();r.has(C)||t(A)||v.preventDefault()});const n=q.GetCanvas();window.addEventListener("selectstart",p);window.addEventListener("gesturehold",p);n.addEventListener("selectstart",p);n.addEventListener("gesturehold",p);window.addEventListener("touchstart",p,{passive:!1});
"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",p,{passive:!1}),n.addEventListener("pointerdown",p)):n.addEventListener("touchstart",p);this._mousePointerLastButtons=0;window.addEventListener("mousedown",v=>{1===v.button&&v.preventDefault()});window.addEventListener("mousewheel",u,{passive:!1});window.addEventListener("wheel",u,{passive:!1});window.addEventListener("resize",()=>this._OnWindowResize());window.addEventListener("fullscreenchange",()=>this._OnFullscreenChange());
window.addEventListener("webkitfullscreenchange",()=>this._OnFullscreenChange());window.addEventListener("mozfullscreenchange",()=>this._OnFullscreenChange());window.addEventListener("fullscreenerror",v=>this._OnFullscreenError(v));window.addEventListener("webkitfullscreenerror",v=>this._OnFullscreenError(v));window.addEventListener("mozfullscreenerror",v=>this._OnFullscreenError(v));q.IsiOSWebView()&&window.addEventListener("focusout",()=>{G()||(document.scrollingElement.scrollTop=0)});self.C3WrapperOnMessage=
v=>this._OnWrapperMessage(v);this._mediaPendingPlay=new Set;this._mediaRemovedPendingPlay=new WeakSet;this._isSilent=!1}_OnBeforeStartTicking(){"cordova"===this._iRuntime.GetExportType()?(document.addEventListener("pause",()=>this._OnVisibilityChange(!0)),document.addEventListener("resume",()=>this._OnVisibilityChange(!1))):document.addEventListener("visibilitychange",()=>this._OnVisibilityChange(document.hidden));return{isSuspended:!(!document.hidden&&!x)}}Attach(){window.addEventListener("focus",
()=>this._PostRuntimeEvent("window-focus"));window.addEventListener("blur",()=>{this._PostRuntimeEvent("window-blur",{parentHasFocus:B()});this._mousePointerLastButtons=0});window.addEventListener("focusin",r=>{g(r.target)&&this._PostRuntimeEvent("keyboard-blur")});window.addEventListener("keydown",r=>this._OnKeyEvent("keydown",r));window.addEventListener("keyup",r=>this._OnKeyEvent("keyup",r));window.addEventListener("dblclick",r=>this._OnMouseEvent("dblclick",r,e));window.addEventListener("wheel",
r=>this._OnMouseWheelEvent("wheel",r));"undefined"!==typeof PointerEvent?(window.addEventListener("pointerdown",r=>{this._HandlePointerDownFocus(r);this._OnPointerEvent("pointerdown",r)}),this._iRuntime.UsesWorker()&&"undefined"!==typeof window.onpointerrawupdate&&self===self.top?(this._pointerRawUpdateRateLimiter=new self.RateLimiter(()=>this._DoSendPointerRawUpdate(),5),this._pointerRawUpdateRateLimiter.SetCanRunImmediate(!0),window.addEventListener("pointerrawupdate",r=>this._OnPointerRawUpdate(r))):
window.addEventListener("pointermove",r=>this._OnPointerEvent("pointermove",r)),window.addEventListener("pointerup",r=>this._OnPointerEvent("pointerup",r)),window.addEventListener("pointercancel",r=>this._OnPointerEvent("pointercancel",r))):(window.addEventListener("mousedown",r=>{this._HandlePointerDownFocus(r);this._OnMouseEventAsPointer("pointerdown",r)}),window.addEventListener("mousemove",r=>this._OnMouseEventAsPointer("pointermove",r)),window.addEventListener("mouseup",r=>this._OnMouseEventAsPointer("pointerup",
r)),window.addEventListener("touchstart",r=>{this._HandlePointerDownFocus(r);this._OnTouchEvent("pointerdown",r)}),window.addEventListener("touchmove",r=>this._OnTouchEvent("pointermove",r)),window.addEventListener("touchend",r=>this._OnTouchEvent("pointerup",r)),window.addEventListener("touchcancel",r=>this._OnTouchEvent("pointercancel",r)));const q=()=>this._PlayPendingMedia();window.addEventListener("pointerup",q,!0);window.addEventListener("touchend",q,!0);window.addEventListener("click",q,!0);
window.addEventListener("keydown",q,!0);window.addEventListener("gamepadconnected",q,!0);this._iRuntime.IsAndroid()&&!this._iRuntime.IsAndroidWebView()&&navigator.virtualKeyboard&&(navigator.virtualKeyboard.overlaysContent=!0,navigator.virtualKeyboard.addEventListener("geometrychange",()=>{this._OnAndroidVirtualKeyboardChange(this._GetWindowInnerHeight(),navigator.virtualKeyboard.boundingRect.height)}))}_OnAndroidVirtualKeyboardChange(q,r){document.body.style.transform="";if(0<r){var n=document.activeElement;
n&&(n=n.getBoundingClientRect(),q=(n.top+n.bottom)/2-(q-r)/2,q>r&&(q=r),0>q&&(q=0),0<q&&(document.body.style.transform=`translateY(${-q}px)`))}}_PostRuntimeEvent(q,r){this.PostToRuntime(q,r||null,w)}_GetWindowInnerWidth(){return this._iRuntime._GetWindowInnerWidth()}_GetWindowInnerHeight(){return this._iRuntime._GetWindowInnerHeight()}_OnWindowResize(){const q=this._GetWindowInnerWidth(),r=this._GetWindowInnerHeight();if(this._iRuntime.IsAndroidWebView()){if(this._lastWindowWidth===q&&r<this._lastWindowHeight){this._virtualKeyboardHeight=
this._lastWindowHeight-r;this._OnAndroidVirtualKeyboardChange(this._lastWindowHeight,this._virtualKeyboardHeight);return}0<this._virtualKeyboardHeight&&(this._virtualKeyboardHeight=0,this._OnAndroidVirtualKeyboardChange(r,this._virtualKeyboardHeight));this._lastWindowWidth=q;this._lastWindowHeight=r}this._PostRuntimeEvent("window-resize",{innerWidth:q,innerHeight:r,devicePixelRatio:window.devicePixelRatio,isFullscreen:d.IsDocumentFullscreen()});this._iRuntime.IsiOSWebView()&&(-1!==this._simulatedResizeTimerId&&
clearTimeout(this._simulatedResizeTimerId),this._OnSimulatedResize(q,r,0))}_ScheduleSimulatedResize(q,r,n){-1!==this._simulatedResizeTimerId&&clearTimeout(this._simulatedResizeTimerId);this._simulatedResizeTimerId=setTimeout(()=>this._OnSimulatedResize(q,r,n),48)}_OnSimulatedResize(q,r,n){const v=this._GetWindowInnerWidth(),A=this._GetWindowInnerHeight();this._simulatedResizeTimerId=-1;v!=q||A!=r?this._PostRuntimeEvent("window-resize",{innerWidth:v,innerHeight:A,devicePixelRatio:window.devicePixelRatio,
isFullscreen:d.IsDocumentFullscreen()}):10>n&&this._ScheduleSimulatedResize(v,A,n+1)}_OnSetTargetOrientation(q){this._targetOrientation=q.targetOrientation}_TrySetTargetOrientation(){const q=this._targetOrientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(q).catch(r=>console.warn("[Construct 3] Failed to lock orientation: ",r));else try{let r=!1;screen.lockOrientation?r=screen.lockOrientation(q):screen.webkitLockOrientation?r=screen.webkitLockOrientation(q):screen.mozLockOrientation?
r=screen.mozLockOrientation(q):screen.msLockOrientation&&(r=screen.msLockOrientation(q));r||console.warn("[Construct 3] Failed to lock orientation")}catch(r){console.warn("[Construct 3] Failed to lock orientation: ",r)}}_OnFullscreenChange(){const q=d.IsDocumentFullscreen();q&&"any"!==this._targetOrientation&&this._TrySetTargetOrientation();this.PostToRuntime("fullscreenchange",{isFullscreen:q,innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnFullscreenError(q){console.warn("[Construct 3] Fullscreen request failed: ",
q);this.PostToRuntime("fullscreenerror",{isFullscreen:d.IsDocumentFullscreen(),innerWidth:this._GetWindowInnerWidth(),innerHeight:this._GetWindowInnerHeight()})}_OnVisibilityChange(q){q?this._iRuntime._CancelAnimationFrame():this._iRuntime._RequestAnimationFrame();this.PostToRuntime("visibilitychange",{hidden:q})}_OnKeyEvent(q,r){"Backspace"===r.key&&p(r);const n=b.get(r.code)||r.code;this._PostToRuntimeMaybeSync(q,{code:n,key:r.key,which:r.which,repeat:r.repeat,altKey:r.altKey,ctrlKey:r.ctrlKey,
metaKey:r.metaKey,shiftKey:r.shiftKey,timeStamp:r.timeStamp},e)}_OnMouseWheelEvent(q,r){this.PostToRuntime(q,{clientX:r.clientX,clientY:r.clientY,pageX:r.pageX,pageY:r.pageY,deltaX:r.deltaX,deltaY:r.deltaY,deltaZ:r.deltaZ,deltaMode:r.deltaMode,timeStamp:r.timeStamp},e)}_OnMouseEvent(q,r,n){a(r)||this._PostToRuntimeMaybeSync(q,{button:r.button,buttons:r.buttons,clientX:r.clientX,clientY:r.clientY,pageX:r.pageX,pageY:r.pageY,movementX:r.movementX||0,movementY:r.movementY||0,timeStamp:r.timeStamp},n)}_OnMouseEventAsPointer(q,
r){if(!a(r)){var n=this._mousePointerLastButtons;"pointerdown"===q&&0!==n?q="pointermove":"pointerup"===q&&0!==r.buttons&&(q="pointermove");this._PostToRuntimeMaybeSync(q,{pointerId:1,pointerType:"mouse",button:r.button,buttons:r.buttons,lastButtons:n,clientX:r.clientX,clientY:r.clientY,pageX:r.pageX,pageY:r.pageY,movementX:r.movementX||0,movementY:r.movementY||0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,timeStamp:r.timeStamp},e);this._mousePointerLastButtons=r.buttons;
this._OnMouseEvent(r.type,r,k)}}_OnPointerEvent(q,r){this._pointerRawUpdateRateLimiter&&"pointermove"!==q&&this._pointerRawUpdateRateLimiter.Reset();var n=0;"mouse"===r.pointerType&&(n=this._mousePointerLastButtons);this._PostToRuntimeMaybeSync(q,{pointerId:r.pointerId,pointerType:r.pointerType,button:r.button,buttons:r.buttons,lastButtons:n,clientX:r.clientX,clientY:r.clientY,pageX:r.pageX,pageY:r.pageY,movementX:(r.movementX||0)+this._pointerRawMovementX,movementY:(r.movementY||0)+this._pointerRawMovementY,
width:r.width||0,height:r.height||0,pressure:r.pressure||0,tangentialPressure:r.tangentialPressure||0,tiltX:r.tiltX||0,tiltY:r.tiltY||0,twist:r.twist||0,timeStamp:r.timeStamp},e);this._pointerRawMovementY=this._pointerRawMovementX=0;"mouse"===r.pointerType&&(n="mousemove","pointerdown"===q?n="mousedown":"pointerup"===q&&(n="mouseup"),this._OnMouseEvent(n,r,k),this._mousePointerLastButtons=r.buttons)}_OnPointerRawUpdate(q){this._lastPointerRawUpdateEvent&&(this._pointerRawMovementX+=this._lastPointerRawUpdateEvent.movementX||
0,this._pointerRawMovementY+=this._lastPointerRawUpdateEvent.movementY||0);this._lastPointerRawUpdateEvent=q;this._pointerRawUpdateRateLimiter.Call()}_DoSendPointerRawUpdate(){this._OnPointerEvent("pointermove",this._lastPointerRawUpdateEvent);this._lastPointerRawUpdateEvent=null}_OnTouchEvent(q,r){for(let n=0,v=r.changedTouches.length;n<v;++n){const A=r.changedTouches[n];this._PostToRuntimeMaybeSync(q,{pointerId:A.identifier,pointerType:"touch",button:0,buttons:0,lastButtons:0,clientX:A.clientX,
clientY:A.clientY,pageX:A.pageX,pageY:A.pageY,movementX:r.movementX||0,movementY:r.movementY||0,width:2*(A.radiusX||A.webkitRadiusX||0),height:2*(A.radiusY||A.webkitRadiusY||0),pressure:A.force||A.webkitForce||0,tangentialPressure:0,tiltX:0,tiltY:0,twist:A.rotationAngle||0,timeStamp:r.timeStamp},e)}}_HandlePointerDownFocus(q){window!==window.top&&window.focus();this._IsElementCanvasOrDocument(q.target)&&document.activeElement&&!this._IsElementCanvasOrDocument(document.activeElement)&&document.activeElement.blur()}_IsElementCanvasOrDocument(q){return!q||
q===document||q===window||q===document.body||"canvas"===q.tagName.toLowerCase()}_AttachDeviceOrientationEvent(){this._attachedDeviceOrientationEvent||(this._attachedDeviceOrientationEvent=!0,window.addEventListener("deviceorientation",q=>this._OnDeviceOrientation(q)),window.addEventListener("deviceorientationabsolute",q=>this._OnDeviceOrientationAbsolute(q)))}_AttachDeviceMotionEvent(){this._attachedDeviceMotionEvent||(this._attachedDeviceMotionEvent=!0,window.addEventListener("devicemotion",q=>this._OnDeviceMotion(q)))}_OnDeviceOrientation(q){this.PostToRuntime("deviceorientation",
{absolute:!!q.absolute,alpha:q.alpha||0,beta:q.beta||0,gamma:q.gamma||0,timeStamp:q.timeStamp,webkitCompassHeading:q.webkitCompassHeading,webkitCompassAccuracy:q.webkitCompassAccuracy},e)}_OnDeviceOrientationAbsolute(q){this.PostToRuntime("deviceorientationabsolute",{absolute:!!q.absolute,alpha:q.alpha||0,beta:q.beta||0,gamma:q.gamma||0,timeStamp:q.timeStamp},e)}_OnDeviceMotion(q){let r=null;var n=q.acceleration;n&&(r={x:n.x||0,y:n.y||0,z:n.z||0});n=null;var v=q.accelerationIncludingGravity;v&&(n=
{x:v.x||0,y:v.y||0,z:v.z||0});v=null;const A=q.rotationRate;A&&(v={alpha:A.alpha||0,beta:A.beta||0,gamma:A.gamma||0});this.PostToRuntime("devicemotion",{acceleration:r,accelerationIncludingGravity:n,rotationRate:v,interval:q.interval,timeStamp:q.timeStamp},e)}_OnUpdateCanvasSize(q){const r=this.GetRuntimeInterface().GetCanvas();r.style.width=q.styleWidth+"px";r.style.height=q.styleHeight+"px";r.style.marginLeft=q.marginLeft+"px";r.style.marginTop=q.marginTop+"px";this._isFirstSizeUpdate&&(r.style.display=
"",this._isFirstSizeUpdate=!1)}_OnInvokeDownload(q){const r=q.url;q=q.filename;const n=document.createElement("a"),v=document.body;n.textContent=q;n.href=r;n.download=q;v.appendChild(n);n.click();v.removeChild(n)}async _OnRasterSvgImage(q){var r=q.imageBitmapOpts;q=await self.C3_RasterSvgImageBlob(q.blob,q.imageWidth,q.imageHeight,q.surfaceWidth,q.surfaceHeight);r=r?await createImageBitmap(q,r):await createImageBitmap(q);return{imageBitmap:r,transferables:[r]}}async _OnGetSvgImageSize(q){return await self.C3_GetSvgImageSize(q.blob)}async _OnAddStylesheet(q){await y(q.url)}_PlayPendingMedia(){var q=
[...this._mediaPendingPlay];this._mediaPendingPlay.clear();if(!this._isSilent)for(const r of q)(q=r.play())&&q.catch(n=>{this._mediaRemovedPendingPlay.has(r)||this._mediaPendingPlay.add(r)})}TryPlayMedia(q){if("function"!==typeof q.play)throw Error("missing play function");this._mediaRemovedPendingPlay.delete(q);let r;try{r=q.play()}catch(n){this._mediaPendingPlay.add(q);return}r&&r.catch(n=>{this._mediaRemovedPendingPlay.has(q)||this._mediaPendingPlay.add(q)})}RemovePendingPlay(q){this._mediaPendingPlay.delete(q);
this._mediaRemovedPendingPlay.add(q)}SetSilent(q){this._isSilent=!!q}_OnHideCordovaSplash(){navigator.splashscreen&&navigator.splashscreen.hide&&navigator.splashscreen.hide()}_OnDebugHighlight(q){if(q.show){this._debugHighlightElem||(this._debugHighlightElem=document.createElement("div"),this._debugHighlightElem.id="inspectOutline",document.body.appendChild(this._debugHighlightElem));var r=this._debugHighlightElem;r.style.display="";r.style.left=q.left-1+"px";r.style.top=q.top-1+"px";r.style.width=
q.width+2+"px";r.style.height=q.height+2+"px";r.textContent=q.name}else this._debugHighlightElem&&(this._debugHighlightElem.style.display="none")}_OnRegisterSW(){window.C3_RegisterSW&&window.C3_RegisterSW()}_OnPostToDebugger(q){window.c3_postToMessagePort&&(q.from="runtime",window.c3_postToMessagePort(q))}_InvokeFunctionFromJS(q,r){return this.PostToRuntimeAsync("js-invoke-function",{name:q,params:r})}_OnAlert(q){alert(q.message)}_OnWrapperMessage(q){"entered-fullscreen"===q?(d._SetWrapperIsFullscreenFlag(!0),
this._OnFullscreenChange()):"exited-fullscreen"===q?(d._SetWrapperIsFullscreenFlag(!1),this._OnFullscreenChange()):console.warn("Unknown wrapper message: ",q)}})}"use strict";
self.JobSchedulerDOM=class{constructor(d){this._runtimeInterface=d;this._baseUrl=d.GetBaseURL();"preview"===d.GetExportType()?this._baseUrl+="workers/":this._baseUrl+=d.GetScriptFolder();this._maxNumWorkers=Math.min(navigator.hardwareConcurrency||2,16);this._dispatchWorker=null;this._jobWorkers=[];this._outputPort=this._inputPort=null}async Init(){if(this._hasInitialised)throw Error("already initialised");this._hasInitialised=!0;var d=this._runtimeInterface._GetWorkerURL("dispatchworker.js");this._dispatchWorker=
await this._runtimeInterface.CreateWorker(d,this._baseUrl,{name:"DispatchWorker"});d=new MessageChannel;this._inputPort=d.port1;this._dispatchWorker.postMessage({type:"_init","in-port":d.port2},[d.port2]);this._outputPort=await this._CreateJobWorker()}async _CreateJobWorker(){const d=this._jobWorkers.length;var a=this._runtimeInterface._GetWorkerURL("jobworker.js");a=await this._runtimeInterface.CreateWorker(a,this._baseUrl,{name:"JobWorker"+d});const b=new MessageChannel,e=new MessageChannel;this._dispatchWorker.postMessage({type:"_addJobWorker",
port:b.port1},[b.port1]);a.postMessage({type:"init",number:d,"dispatch-port":b.port2,"output-port":e.port2},[b.port2,e.port2]);this._jobWorkers.push(a);return e.port1}GetPortData(){return{inputPort:this._inputPort,outputPort:this._outputPort,maxNumWorkers:this._maxNumWorkers}}GetPortTransferables(){return[this._inputPort,this._outputPort]}};"use strict";
window.C3_IsSupported&&(window.c3_runtimeInterface=new self.RuntimeInterface({useWorker:!1,workerMainUrl:"workermain.js",engineScripts:["scripts/c3runtime.js"],projectScripts:[],mainProjectScript:"",scriptFolder:"scripts/",workerDependencyScripts:[],exportType:"html5"}));"use strict";
{function d(a){a.stopPropagation()}self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(a){super(a,"button")}CreateElement(a,b){const e=document.createElement("input");var k=e;b.isCheckbox?(e.type="checkbox",k=document.createElement("label"),k.appendChild(e),k.appendChild(document.createTextNode("")),k.style.fontFamily="sans-serif",k.style.userSelect="none",k.style.webkitUserSelect="none",k.style.display="inline-block",k.style.color="black"):e.type="button";k.style.position=
"absolute";k.addEventListener("touchstart",d);k.addEventListener("touchmove",d);k.addEventListener("touchend",d);k.addEventListener("mousedown",d);k.addEventListener("mouseup",d);k.addEventListener("keydown",d);k.addEventListener("keyup",d);e.addEventListener("click",()=>this._PostToRuntimeElementMaybeSync("click",a,{isChecked:e.checked}));b.id&&(e.id=b.id);this.UpdateState(k,b);return k}_GetInputElem(a){return"input"===a.tagName.toLowerCase()?a:a.firstChild}_GetFocusElement(a){return this._GetInputElem(a)}UpdateState(a,
b){const e=this._GetInputElem(a);e.checked=b.isChecked;e.disabled=!b.isEnabled;a.title=b.title;a===e?e.value=b.text:a.lastChild.textContent=b.text}})}"use strict";
{function d(b){b.stopPropagation()}function a(b){13!==b.which&&27!==b.which&&b.stopPropagation()}self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(b){super(b,"text-input");this.AddDOMElementMessageHandler("scroll-to-bottom",e=>this._OnScrollToBottom(e))}CreateElement(b,e){let k;const w=e.type;"textarea"===w?(k=document.createElement("textarea"),k.style.resize="none"):(k=document.createElement("input"),k.type=w);k.style.position="absolute";k.autocomplete="off";
k.addEventListener("touchstart",d);k.addEventListener("touchmove",d);k.addEventListener("touchend",d);k.addEventListener("mousedown",d);k.addEventListener("mouseup",d);k.addEventListener("keydown",a);k.addEventListener("keyup",a);k.addEventListener("click",y=>{y.stopPropagation();this._PostToRuntimeElementMaybeSync("click",b)});k.addEventListener("dblclick",y=>{y.stopPropagation();this._PostToRuntimeElementMaybeSync("dblclick",b)});k.addEventListener("input",()=>this.PostToRuntimeElement("change",
b,{text:k.value}));e.id&&(k.id=e.id);this.UpdateState(k,e);return k}UpdateState(b,e){b.value=e.text;b.placeholder=e.placeholder;b.title=e.title;b.disabled=!e.isEnabled;b.readOnly=e.isReadOnly;b.spellcheck=e.spellCheck;e=e.maxLength;0>e?b.removeAttribute("maxlength"):b.setAttribute("maxlength",e)}_OnScrollToBottom(b){b.scrollTop=b.scrollHeight}})}"use strict";
{const d=[],a=2*Math.PI;function b(g){g%=a;0>g&&(g+=a);return g}function e(g,l,p){return g<l?l:g>p?p:g}function k(g,l,p){return g+p*(l-g)}function w(g,l,p){return g===l?0:(p-g)/(l-g)}function y(g,l){if(g===l)return 0;g=Math.sin(g)*Math.sin(l)+Math.cos(g)*Math.cos(l);return 1<=g?0:-1>=g?Math.PI:Math.acos(g)}function h(g,l){return 0>=Math.cos(g)*Math.sin(l)-Math.sin(g)*Math.cos(l)}function m(g,l,p){const u=y(g,l);return h(l,g)?b(g+u*p):b(g-u*p)}class c{constructor(g,l,p,u,x,B){this._index=g;this._interp=
l;this._precision=p;this._tag=u;this._userData=x;this._clientValueTag=B}GetRuntimeData(){return{tag:this._tag,interp:this._interp,userData:this._userData,cvt:this._clientValueTag}}GetIndex(){return this._index}GetInterp(){return this._interp}GetPrecision(){return this._precision}GetTag(){return this._tag}HasUserData(){return"undefined"!==typeof this._userData}GetUserData(){return this._userData}GetClientValueTag(){return this._clientValueTag}Clamp(g){switch(this._precision){case 0:return g;case 1:return Math.fround(g);
case 2:return 2===this._interp&&(g=b(g),g/=Math.PI,g=32767*(g-1)),e(g|0,-32768,32767);case 3:return 2===this._interp&&(g=b(g),g/=a,g*=255),e(g|0,0,255);default:return g}}Write(g,l,p){switch(this._precision){case 0:g.setFloat64(l,p);l+=8;break;case 1:g.setFloat32(l,p);l+=4;break;case 2:g.setInt16(l,p);l+=2;break;case 3:g.setUint8(l,p);l+=1;break;default:g.setFloat32(l,p),l+=4}return l}MaybeUnpack(g){if(2!==this._interp)return g;2===this._precision?g=(g/32767+1)*Math.PI:3===this._precision&&(g=g/255*
a);return g}static InterpNetValue(g,l,p,u,x){switch(g){case 0:return x?p:l;case 1:return k(l,p,u);case 2:return m(l,p,u);default:return x?p:l}}}class f{constructor(g,l){this.timestamp=g;this.data=l}}class t{constructor(g,l,p){this._ro=g;this._domHandler=g.GetDOMHandler();this._id=l;this._nid=p;this._data=[];this._data.length=this._ro.GetNetValues().length;this._lastTransmitted=this._lastChanged=0;this._isAlive=this._transmitMe=!1;this._updates=[];this._nextUpdate=this._priorUpdate=this._priorUpdate2=
null}GetRuntimeData(){var g=[];for(let p=0,u=this._ro.GetNetValues().length;p<u;++p)g.push(this.GetInterp(this._ro.GetSimTime(),p));g={id:this._id,nid:this._nid,isTimedOut:this.IsTimedOut(),interpValues:g,latestUpdate:null};const l=this.GetLatestUpdate();l&&(g.latestUpdate={timestamp:l.timestamp,data:l.data});return g}GetId(){return this._id}GetNid(){return this._nid}SetAlive(g){this._isAlive=!!g}IsAlive(){return this._isAlive}ShouldTransmit(){return this._transmitMe}UpdateData(g,l){g=g.netValues;
var p=this._ro.GetNetValues();const u=p.length;this._transmitMe=!1;for(let x=0;x<u;++x){const B=p[x].Clamp(g[x]);this._data[x]!==B&&(this._data[x]=B,this._lastChanged=l,this._ro.SetLastChanged(l))}g=l-this._lastChanged;l-=this._lastTransmitted;p=this._ro.GetBandwidth();(this._transmitMe=100>g&&0===p?!0:1E3>g&&1>=p?95<=l:495<=l)&&this._ro.IncNumberToTransmit()}WriteData(g,l,p){const u=this._ro.GetNetValues();this._lastTransmitted=p;g.setUint16(l,this._nid);l+=2;for(let x=0,B=this._data.length;x<B;++x)l=
u[x].Write(g,l,this._data[x]);return l}AddUpdate(g,l){for(let p=0,u=this._updates.length;p<u;++p){const x=this._updates[p];if(x.timestamp===g)return;if(x.timestamp>g){this._updates.splice(p,0,new f(g,l));return}}this._updates.push(new f(g,l))}IsTimedOut(){return 0===this._updates.length?!1:this._updates[this._updates.length-1].timestamp<this._ro.GetSimTime()-3E3}Tick(){for(;2<this._updates.length&&this._updates[0]!==this._priorUpdate2&&this._updates[0]!==this._priorUpdate&&this._updates[0]!==this._nextUpdate;)this._updates.shift();
const g=this._ro.GetSimTime();if(!(this._nextUpdate&&this._nextUpdate.timestamp>g&&this._priorUpdate&&this._priorUpdate.timestamp<g)){this._nextUpdate=null;for(let l=0,p=this._updates.length;l<p;++l){const u=this._updates[l];if(u.timestamp<=g){if(!this._priorUpdate||u.timestamp>this._priorUpdate.timestamp)this._priorUpdate2=this._priorUpdate,this._priorUpdate=u}else{this._nextUpdate=u;break}}}}GetLatestUpdate(){return 0===this._updates.length?null:this._updates[this._updates.length-1]}GetInterp(g,
l,p){if(!this._nextUpdate&&!this._priorUpdate)return 0;if(this._nextUpdate&&!this._priorUpdate)return this._nextUpdate.data[l];const u=this._ro.GetNetValues();let x,B,G;if(!this._nextUpdate&&this._priorUpdate)return this._priorUpdate2&&!p?(x=this._priorUpdate2.timestamp,p=this._priorUpdate2.data[l],B=this._priorUpdate.timestamp,G=this._priorUpdate.data[l],g>this._priorUpdate.timestamp+this._ro.GetExtrapolateLimit()&&(g=this._priorUpdate.timestamp+this._ro.GetExtrapolateLimit()),g=w(x,B,g),c.InterpNetValue(u[l].GetInterp(),
p,G,g,!0)):this._priorUpdate.data[l];x=this._priorUpdate.timestamp;p=this._priorUpdate.data[l];B=this._nextUpdate.timestamp;G=this._nextUpdate.data[l];g=w(x,B,g);return c.InterpNetValue(u[l].GetInterp(),p,G,g,!1)}}class z{constructor(g,l,p,u){this._domHandler=g;this._roId=l;this._sid=p;this._nid=this._domHandler.GetNextObjectNid();this._bandwidth=u;this._userData={};this._instanceByteSize=0;this._extrapolateLimit=250;switch(this._bandwidth){case 1:this._extrapolateLimit=500;break;case 2:this._extrapolateLimit=
2500}this._netValues=[];this._netInstances=[];this._idToNetInst=new Map;this._usedNids=new Set;this._numberToTransmit=this._lastTransmitted=this._lastChanged=this._nextNid=0;this._hasOverriddenNids=!1;this._deadNids=[];this._overrideNids=new Map;this._nidToNetInst=new Map;this._simTime=0;this._domHandler.AddRegisteredObject(this)}GetDOMHandler(){return this._domHandler}GetNetValues(){return this._netValues}GetRoId(){return this._roId}_SetNid(g){this._nid=g}GetNid(){return this._nid}SetLastChanged(g){this._lastChanged=
g}GetBandwidth(){return this._bandwidth}IncNumberToTransmit(){this._numberToTransmit++}GetNumberToTransmit(){return this._numberToTransmit}GetSimTime(){return this._simTime}_SetHasOverriddenNids(g){this._hasOverriddenNids=!!g}HasOverriddenNids(){return this._hasOverriddenNids}GetExtrapolateLimit(){return this._extrapolateLimit}GetSid(){return this._sid}GetDeadNids(){return this._deadNids}AddValue(g,l,p,u,x){g=new c(this._netValues.length,g,l,p,u,x);switch(l){case 0:this._instanceByteSize+=8;break;
case 1:this._instanceByteSize+=4;break;case 2:this._instanceByteSize+=2;break;case 3:this._instanceByteSize+=1}this._netValues.push(g)}AddUpdate(g,l,p){this.GetNetInstForNid(l).AddUpdate(g,p)}Tick(){this._simTime=this._domHandler.GetSimulationTime();for(const g of this._netInstances)g.Tick()}GetCount(){return this._netInstances.length}GetNetInstAt(g){g=Math.floor(g);return 0>g||g>=this._netInstances.length?null:this._netInstances[g]}GetNetInstByNid(g){for(const l of this._netInstances)if(l.GetNid()===
g)return l;return null}GetNetValuesJson(){const g=[];for(const l of this._netValues){const p={tag:l.GetTag(),precision:l.GetPrecision(),interp:l.GetInterp(),clientvaluetag:l.GetClientValueTag()};l.HasUserData()&&(p.userdata=l.GetUserData());g.push(p)}return g}SetNetValuesFrom(g){this._instanceByteSize=this._netValues.length=0;for(const l of g)this.AddValue(l.interp,l.precision,l.tag,l.userdata,l.clientvaluetag)}GetNetInstForNid(g){let l=this._nidToNetInst.get(g);if(l)return l;l=new t(this,-1,g);this._nidToNetInst.set(g,
l);this._netInstances.push(l);return l}GetNetInstForId(g){let l=this._idToNetInst.get(g);if(l)return l;l=new t(this,g,this.AllocateInstanceNid());this._idToNetInst.set(g,l);this._netInstances.push(l);return l}AllocateInstanceNid(){do this._nextNid++,65535<this._nextNid&&(this._nextNid=0);while(this._usedNids.has(this._nextNid));const g=this._nextNid;this._usedNids.add(g);return g}RemoveNetInstance(g){const l=g.GetId(),p=g.GetNid();this._domHandler.IsHost()&&!this._hasOverriddenNids&&this._deadNids.push(p);
this._idToNetInst.delete(l);this._nidToNetInst.delete(p);this._usedNids.delete(p);g=this._netInstances.indexOf(g);-1<g&&this._netInstances.splice(g,1)}ClearAllNetInstances(){this._deadNids.length=0;this._idToNetInst.clear();this._nidToNetInst.clear();this._usedNids.clear();this._netInstances.length=0}UpdateData(g,l){this._numberToTransmit=0;for(var p of this._netInstances)p.SetAlive(!1);for(let u=0,x=g.length;u<x;++u){p=g[u];const B=this.GetNetInstForId(p.uid);B.SetAlive(!0);B.UpdateData(p,l)}for(const u of this._netInstances)u.IsAlive()||
d.push(u);for(const u of d)this.RemoveNetInstance(u);d.length=0}WriteData(g,l,p){g.setUint16(l,this._nid);l+=2;let u=0;this._hasOverriddenNids&&(u=1);g.setUint8(l,u);l+=1;g.setUint16(l,this._numberToTransmit);l+=2;g.setUint16(l,this._instanceByteSize);l+=2;for(const x of this._netInstances)x.ShouldTransmit()&&(l=x.WriteData(g,l,p));return l}OverrideNid(g,l){if(this._idToNetInst.has(g))console.warn("OverrideNid passed id "+g+" which is already in use and cannot be overridden");else if(this._usedNids.has(l))console.warn("OverrideNid passed nid "+
l+" which is already in use and cannot be overridden");else{var p=new t(this,g,l);this._idToNetInst.set(g,p);this._usedNids.add(l);this._netInstances.push(p);this._hasOverriddenNids=!0;return p}}RemoveObjectId(g){(g=this._idToNetInst.get(g))&&this.RemoveNetInstance(g)}RemoveObjectNid(g){(g=this._nidToNetInst.get(g))&&this.RemoveNetInstance(g)}GetRuntimeData(){return{hasOverriddenNids:this.HasOverriddenNids(),netValues:this._netValues.map(g=>g.GetRuntimeData()),netInstances:this._netInstances.map(g=>
g.GetRuntimeData())}}GetRuntimeInfoRequest(){return{roId:this._roId,sid:this._sid,netValues:this._netValues.map(g=>g.GetRuntimeData())}}}self.C3NetValue=c;self.C3NetUpdate=f;self.C3RegisteredObject=z}"use strict";
{const d=self.C3NetUpdate,a=self.C3NetValue,b=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection;function e(h){if(h)try{h.close()}catch(m){}}const k=[];function w(h,m,c){return h===m?0:(c-h)/(m-h)}class y{constructor(h,m,c){this._domHandler=h;this._id=m;this._nid=0;this._alias=c;this._dco=this._pc=null;this._isOOpen=!1;this._dcr=null;this._isROpen=!1;this._dcu=null;this._hasConfirmed=this._wasRemoved=this._firedClose=this._firedOpen=this._isUOpen=
!1;this._errorCount=this._connectTime=this._lastHeardFrom=0;this._localClientState=[];this._lastStateTransmit=this._lastStateChange=0;this._clientStateUpdates=[];this._nextUpdate=this._priorUpdate=this._priorUpdate2=null;this._lastPingSent=0;this._awaitingPong=!1;this._lastSentPingId=1;this._lastPingTimes=[];this._pdv=this._latency=0;this._domHandler._AddPeer(this)}GetId(){return this._id}GetNid(){return this._nid}_SetNid(h){this._nid=h}GetAlias(){return this._alias}IsHost(){return this===this._domHandler.GetHostPeer()}IsSelf(){return this===
this._domHandler.GetSelfPeer()}GetLocalClientState(){return this._localClientState}_SetLastStateChange(h){this._lastStateChange=h}GetLastStateChange(){return this._lastStateChange}_SetLastStateTransmit(h){this._lastStateTransmit=h}GetLastStateTransmit(){return this._lastStateTransmit}GetLatency(){return this._latency}GetPdv(){return this._pdv}_AttachDataChannelHandlers(h,m){h.binaryType="arraybuffer";h.onopen=()=>{"o"===m?this._isOOpen=!0:"r"===m?this._isROpen=!0:"u"===m&&(this._isUOpen=!0);this._MaybeFireOpen()};
h.onmessage=c=>{this._OnMessage(m,c)};h.onerror=c=>{console.error("Peer '"+this._id+"' datachannel '"+m+"' error: ",c);this._domHandler._OnPeerError(this,c);this._domHandler.IsHost()&&!this.IsHost()&&this.Remove("network error")};h.onclose=()=>{this.Remove("disconnect")}}Connect(){if(!this.IsSelf()){var h=this._domHandler.IsHost();this._firedClose=this._firedOpen=this._isUOpen=this._isROpen=this._isOOpen=!1;this._connectTime=performance.now();this._pc=new b({iceServers:this._domHandler.GetICEServerList()});
this._pc.onicecandidate=c=>{c.candidate&&this._domHandler.SignallingSend({message:"icecandidate",toclientid:this._id,icecandidate:c.candidate})};this._pc.onsignalingstatechange=()=>{this._pc&&"closed"===this._pc.signalingState&&this.Remove("disconnect")};this._pc.oniceconnectionstatechange=()=>{this._pc&&("failed"!==this._pc.iceConnectionState&&"closed"!==this._pc.iceConnectionState||this.Remove("disconnect"))};this._pc.onconnectionstatechange=()=>{if(this._pc){var c=this._pc.connectionState;"failed"!==
c&&"closed"!==c||this.Remove("disconnect")}};var m=`c2mp_${this._domHandler.GetCurrentGame()}_${this._domHandler.GetCurrentGameInstance()}_${this._domHandler.GetCurrentRoom()}`;h?(this._nid=this._domHandler.AllocatePeerNid(),this._dco=this._pc.createDataChannel("o",{ordered:!0,protocol:m}),this._AttachDataChannelHandlers(this._dco,"o"),this._dcr=this._pc.createDataChannel("r",{ordered:!1,protocol:m}),this._AttachDataChannelHandlers(this._dcr,"r"),this._dcu=this._pc.createDataChannel("u",{ordered:!1,
maxRetransmits:0,protocol:m}),this._AttachDataChannelHandlers(this._dcu,"u"),this._pc.createOffer().then(c=>{this._pc.setLocalDescription(c);this._domHandler.SignallingSend({message:"offer",toclientid:this._id,offer:c})}).catch(c=>{console.error("Host error creating offer for peer '"+this._id+"': ",c);this._domHandler._OnPeerError(this,"could not create offer for peer")})):this._pc.ondatachannel=c=>{if(c.channel.protocol!==m)console.error("Unexpected datachannel protocol '"+c.channel.protocol+"', should be '"+
m+"'"),this._domHandler._OnPeerError(this,"unexpected datachannel protocol '"+c.channel.protocol+"', should be '"+m+"'");else{var f=c.channel.label;"o"===f?this._dco=c.channel:"r"===f?this._dcr=c.channel:"u"===f?this._dcu=c.channel:(console.error("Unknown datachannel label: "+c.channel.label),this._domHandler._OnPeerError(this,"unknown datachannel label '"+c.channel.label+"'"));this._AttachDataChannelHandlers(c.channel,f)}}}}async _AddICECandidate(h){if(this._pc)try{await this._pc.addIceCandidate(h)}catch(m){console.warn("[Multiplayer] Error adding ICE candidate: ",
m)}}HasPeerConnection(){return!!this._pc}GetPeerConnection(){return this._pc}_MaybeFireOpen(){!this._firedOpen&&this._isROpen&&this._isUOpen&&this._isOOpen&&(this._OnOpen(),this._firedOpen=!0,this._firedClose=!1)}_OnOpen(){this._lastHeardFrom=performance.now();if(this._domHandler.IsHost()){this._domHandler.HostBroadcast("o",JSON.stringify({c:"j",i:this._id,n:this._nid,a:this._alias}),this);this.Send("o",JSON.stringify({c:"hi",hn:this._domHandler.GetHostPeer().GetNid(),n:this._nid,d:this._domHandler.GetClientDelay(),
u:this._domHandler.GetPeerUpdateRateSec(),objs:this._domHandler.GetRegisteredObjectsMap(),cvs:this._domHandler.GetClientValuesJson()}));for(const h of this._domHandler.peers())!h.IsHost()&&h!==this&&h.IsOpen()&&this.Send("o",JSON.stringify({c:"j",i:h.GetId(),n:h.GetNid(),a:h.GetAlias()}))}else this._hasConfirmed=!0,this.IsHost()&&this.SendPing(performance.now(),!0);this._domHandler._OnPeerOpen(this)}_MaybeFireClose(h){!this._firedClose&&this._firedOpen&&(this._OnClose(h),this._firedClose=!0,this._firedOpen=
!1)}_OnClose(h){this._domHandler.IsHost()&&!this.IsSelf()&&this._domHandler.HostBroadcast("o",JSON.stringify({c:"l",i:this._id,a:this._alias,r:h}),this);this.IsSelf()||this._domHandler._OnPeerClose(this,h)}IsOpen(){return this._firedOpen&&!this._firedClose}Send(h,m){this._domHandler.StatIncOutboundCount();var c=0;m.length?c=m.length:m.byteLength&&(c=m.byteLength);this._domHandler.StatAddOutboundBandwidthCount(c);c=this._domHandler.GetSimulatedPacketLoss();const f=this._domHandler.GetSimulatedLatency(),
t=this._domHandler.GetSimulatedPdv();if(!(0<c&&"u"===h&&Math.random()<c))if(0===f&&0===t)this._DoSend(h,m);else{let z=1;"u"!==h&&Math.random()<c&&(z=3);setTimeout(()=>this._DoSend(h,m),f*z+Math.random()*t*z)}}_DoSend(h,m){try{"o"===h?this._isOOpen&&this._dco&&this._dco.send(m):"r"===h?this._isROpen&&this._dcr&&this._dcr.send(m):"u"===h&&this._isUOpen&&this._dcu&&this._dcu.send(m)}catch(c){this._wasRemoved||(this._domHandler.IsHost()?"o"===h||"r"===h?("string"===typeof m?(console.error("Error sending "+
m.length+"-char string on '"+h+"' to '"+this._alias+"', host kicking: ",c),console.log("String that failed to send from previous error was: "+m)):console.error("Error sending "+(m.length||m.byteLength)+"-byte binary on '"+h+"' to '"+this._alias+"', host kicking: ",c),this.Remove("network error")):(this._errorCount++,10<=this._errorCount&&("string"===typeof m?(console.error("Too many errors ("+this._errorCount+") sending data on '"+h+"' to '"+this._alias+"', kicking; last error was for sending "+m.length+
"-char string: ",c),console.log("String that failed to send from previous error was: "+m)):console.error("Too many errors ("+this._errorCount+") sending data on '"+h+"' to '"+this._alias+"', kicking; last error was for sending "+(m.length||m.byteLength)+"-byte binary: ",c),this.Remove("network error"))):console.error("Error sending data on '"+h+"': ",c))}}SendPing(h,m){this._wasRemoved||(!m&&!this.IsOpen()&&this._pc&&25E3<h-this._connectTime?(console.warn("Timed out '"+this._alias+"', could not establish connection after 25sec"),
this.Remove("timeout")):!m&&this.IsOpen()&&2E4<h-this._lastHeardFrom?(console.warn("Timed out '"+this._alias+"', not heard from for 20sec"),this.Remove("timeout")):(this._lastPingSent=h,this._awaitingPong=!0,this._lastSentPingId++,this.Send("u","ping:"+this._lastSentPingId)))}SendPong(h){h="pong:"+h.substr(5);this._domHandler.IsHost()&&(h=h+"/"+Math.round(performance.now()).toString());this.Send("u",h)}_OnPong(h){if(this._awaitingPong){var m=h.indexOf(":");if(-1<m){if(parseFloat(h.substr(m+1))===
this._lastSentPingId){m=performance.now();this._awaitingPong=!1;var c=(m-this._lastPingSent)/2;this._lastPingTimes.push(c);10<this._lastPingTimes.length&&this._lastPingTimes.shift();k.push(...this._lastPingTimes);k.sort((g,l)=>g-l);this._pdv=k[k.length-1]-k[0];var f=0,t=k.length;4<=k.length&&6>=k.length?(++f,--t):6<k.length&&(f+=2,t-=2);var z=0;for(let g=f;g<t;++g)z+=k[g];this._latency=z/(t-f);k.length=0;this._domHandler.IsHost()||(f=h.indexOf("/"),-1<f?(h=parseFloat(h.substr(f+1)),isFinite(h)?this._domHandler.AddHostTime(h,
m,c,this._latency):console.warn("Invalid host time from pong response")):console.warn("Cannot parse off host time from pong response"))}}else console.warn("Cannot parse off ping ID from pong")}}_OnMessage(h,m){const c=this._domHandler.GetSimulatedPacketLoss(),f=this._domHandler.GetSimulatedLatency(),t=this._domHandler.GetSimulatedPdv();if(!(0<c&&"u"===h&&Math.random()<c))if(0===f&&0===t)this._DoOnMessage(h,m);else{let z=1;"u"!==h&&Math.random()<c&&(z=3);setTimeout(()=>this._DoOnMessage(h,m),f*z+Math.random()*
t*z)}}_DoOnMessage(h,m){if(!this._wasRemoved){this._lastHeardFrom=performance.now();this._domHandler.StatIncInboundCount();var c=0;m.data.length?c=m.data.length:m.data.byteLength&&(c=m.data.byteLength);this._domHandler.StatAddInboundBandwidthCount(c);if("string"===typeof m.data){if(!(""===m.data.trim()||4>m.data.length))if(h=m.data.substr(0,4),"ping"===h)this.SendPong(m.data);else if("pong"===h)this._OnPong(m.data);else{try{var f=JSON.parse(m.data)}catch(t){this._domHandler._OnPeerError(this,t);this._domHandler.IsHost()?
(console.error("Error parsing message as JSON for peer '"+this._id+"', host kicking: ",t),this.Remove("data error")):console.error("Error parsing message as JSON for peer '"+this._id+"': ",t);console.log("String that failed to parse from previous error: "+m.data);return}if(f)try{f.c&&"m"!==f.c?this._OnControlMessage(f):this._domHandler._OnPeerMessage(this,f)}catch(t){this._domHandler._OnPeerError(this,t),this._domHandler.IsHost()?(console.error("Error handling message for peer '"+this._id+"', host kicking: ",
t),this.Remove("data error")):console.error("Error handling message for peer '"+this._id+"': ",t)}}}else{!this._hasConfirmed&&this._domHandler.IsHost()&&"u"===h&&(this._hasConfirmed=!0,this._domHandler.SignallingConfirmPeer(this._id));try{this._OnBinaryMessage(m.data)}catch(t){this._domHandler._OnPeerError(this,t),this._domHandler.IsHost()?(console.error("Error handling binary update for peer '"+this._id+"', host kicking: ",t),this.Remove("data error")):console.error("Error handling binary update for peer '"+
this._id+"': ",t)}}}}_OnControlMessage(h){switch(h.c){case "disconnect":h.k&&this._domHandler.PostToRuntime("peer-kicked");var m=!this._domHandler.IsHost()&&!this.IsHost();this.Remove(h.r);m&&this._domHandler.SignallingLeaveRoom();break;case "hi":this._domHandler.IsHost()||(this._domHandler.GetHostPeer()._SetNid(h.hn),this._domHandler.GetSelfPeer()._SetNid(h.n),this._domHandler.SetClientDelay(h.d),this._domHandler.SetPeerUpdateRateSec(h.u),this._domHandler.MapObjectNids(h.objs),this._domHandler.MapClientValues(h.cvs));
break;case "j":this._domHandler.IsHost()||(m=new y(this._domHandler,h.i,h.a),m._SetNid(h.n),this._domHandler._OnPeerOpen(m));break;case "l":!this._domHandler.IsHost()&&(m=this._domHandler.GetPeerById(h.i))&&(m.IsSelf()||this._domHandler._OnPeerClose(m,h.r),m.Remove(h.r));break;default:console.error("Unknown control message from peer '"+this._id+"': "+h.c),this._domHandler._OnPeerError(this,"unknown control message '"+h.c+"'")}}_OnBinaryMessage(h){this._domHandler.IsHost()?this._OnHostUpdate(h):this._OnPeerUpdate(h)}_OnHostUpdate(h){h=
new DataView(h);let m=0;var c=h.getUint32(m);m+=4;if(1664249200!==c)console.warn("Rejected packet with incorrect magic number (received '"+c+"', expected '1664249200'");else if(c=h.getFloat64(m),m+=8,c+=this._latency,!(3E3<=Math.abs(c-performance.now()))){h.getUint8(m);m+=1;var f=h.getUint8(m);m+=1;var t=[],z=this._domHandler.GetClientValues();for(let l=0;l<f;++l)if(l>=z.length)t.push(0);else{var g=z[l];switch(g.GetPrecision()){case 0:g=h.getFloat64(m);m+=8;break;case 1:g=h.getFloat32(m);m+=4;break;
case 2:g=g.MaybeUnpack(h.getInt16(m));m+=2;break;case 3:g=g.MaybeUnpack(h.getUint8(m));m+=1;break;default:g=h.getFloat32(m),m+=4}t.push(g)}this._AddClientUpdate(c,t)}}_AddClientUpdate(h,m){for(let c=0,f=this._clientStateUpdates.length;c<f;++c){const t=this._clientStateUpdates[c];if(t.timestamp===h)return;if(t.timestamp>h){this._clientStateUpdates.splice(c,0,new d(h,m));return}}this._clientStateUpdates.push(new d(h,m))}Tick(h){if(0!==this._clientStateUpdates.length){for(;2<this._clientStateUpdates.length&&
this._clientStateUpdates[0]!==this._priorUpdate2&&this._clientStateUpdates[0]!==this._priorUpdate&&this._clientStateUpdates[0]!==this._nextUpdate;)this._clientStateUpdates.shift();if(!(this._nextUpdate&&this._nextUpdate.timestamp>h&&this._priorUpdate&&this._priorUpdate.timestamp<h)){this._nextUpdate=null;for(let m=0,c=this._clientStateUpdates.length;m<c;++m){const f=this._clientStateUpdates[m];if(f.timestamp<=h){if(!this._priorUpdate||f.timestamp>this._priorUpdate.timestamp)this._priorUpdate2=this._priorUpdate,
this._priorUpdate=f}else{this._nextUpdate=f;break}}}}}_OnPeerUpdate(h){h=new DataView(h);let m=0;var c=h.getUint32(m);m+=4;1664249200!==c?console.warn("Rejected packet with incorrect magic number (received '"+c+"', expected '1664249200'"):(c=h.getUint32(m),m+=4,0===c?this._HandlePeerUpdate(h,m):1===c?this._HandlePeerEvents(h,m):console.warn("Ignoring packet with incorrect flags (received "+c+", expected 0 or 1"))}_HandlePeerUpdate(h,m){const c=h.getFloat64(m);m+=8;const f=h.getUint16(m);m+=2;for(let l=
0;l<f;++l){var t=h.getUint16(m);m+=2;var z=h.getUint8(m);m+=1;let p=null,u=0;const x=this._domHandler.GetRegisteredObjectByNid(t);x?(p=x.GetNetValues(),u=p.length,1===z&&x._SetHasOverriddenNids(!0)):console.warn("Don't know which object corresponds to NID "+t);t=h.getUint16(m);m+=2;z=h.getUint16(m);m+=2;for(let B=0;B<t;++B){const G=h.getUint16(m);m+=2;if(x){const q=[];let r=m;for(let n=0;n<u;++n){var g=p[n];switch(g.GetPrecision()){case 0:g=h.getFloat64(r);r+=8;break;case 1:g=h.getFloat32(r);r+=4;
break;case 2:g=g.MaybeUnpack(h.getInt16(r));r+=2;break;case 3:g=g.MaybeUnpack(h.getUint8(r));r+=1;break;default:g=h.getFloat32(r),r+=4}q.push(g)}x.AddUpdate(c,G,q)}m+=z}}}_HandlePeerEvents(h,m){const c=h.getFloat64(m);m+=8;const f=h.getUint16(m);m+=2;for(let z=0;z<f;++z){var t=h.getUint16(m);m+=2;const g=this._domHandler.GetRegisteredObjectByNid(t);g||console.warn("Don't know which object corresponds to NID "+t);t=h.getUint16(m);m+=2;for(let l=0;l<t;++l){const p=h.getUint16(m);m+=2;g&&!g.HasOverriddenNids()&&
(this._domHandler._OnInstanceDestroyed(g,p,c),g.RemoveObjectNid(p))}}}Remove(h,m){if(!this._wasRemoved){this._wasRemoved=!0;this._MaybeFireClose(h);this.Send("o",JSON.stringify({c:"disconnect",r:h,k:!!m}));var c=this._dco,f=this._dcr,t=this._dcu,z=this._pc;setTimeout(()=>{e(c);e(f);e(t);e(z)},0);this._pc=this._dcu=this._dcr=this._dco=null;this._isUOpen=this._isROpen=this._isOOpen=!1;this._domHandler._RemovePeer(this)}}HasClientState(h){return this._domHandler.HasClientValueTag(h)}GetClientState(h){h=
this._domHandler.GetClientValueByTag(h);if(!h)return 0;h=h.GetIndex();if(0===this._clientStateUpdates.length)return 0;const m=this._clientStateUpdates[this._clientStateUpdates.length-1].data;return 0>h||h>=m.length?0:m[h]}GetInterpClientState(h){h=h.GetIndex();if(!this._nextUpdate&&!this._priorUpdate)return 0;if(this._nextUpdate&&!this._priorUpdate){var m=this._nextUpdate.data;return 0>h||h>=m.length?0:m[h]}var c=this._domHandler.GetSimulationTime();let f,t;if(!this._nextUpdate&&this._priorUpdate){if(this._priorUpdate2){var z=
this._priorUpdate2.timestamp;m=this._priorUpdate2.data[h];f=this._priorUpdate.timestamp;t=this._priorUpdate.data[h];c>this._priorUpdate.timestamp+250&&(c=this._priorUpdate.timestamp+250);z=w(z,f,c);return a.InterpNetValue(this._domHandler.GetClientValues()[h].GetInterp(),m,t,z,!0)}m=this._priorUpdate.data;return 0>h||h>=m.length?0:m[h]}z=this._priorUpdate.timestamp;m=this._priorUpdate.data[h];f=this._nextUpdate.timestamp;t=this._nextUpdate.data[h];z=w(z,f,c);return a.InterpNetValue(this._domHandler.GetClientValues()[h].GetInterp(),
m,t,z,!1)}}self.C3Peer=y}"use strict";
{const d=self.C3NetValue,a=self.C3Peer,b=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection||window.msRTCPeerConnection,e=window.RTCSessionDescription||window.webkitRTCSessionDescription||window.mozRTCSessionDescription||window.msRTCSessionDescription,k=window.RTCIceCandidate||window.webkitRTCIceCandidate||window.mozRTCIceCandidate||window.msRTCIceCandidate,w=window.RTCDataChannel||window.webkitRTCDataChannel||window.mozRTCDataChannel||window.msRTCDataChannel,y=
[{urls:"stun:stun.l.google.com:19302"}];let h=!1;const m=[];self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(c){super(c,"multiplayer");this._iceServers=[];this._sigWs=null;this._isSignallingLoggedIn=this._isSignallingConnected=!1;this._sigservInfo={protocolrev:0,version:0,name:"",operator:"",motd:""};this._room=this._gameInstance=this._game=this._myAlias=this._myId="";this._allPeers=[];this._peersById=new Map;this._nextPeerNid=0;this._usedPeerNids=new Set;this._hostPeer=
this._selfPeer=null;this._clientDelay=80;this._peerUpdateRateSec=this._hostUpdateRateSec=30;this._lastUpdateTime=0;this._stats={lastSecondTime:0,outboundPerSec:0,outboundCount:0,outboundBandwidthPerSec:0,outboundBandwidthCount:0,inboundPerSec:0,inboundCount:0,inboundBandwidthPerSec:0,inboundBandwidthCount:0};this._dataBuffer=new ArrayBuffer(262144);this._dataView=new DataView(this._dataBuffer);this._allRegisteredObjects=[];this._nextObjectNid=1;this._registeredObjectsByNid=new Map;this._registeredObjectsByRoId=
new Map;this._simPacketLoss=this._simPdv=this._simLatency=0;this._lastTimeDiffs=[];this._hostTimeDiff=this._targetHostTimeDiff=0;this._simDelay=this._targetSimDelay=this._clientDelay;this._allClientValues=[];this._clientValuesByTag=new Map;this._receivedClientValues=!1;this._MergeICEServerList(y);setInterval(()=>this._DoPings(),2E3);window.addEventListener("unload",()=>this.RemoveAllPeers("quit"));this.AddRuntimeMessageHandler("get-supported",()=>this._OnGetSupported());this.AddRuntimeMessageHandler("add-ice-servers",
f=>this._MergeICEServerList(f.list));this.AddRuntimeMessageHandler("simulate-latency",f=>this.SetLatencySimulation(f.latency,f.pdv,f.loss));this.AddRuntimeMessageHandler("set-bandwidth-profile",f=>this.SetBandwidthSettings(f.updateRate,f.delay));this.AddRuntimeMessageHandler("tick",f=>this.Tick(f));this.AddRuntimeMessageHandler("alert",f=>this.Alert(f));this.AddRuntimeMessageHandler("signalling-connect",f=>this.SignallingConnect(f.url));this.AddRuntimeMessageHandler("signalling-disconnect",()=>this.SignallingDisconnect());
this.AddRuntimeMessageHandler("signalling-login",f=>this.SignallingLogin(f.alias));this.AddRuntimeMessageHandler("signalling-join-room",f=>this.SignallingJoinGameRoom(f.game,f.instance,f.room,f.maxClients));this.AddRuntimeMessageHandler("signalling-auto-join-room",f=>this.SignallingAutoJoinGameRoom(f.game,f.instance,f.room,f.maxClients,f.lock));this.AddRuntimeMessageHandler("signalling-leave-room",()=>this.SignallingLeaveRoom());this.AddRuntimeMessageHandler("signalling-list-game-instances",f=>this.SignallingRequestGameInstanceList(f.game));
this.AddRuntimeMessageHandler("signalling-list-rooms",f=>this.SignallingRequestRoomList(f.game,f.instance,f.which));this.AddRuntimeMessageHandler("disconnect-room",()=>this.DisconnectRoom(!0));this.AddRuntimeMessageHandler("peer-send-message",f=>this.OnPeerSendMessage(f));this.AddRuntimeMessageHandler("host-broadcast",f=>this.OnHostBroadcast(f));this.AddRuntimeMessageHandler("kick-peer",f=>this.OnKickPeer(f));this.AddRuntimeMessageHandler("sync-object",f=>this.OnSyncObject(f));this.AddRuntimeMessageHandler("sync-inst-var",
f=>this.OnSyncInstVar(f));this.AddRuntimeMessageHandler("associate-object",f=>this.OnAssociateObject(f));this.AddRuntimeMessageHandler("remove-object-id",f=>this.RemoveObjectId(f.uid));this.AddRuntimeMessageHandler("remove-net-insts",f=>this.OnRemoveNetInsts(f));this.AddRuntimeMessageHandler("remove-object-nid",f=>this.OnRemoveObjectNid(f));this.AddRuntimeMessageHandler("set-client-state",f=>this.SetClientState(f.tag,f.value));this.AddRuntimeMessageHandler("add-client-input-value",f=>this.AddClientInputValue(f.tag,
f.precision,f.interp))}_GetErrorMessage(c){return c?"string"===typeof c?c:"string"===typeof c.message?c.message:"string"===typeof c.details?c.details:"string"===typeof c.data?c.data:"string"===typeof c.type?c.type:"unknown error":"unknown error"}IsConnected(){return this._isSignallingConnected}IsLoggedIn(){return this.IsConnected()&&this._isSignallingLoggedIn}IsInRoom(){return this.IsLoggedIn()&&this._room}IsHost(){return this.IsInRoom()&&this._selfPeer&&this._hostPeer===this._selfPeer}GetMyId(){return this.IsLoggedIn()?
this._myId:""}GetMyAlias(){return this.IsLoggedIn()?this._myAlias:""}GetCurrentGame(){return this.IsLoggedIn()?this._game:""}GetCurrentGameInstance(){return this.IsLoggedIn()?this._gameInstance:""}GetCurrentRoom(){return this.IsInRoom()?this._room:""}GetHostId(){return this._hostPeer?this._hostPeer.GetId():""}GetHostAlias(){return this._hostPeer?this._hostPeer.GetAlias():""}GetHostPeer(){return this._hostPeer}GetSelfPeer(){return this._selfPeer}SetLatencySimulation(c,f,t){this._simLatency=Math.max(c,
0);this._simPdv=Math.max(f,0);this._simPacketLoss=Math.max(t,0)}GetSimulatedPacketLoss(){return this._simPacketLoss}GetSimulatedLatency(){return this._simLatency}GetSimulatedPdv(){return this._simPdv}_OnGetSupported(){return{isSupported:!(!b||!w)}}SignallingConnect(c){if(!this._sigWs&&!this._isSignallingConnected){try{this._sigWs=new WebSocket(c,"c2multiplayer")}catch(f){this._sigWs=null;this._OnSignallingError(f);return}this._sigWs.onopen=()=>{-1===this._sigWs.protocol.indexOf("c2multiplayer")?(this._OnSignallingError("server does not support 'c2multiplayer' protocol"),
this._sigWs.close(1002,"'c2multiplayer' protocol required"),this._sigWs=null,this._isSignallingConnected=!1):this._isSignallingConnected=!0};this._sigWs.onclose=f=>{this._OnSignallingClose();this._isSignallingLoggedIn=this._isSignallingConnected=!1;this._sigWs=null};this._sigWs.onerror=f=>{console.error("Signalling server error: ",f);this._OnSignallingError(f)};this._sigWs.onmessage=f=>{this._OnSignallingMessage(f)}}}SignallingDisconnect(){this._sigWs&&this._isSignallingConnected&&(this._sigWs.close(),
this._sigWs=null,this._isSignallingConnected=!1)}_OnSignallingMessage(c){let f;try{f=JSON.parse(c.data)}catch(t){this._OnSignallingError(t);return}switch(f.message){case "welcome":this._OnSignallingReceiveWelcome(f);break;case "login-ok":this._OnSignallingReceiveLoginOK(f);break;case "join-ok":this._OnSignallingReceiveJoinOK(f);break;case "leave-ok":this._OnSignallingReceiveLeaveOK(f);break;case "kicked":this._OnSignallingReceiveKicked(f);break;case "peer-joined":this._OnSignallingReceivePeerJoined(f);
break;case "peer-quit":this._OnSignallingReceivePeerQuit(f);break;case "icecandidate":this._OnSignallingReceiveIceCandidate(f);break;case "offer":this._OnSignallingReceiveOffer(f);break;case "answer":this._OnSignallingReceiveAnswer(f);break;case "instance-list":this._OnSignallingReceiveInstanceList(f);break;case "room-list":this._OnSignallingReceiveRoomList(f);break;case "error":this._OnSignallingError(f.details);break;default:this._OnSignallingError("received unknown signalling message")}}HasICEServerUrl(c){for(const f of this._iceServers)if(f.urls===
c.urls)return!0;return!1}_MergeICEServerList(c){if(c)for(let f of c)"string"===typeof f&&(f={urls:f}),this.HasICEServerUrl(f)||(f.hasOwnProperty("url")||(f.url=f.urls),this._iceServers.push(f))}GetICEServerList(){return this._iceServers}_OnSignallingError(c){this.PostToRuntime("signalling-error",{message:this._GetErrorMessage(c)})}_OnSignallingClose(){this.PostToRuntime("signalling-close")}_OnSignallingReceiveWelcome(c){if(1>c.protocolrev||1<c.protocolrev)this._OnSignallingError("signalling server protocol revision not supported"),
this.SignallingDisconnect();else{this._myId=c.clientid;var f=this._sigservInfo;f.protocolrev=c.protocolrev;f.version=c.version;f.name=c.name;f.operator=c.operator;f.motd=c.motd;this._MergeICEServerList(c.ice_servers);this.PostToRuntime("signalling-welcome",{myid:this._myId,sigservinfo:{protocolrev:f.protocolrev,version:f.version,name:f.name,operator:f.operator,motd:f.motd}})}}_OnSignallingReceiveLoginOK(c){this._myAlias=c.alias;this._isSignallingLoggedIn=!0;this.PostToRuntime("signalling-login-ok",
{myalias:this._myAlias})}GetNextObjectNid(){return this._nextObjectNid++}AllocatePeerNid(){if(this.IsHost()){do this._nextPeerNid++,65535<this._nextPeerNid&&(this._nextPeerNid=0);while(this._usedPeerNids.has(this._nextPeerNid));var c=this._nextPeerNid;this._usedPeerNids.add(c);return c}}FreePeerNid(c){this.IsHost()&&this._usedPeerNids.delete(c)}_OnSignallingReceiveJoinOK(c){this.RemoveAllPeers("disconnect");this._game=c.game;this._gameInstance=c.instance;this._room=c.room;this._selfPeer=new a(this,
this._myId,this._myAlias);c.host?(this._hostPeer=this._selfPeer,this._nextPeerNid=0,this._usedPeerNids.clear(),this._hostPeer._SetNid(this.AllocatePeerNid())):(this._hostTimeDiff=this._targetHostTimeDiff=this._lastTimeDiffs.length=0,this._clientDelay=80,this._peerUpdateRateSec=this._hostUpdateRateSec=30,this._simDelay=this._targetSimDelay=this._clientDelay,this._hostPeer=new a(this,c.hostid,c.hostalias),this._hostPeer.Connect());this.PostToRuntime("signalling-join-ok",{isHost:!!c.host,hostId:this._hostPeer.GetId(),
hostAlias:this._hostPeer.GetAlias(),game:this._game,gameInstance:this._gameInstance,room:this._room})}_OnSignallingReceiveLeaveOK(c){this._room="";this.PostToRuntime("signalling-leave-ok")}_OnSignallingReceiveKicked(c){this.DisconnectRoom();this._room="";this.PostToRuntime("signalling-kicked")}_OnSignallingReceivePeerJoined(c){if(this._isSignallingLoggedIn&&this._room&&this.IsHost()){var f=this._peersById.get(c.peerid);f&&f.Remove("rejoin");(new a(this,c.peerid,c.peeralias)).Connect()}}_OnSignallingReceivePeerQuit(c){if(this._isSignallingLoggedIn&&
this._room&&this.IsHost()){var f=this._peersById.get(c.id);f&&f.Remove(c.reason)}}_OnSignallingReceiveIceCandidate(c){if(this._isSignallingLoggedIn&&this._room){var f=this._peersById.get(c.from);f&&f._AddICECandidate(new k(c.icecandidate))}}_OnSignallingReceiveOffer(c){if(this._isSignallingLoggedIn&&this._room&&!this.IsHost()&&this._selfPeer&&this._hostPeer&&this._hostPeer.HasPeerConnection()&&c.from===this._hostPeer.GetId()){var f=this._hostPeer.GetPeerConnection();f.setRemoteDescription(new e(c.offer)).then(()=>
{f.createAnswer().then(t=>{f.setLocalDescription(t);this.SignallingSend({message:"answer",toclientid:this._hostPeer.GetId(),answer:t})}).catch(t=>{console.error("Peer error creating answer: ",t);this._OnPeerError(this._selfPeer,"could not create answer to host offer")})}).catch(t=>{console.error("Peer error setting remote description: ",t);this._OnPeerError(this._selfPeer,"could not set remote description")})}}_OnSignallingReceiveAnswer(c){if(this._isSignallingLoggedIn&&this._room&&this.IsHost()){var f=
this._peersById.get(c.from);f&&f.GetPeerConnection().setRemoteDescription(new e(c.answer)).catch(t=>{console.error("Host error setting remote description: ",t)})}}_OnSignallingReceiveInstanceList(c){this.PostToRuntime("signalling-instance-list",{list:c.list})}_OnSignallingReceiveRoomList(c){this.PostToRuntime("signalling-room-list",{list:c.list})}SignallingSend(c){this._sigWs&&this._isSignallingConnected&&this._sigWs.send(JSON.stringify(c))}SignallingLogin(c){this._isSignallingLoggedIn||this.SignallingSend({message:"login",
protocolrev:1,alias:c})}SignallingJoinGameRoom(c,f,t,z){this._isSignallingLoggedIn&&!this._room&&this.SignallingSend({message:"join",game:c,instance:f,room:t,max_clients:z})}SignallingAutoJoinGameRoom(c,f,t,z,g){this._isSignallingLoggedIn&&!this._room&&this.SignallingSend({message:"auto-join",game:c,instance:f,room:t,max_clients:z,lock_when_full:g})}SignallingLeaveRoom(){this._isSignallingLoggedIn&&this.SignallingSend({message:"leave"})}SignallingConfirmPeer(c){this._isSignallingLoggedIn&&this.IsHost()&&
this.SignallingSend({message:"confirm-peer",id:c})}SignallingRequestGameInstanceList(c){this._sigWs&&this._isSignallingConnected&&this.SignallingSend({message:"list-instances",game:c})}SignallingRequestRoomList(c,f,t){this._sigWs&&this._isSignallingConnected&&this.SignallingSend({message:"list-rooms",game:c,instance:f,which:t})}DisconnectRoom(c){this._hostTimeDiff=this._targetHostTimeDiff=this._lastTimeDiffs.length=0;this.RemoveAllPeers("disconnect");for(const f of this._allRegisteredObjects)f.ClearAllNetInstances();
c&&this.SignallingLeaveRoom()}_AddPeer(c){this._allPeers.push(c);this._peersById.set(c.GetId(),c);this.PostToRuntime("add-peer",{id:c.GetId(),alias:c.GetAlias()})}_RemovePeer(c){this.PostToRuntime("remove-peer",{id:c.GetId()});this.IsHost()&&this.FreePeerNid(c.GetNid());const f=this._allPeers.indexOf(c);-1<f&&this._allPeers.splice(f,1);this._peersById.delete(c.GetId());this._hostPeer===c&&(this._hostPeer=null,this.RemoveAllPeers("host quit"));this._selfPeer===c&&(this._selfPeer=null,this._room="",
this.RemoveAllPeers("disconnect"))}RemoveAllPeers(c){if(!h){for(h=!0;this._allPeers.length;)this._allPeers[0].Remove(c);h=!1}}GetPeerById(c){return this._peersById.get(c)||null}GetAliasFromId(c){return(c=this._peersById.get(c))?c.GetAlias():""}GetPeerByNid(c){for(const f of this._allPeers)if(f.GetNid()===c)return f;return null}OnHostBroadcast(c){const f=c.fromId,t=c.tag,z=c.message;c=c.mode;const g=this.GetPeerById(f);this.HostBroadcast(c,JSON.stringify({c:"m",t,f,m:z}),g)}HostBroadcast(c,f,t){if(this.IsHost()){var z=
this._allPeers.slice(0);for(const g of z)g&&g!==this._selfPeer&&g!==t&&g.Send(c,f)}}_DoPings(){const c=performance.now();if(this.IsHost()){m.push(...this._allPeers);for(const f of m)f&&f!==this._selfPeer&&f.SendPing(c,!1);m.length=0}else this._hostPeer&&this._hostPeer.SendPing(c,!1)}AddRegisteredObject(c){this._allRegisteredObjects.push(c);this._registeredObjectsByRoId.set(c.GetRoId(),c);this._registeredObjectsByNid.set(c.GetNid(),c)}GetRegisteredObjectsMap(){const c={};for(const [f,t]of this._registeredObjectsByNid.entries())c[t.GetSid()]=
{nid:f,nvs:t.GetNetValuesJson()};return c}MapObjectNids(c){this._registeredObjectsByNid.clear();for(const f of this._allRegisteredObjects)if(c.hasOwnProperty(f.GetSid().toString())){const t=c[f.GetSid().toString()];f._SetNid(t.nid);this._registeredObjectsByNid.set(t.nid,f);f.SetNetValuesFrom(t.nvs)}else console.warn("Could not map object SID '"+f.GetSid()+"' - host did not send NID for it"),f._SetNid(-1)}GetRegisteredObjectByNid(c){return this._registeredObjectsByNid.get(c)||null}Tick(c){if(!this.IsInRoom())return null;
c=c.dt;const f=performance.now();var t=this.IsHost()?this._hostUpdateRateSec:this._peerUpdateRateSec;f-this._lastUpdateTime>=1E3/t-5&&(this.SendUpdate(f),this._lastUpdateTime=f);t=this._stats;1E3<=f-t.lastSecondTime&&(t.outboundPerSec=t.outboundCount,t.outboundBandwidthPerSec=t.outboundBandwidthCount,t.inboundPerSec=t.inboundCount,t.inboundBandwidthPerSec=t.inboundBandwidthCount,t.outboundCount=0,t.outboundBandwidthCount=0,t.inboundCount=0,t.inboundBandwidthCount=0,t.lastSecondTime+=1E3,500<f-t.lastSecondTime&&
(t.lastSecondTime=f),this.PostToRuntime("stats",{stats:{outboundPerSec:t.outboundPerSec,outboundBandwidthPerSec:t.outboundBandwidthPerSec,inboundPerSec:t.inboundPerSec,inboundBandwidthPerSec:t.inboundBandwidthPerSec}}));this.IsHost()||(this._hostTimeDiff<this._targetHostTimeDiff?(this._hostTimeDiff+=10*c,this._hostTimeDiff>this._targetHostTimeDiff&&(this._hostTimeDiff=this._targetHostTimeDiff)):this._hostTimeDiff>this._targetHostTimeDiff&&(this._hostTimeDiff-=10*c,this._hostTimeDiff<this._targetHostTimeDiff&&
(this._hostTimeDiff=this._targetHostTimeDiff)),this._simDelay<this._targetSimDelay?(this._simDelay+=30*c,this._simDelay>this._targetSimDelay&&(this._simDelay=this._targetSimDelay)):this._simDelay>this._targetSimDelay&&(this._simDelay-=30*c,this._simDelay<this._targetSimDelay&&(this._simDelay=this._targetSimDelay)));c=this.GetSimulationTime();for(const z of this._allPeers)z.Tick(c);for(const z of this._allRegisteredObjects)z.Tick();return{simulationTime:this.GetSimulationTime(),hostInputArrivalTime:this.GetHostInputArrivalTime(),
clientDelay:this._clientDelay,peerData:this._GetPeerRuntimeData(),roData:this._GetRegisteredObjectRuntimeData(),isReadyForInput:this.IsReadyForInput()}}_GetPeerRuntimeData(){const c={};for(const f of this._allPeers){const t={};for(const z of this._allClientValues)t[z.GetTag()]=f.GetInterpClientState(z);c[f.GetId()]={nid:f.GetNid(),latency:f.GetLatency(),pdv:f.GetPdv(),clientState:t}}return c}_GetRegisteredObjectRuntimeData(){const c={};for(const f of this._allRegisteredObjects)c[f.GetRoId()]=f.GetRuntimeData();
return c}async SendUpdate(c){this.IsHost()?(await this._SendHostUpdate(c),this._SendHostEvents(c)):await this._SendClientUpdate(c)}async _OnBeforeClientUpdate(){const c=await this.PostToRuntimeAsync("before-client-update");for(const f of c.clientStateUpdates)this.SetClientState(f.tag,f.value)}async _SendClientUpdate(c){this.IsReadyForInput()&&await this._OnBeforeClientUpdate();if(this._selfPeer&&this._receivedClientValues){var f=this._dataView,t=0,z=this._allClientValues,g=this._selfPeer.GetLocalClientState(),
l=c-this._selfPeer.GetLastStateChange(),p=c-this._selfPeer.GetLastStateTransmit();if(100>l||(1E3>l?95<=p:495<=p)){f.setUint32(t,1664249200);t+=4;f.setFloat64(t,c+this._hostTimeDiff);t+=8;f.setUint8(t,0);t+=1;f.setUint8(t,z.length);t+=1;for(let u=0,x=z.length;u<x;++u)l=z[u],p=0,u<g.length&&(p=l.Clamp(g[u])),t=l.Write(f,t,p);this._selfPeer._SetLastStateTransmit(c);this._hostPeer.Send("u",new Uint8Array(this._dataBuffer.slice(0,t)))}}}async _SendHostUpdate(c){const f=this._dataView;let t=0,z=0;const g=
await this.PostToRuntimeAsync("get-object-info",{ros:this._allRegisteredObjects.map(l=>l.GetRuntimeInfoRequest())});for(const l of this._allRegisteredObjects){const p=l.GetRoId();g.hasOwnProperty(p)&&(l.UpdateData(g[p],c),0<l.GetNumberToTransmit()&&z++)}if(0!==z){f.setUint32(t,1664249200);t+=4;f.setUint32(t,0);t+=4;f.setFloat64(t,c);t+=8;f.setUint16(t,z);t+=2;for(const l of this._allRegisteredObjects)0<l.GetNumberToTransmit()&&(t=l.WriteData(f,t,c));this.HostBroadcast("u",new Uint8Array(this._dataBuffer.slice(0,
t)),null)}}_SendHostEvents(c){const f=this._dataView;let t=0,z=0;for(const g of this._allRegisteredObjects)g.GetDeadNids().length&&z++;if(0!==z){f.setUint32(t,1664249200);t+=4;f.setUint32(t,1);t+=4;f.setFloat64(t,c);t+=8;f.setUint16(t,z);t+=2;for(const g of this._allRegisteredObjects)if(c=g.GetDeadNids(),c.length){f.setUint16(t,g.GetNid());t+=2;f.setUint16(t,c.length);t+=2;for(const l of c)f.setUint16(t,l),t+=2;c.length=0}this.HostBroadcast("r",new Uint8Array(this._dataBuffer.slice(0,t)),null)}}AddHostTime(c,
f,t,z){if(!this.IsHost()){this._targetSimDelay=z+this._clientDelay;c=c+t-f;0===this._lastTimeDiffs.length&&(this._hostTimeDiff=c,this._simDelay=this._targetSimDelay);this._lastTimeDiffs.push(c);30<this._lastTimeDiffs.length&&this._lastTimeDiffs.shift();m.push(...this._lastTimeDiffs);m.sort((g,l)=>g-l);c=0;f=m.length;4<=m.length&&6>=m.length?(++c,--f):6<m.length&&19>=m.length?(c+=2,f-=2):19<m.length&&(c+=5,f-=5);t=0;for(z=c;z<f;++z)t+=m[z];this._targetHostTimeDiff=t/(f-c);m.length=0}}GetSimulationTime(){return this.IsHost()?
performance.now()-this._clientDelay:performance.now()+this._hostTimeDiff-this._simDelay}GetHostTime(){return this.IsHost()?performance.now():performance.now()+this._hostTimeDiff}GetHostInputArrivalTime(){return this.IsHost()?performance.now():performance.now()+this._hostTimeDiff+this._simDelay}SetClientState(c,f){if(!this.IsHost()&&this._selfPeer&&this._receivedClientValues&&(c=this._clientValuesByTag.get(c))){c=c.GetIndex();var t=this._selfPeer.GetLocalClientState();t.length<c+1&&(t.length=c+1);
t[c]!==f&&(t[c]=f,this._selfPeer._SetLastStateChange(performance.now()))}}AddClientInputValue(c,f,t){f=new d(this._allClientValues.length,t,f,c,null);this._clientValuesByTag.set(c,f);this._allClientValues.push(f)}GetClientValues(){return this._allClientValues}GetClientValuesJson(){const c=[];for(const f of this._allClientValues)c.push({tag:f.GetTag(),precision:f.GetPrecision(),interp:f.GetInterp()});return c}MapClientValues(c){this._clientValuesByTag.clear();this._allClientValues.length=0;for(let t=
0,z=c.length;t<z;++t){var f=c[t];f=new d(t,f.interp,f.precision,f.tag,null);this._clientValuesByTag.set(f.GetTag(),f);this._allClientValues.push(f)}this._receivedClientValues=!0}RemoveObjectId(c){for(const f of this._allRegisteredObjects)f.RemoveObjectId(c)}peers(){return this._allPeers}GetPeerCount(){return this.IsInRoom()?this._allPeers.length:0}GetPeerAt(c){c=Math.floor(c);return!this.IsInRoom()||0>c||c>=this._allPeers.length?null:this._allPeers[c]}IsReadyForInput(){return this.IsInRoom()?this.IsHost()?
!0:0!==this._targetHostTimeDiff:!1}SetBandwidthSettings(c,f){this.IsInRoom()||(this._peerUpdateRateSec=this._hostUpdateRateSec=c,this._clientDelay=f)}_OnPeerOpen(c){this.PostToRuntime("peer-open",{id:c.GetId(),alias:c.GetAlias()})}OnPeerSendMessage(c){const f=c.tag,t=c.message,z=c.mode;(c=this.GetPeerById(c.id))&&c.Send(z,JSON.stringify({c:"m",t:f,m:t}))}_OnPeerClose(c,f){this.PostToRuntime("peer-close",{id:c.GetId(),alias:c.GetAlias(),reason:f||"unknown"})}_OnPeerError(c,f){console.error(`[Multiplayer] Peer '${c.GetAlias()}' (${c.GetId()}) error: `,
f)}_OnPeerMessage(c,f){c=f.f||c.GetId();this.PostToRuntime("peer-message",{tag:f.t,fromId:c,fromAlias:this.GetAliasFromId(c),content:f.m})}_OnInstanceDestroyed(c,f,t){this.PostToRuntime("instance-destroyed",{roId:c.GetRoId(),nid:f,timestamp:t})}OnKickPeer(c){if(this.IsHost()){var f=c.reason;(c=this.GetPeerById(c.id))&&c.Remove(f,!0)}}StatIncOutboundCount(){this._stats.outboundCount++}StatAddOutboundBandwidthCount(c){this._stats.outboundBandwidthCount+=c}StatIncInboundCount(){this._stats.inboundCount++}StatAddInboundBandwidthCount(c){this._stats.inboundBandwidthCount+=
c}SetClientDelay(c){this._clientDelay=c}GetClientDelay(){return this._clientDelay}SetPeerUpdateRateSec(c){this._peerUpdateRateSec=c}GetPeerUpdateRateSec(){return this._peerUpdateRateSec}OnSyncObject(c){const f=c.data,t=c.precision,z=c.bandwidth;for(const g of c.objectClasses)c=new self.C3RegisteredObject(this,g.roId,g.sid,z),1===f?(c.AddValue(1,t,"x"),c.AddValue(1,t,"y")):2===f?c.AddValue(2,t,"a"):3===f&&(c.AddValue(1,t,"x"),c.AddValue(1,t,"y"),c.AddValue(2,t,"a"))}Alert(c){alert(c.message)}OnSyncInstVar(c){const f=
c.precision,t=c.interp,z=c.cvt;for(const g of c.syncData)this._registeredObjectsByRoId.get(g.roId).AddValue(t,f,"iv",g.varIndex,z)}OnAssociateObject(c){var f=c.peerId;const t=c.instUid;c=this._registeredObjectsByRoId.get(c.roId);f=this._peersById.get(f);c&&f&&this.IsHost()&&c.OverrideNid(t,f.GetNid())}OnRemoveNetInsts(c){for(const [f,t]of Object.entries(c))if(c=this._registeredObjectsByRoId.get(parseInt(f,10)))for(const z of t)c.RemoveObjectNid(z)}OnRemoveObjectNid(c){const f=c.nid;(c=this._registeredObjectsByRoId.get(c.roId))&&
c.RemoveObjectNid(f)}})}"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(d){super(d,"mouse");this.AddRuntimeMessageHandlers([["cursor",a=>this._OnChangeCursorStyle(a)],["request-pointer-lock",()=>this._OnRequestPointerLock()],["release-pointer-lock",()=>this._OnReleasePointerLock()]]);document.addEventListener("pointerlockchange",a=>this._OnPointerLockChange());document.addEventListener("pointerlockerror",a=>this._OnPointerLockError())}_OnChangeCursorStyle(d){document.documentElement.style.cursor=d}_OnRequestPointerLock(){this._iRuntime.GetCanvas().requestPointerLock()}_OnReleasePointerLock(){document.exitPointerLock()}_OnPointerLockChange(){this.PostToRuntime("pointer-lock-change",
{"has-pointer-lock":!!document.pointerLockElement})}_OnPointerLockError(){this.PostToRuntime("pointer-lock-error",{"has-pointer-lock":!!document.pointerLockElement})}});"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(d){super(d,"browser");this._exportType="";this.AddRuntimeMessageHandlers([["get-initial-state",a=>this._OnGetInitialState(a)],["ready-for-sw-messages",()=>this._OnReadyForSWMessages()],["alert",a=>this._OnAlert(a)],["close",()=>this._OnClose()],["set-focus",a=>this._OnSetFocus(a)],["vibrate",a=>this._OnVibrate(a)],["lock-orientation",a=>this._OnLockOrientation(a)],["unlock-orientation",()=>this._OnUnlockOrientation()],
["navigate",a=>this._OnNavigate(a)],["request-fullscreen",a=>this._OnRequestFullscreen(a)],["exit-fullscreen",()=>this._OnExitFullscreen()],["set-hash",a=>this._OnSetHash(a)]]);window.addEventListener("online",()=>this._OnOnlineStateChanged(!0));window.addEventListener("offline",()=>this._OnOnlineStateChanged(!1));window.addEventListener("hashchange",()=>this._OnHashChange());document.addEventListener("backbutton",()=>this._OnCordovaBackButton())}_OnGetInitialState(d){this._exportType=d.exportType;
return{location:location.toString(),isOnline:!!navigator.onLine,referrer:document.referrer,title:document.title,isCookieEnabled:!!navigator.cookieEnabled,screenWidth:screen.width,screenHeight:screen.height,windowOuterWidth:window.outerWidth,windowOuterHeight:window.outerHeight,isScirraArcade:"undefined"!==typeof window.is_scirra_arcade}}_OnReadyForSWMessages(){window.C3_RegisterSW&&window.OfflineClientInfo&&window.OfflineClientInfo.SetMessageCallback(d=>this.PostToRuntime("sw-message",d.data))}_OnOnlineStateChanged(d){this.PostToRuntime("online-state",
{isOnline:d})}_OnCordovaBackButton(){this.PostToRuntime("backbutton")}GetNWjsWindow(){return"nwjs"===this._exportType?nw.Window.get():null}_OnAlert(d){alert(d.message)}_OnClose(){navigator.app&&navigator.app.exitApp?navigator.app.exitApp():navigator.device&&navigator.device.exitApp?navigator.device.exitApp():window.close()}_OnSetFocus(d){d=d.isFocus;if("nwjs"===this._exportType){const a=this.GetNWjsWindow();d?a.focus():a.blur()}else d?window.focus():window.blur()}_OnVibrate(d){navigator.vibrate&&
navigator.vibrate(d.pattern)}_OnLockOrientation(d){d=d.orientation;if(screen.orientation&&screen.orientation.lock)screen.orientation.lock(d).catch(a=>console.warn("[Construct 3] Failed to lock orientation: ",a));else try{let a=!1;screen.lockOrientation?a=screen.lockOrientation(d):screen.webkitLockOrientation?a=screen.webkitLockOrientation(d):screen.mozLockOrientation?a=screen.mozLockOrientation(d):screen.msLockOrientation&&(a=screen.msLockOrientation(d));a||console.warn("[Construct 3] Failed to lock orientation")}catch(a){console.warn("[Construct 3] Failed to lock orientation: ",
a)}}_OnUnlockOrientation(){try{screen.orientation&&screen.orientation.unlock?screen.orientation.unlock():screen.unlockOrientation?screen.unlockOrientation():screen.webkitUnlockOrientation?screen.webkitUnlockOrientation():screen.mozUnlockOrientation?screen.mozUnlockOrientation():screen.msUnlockOrientation&&screen.msUnlockOrientation()}catch(d){}}_OnNavigate(d){var a=d.type;if("back"===a)navigator.app&&navigator.app.backHistory?navigator.app.backHistory():window.history.back();else if("forward"===a)window.history.forward();
else if("reload"===a)location.reload();else if("url"===a){a=d.url;const b=d.target;d=d.exportType;self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(a,"_system"):"preview"===d||"windows-webview2"===d?window.open(a,"_blank"):this._isScirraArcade||(2===b?window.top.location=a:1===b?window.parent.location=a:window.location=a)}else"new-window"===a&&(a=d.url,d=d.tag,self.cordova&&self.cordova.InAppBrowser?self.cordova.InAppBrowser.open(a,"_system"):window.open(a,d))}_OnRequestFullscreen(d){if("windows-webview2"===
this._exportType||"macos-wkwebview"===this._exportType)self.RuntimeInterface._SetWrapperIsFullscreenFlag(!0),this._iRuntime._SendWrapperMessage({type:"set-fullscreen",fullscreen:!0});else{const a={navigationUI:"auto"};d=d.navUI;1===d?a.navigationUI="hide":2===d&&(a.navigationUI="show");d=document.documentElement;d.requestFullscreen?d.requestFullscreen(a):d.mozRequestFullScreen?d.mozRequestFullScreen(a):d.msRequestFullscreen?d.msRequestFullscreen(a):d.webkitRequestFullScreen&&("undefined"!==typeof Element.ALLOW_KEYBOARD_INPUT?
d.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):d.webkitRequestFullScreen())}}_OnExitFullscreen(){"windows-webview2"===this._exportType||"macos-wkwebview"===this._exportType?(self.RuntimeInterface._SetWrapperIsFullscreenFlag(!1),this._iRuntime._SendWrapperMessage({type:"set-fullscreen",fullscreen:!1})):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.webkitCancelFullScreen&&
document.webkitCancelFullScreen()}_OnSetHash(d){location.hash=d.hash}_OnHashChange(){this.PostToRuntime("hashchange",{location:location.toString()})}});"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(d){super(d,"touch");this.AddRuntimeMessageHandler("request-permission",a=>this._OnRequestPermission(a))}async _OnRequestPermission(d){d=d.type;let a=!0;0===d?a=await this._RequestOrientationPermission():1===d&&(a=await this._RequestMotionPermission());this.PostToRuntime("permission-result",{type:d,result:a})}async _RequestOrientationPermission(){if(!self.DeviceOrientationEvent||!self.DeviceOrientationEvent.requestPermission)return!0;
try{return"granted"===await self.DeviceOrientationEvent.requestPermission()}catch(d){return console.warn("[Touch] Failed to request orientation permission: ",d),!1}}async _RequestMotionPermission(){if(!self.DeviceMotionEvent||!self.DeviceMotionEvent.requestPermission)return!0;try{return"granted"===await self.DeviceMotionEvent.requestPermission()}catch(d){return console.warn("[Touch] Failed to request motion permission: ",d),!1}}});"use strict";
{const d=180/Math.PI;self.AudioDOMHandler=class extends self.DOMHandler{constructor(a){super(a,"audio");this._destinationNode=this._audioContext=null;this._hasAttachedUnblockEvents=this._hasUnblocked=!1;this._unblockFunc=()=>this._UnblockAudioContext();this._audioBuffers=[];this._audioInstances=[];this._lastAudioInstance=null;this._lastPlayedTag="";this._lastTickCount=-1;this._pendingTags=new Map;this._masterVolume=1;this._isSilent=!1;this._timeScaleMode=0;this._timeScale=1;this._gameTime=0;this._panningModel=
"HRTF";this._distanceModel="inverse";this._refDistance=600;this._maxDistance=1E4;this._rolloffFactor=1;this._hasAnySoftwareDecodedMusic=this._playMusicAsSound=!1;this._supportsWebMOpus=this._iRuntime.IsAudioFormatSupported("audio/webm; codecs=opus");this._effects=new Map;this._analysers=new Set;this._isPendingPostFxState=!1;this._microphoneTag="";this._microphoneSource=null;self.C3Audio_OnMicrophoneStream=(b,e)=>this._OnMicrophoneStream(b,e);this._destMediaStreamNode=null;self.C3Audio_GetOutputStream=
()=>this._OnGetOutputStream();self.C3Audio_DOMInterface=this;this.AddRuntimeMessageHandlers([["create-audio-context",b=>this._CreateAudioContext(b)],["play",b=>this._Play(b)],["stop",b=>this._Stop(b)],["stop-all",()=>this._StopAll()],["set-paused",b=>this._SetPaused(b)],["set-volume",b=>this._SetVolume(b)],["fade-volume",b=>this._FadeVolume(b)],["set-master-volume",b=>this._SetMasterVolume(b)],["set-muted",b=>this._SetMuted(b)],["set-silent",b=>this._SetSilent(b)],["set-looping",b=>this._SetLooping(b)],
["set-playback-rate",b=>this._SetPlaybackRate(b)],["seek",b=>this._Seek(b)],["preload",b=>this._Preload(b)],["unload",b=>this._Unload(b)],["unload-all",()=>this._UnloadAll()],["set-suspended",b=>this._SetSuspended(b)],["get-suspended",b=>this._GetSuspended(b)],["add-effect",b=>this._AddEffect(b)],["set-effect-param",b=>this._SetEffectParam(b)],["remove-effects",b=>this._RemoveEffects(b)],["tick",b=>this._OnTick(b)],["load-state",b=>this._OnLoadState(b)]])}async _CreateAudioContext(a){a.isiOSCordova&&
(this._playMusicAsSound=!0);this._timeScaleMode=a.timeScaleMode;this._panningModel=["equalpower","HRTF","soundfield"][a.panningModel];this._distanceModel=["linear","inverse","exponential"][a.distanceModel];this._refDistance=a.refDistance;this._maxDistance=a.maxDistance;this._rolloffFactor=a.rolloffFactor;var b={latencyHint:a.latencyHint};this.SupportsWebMOpus()||(b.sampleRate=48E3);if("undefined"!==typeof AudioContext)this._audioContext=new AudioContext(b);else if("undefined"!==typeof webkitAudioContext)this._audioContext=
new webkitAudioContext(b);else throw Error("Web Audio API not supported");this._AttachUnblockEvents();this._audioContext.onstatechange=()=>{"running"!==this._audioContext.state&&this._AttachUnblockEvents()};this._destinationNode=this._audioContext.createGain();this._destinationNode.connect(this._audioContext.destination);b=a.listenerPos;this._audioContext.listener.setPosition(b[0],b[1],b[2]);this._audioContext.listener.setOrientation(0,0,1,0,-1,0);self.C3_GetAudioContextCurrentTime=()=>this.GetAudioCurrentTime();
try{await Promise.all(a.preloadList.map(e=>this._GetAudioBuffer(e.originalUrl,e.url,e.type,!1)))}catch(e){console.error("[Construct 3] Preloading sounds failed: ",e)}return{sampleRate:this._audioContext.sampleRate}}_AttachUnblockEvents(){this._hasAttachedUnblockEvents||(this._hasUnblocked=!1,window.addEventListener("pointerup",this._unblockFunc,!0),window.addEventListener("touchend",this._unblockFunc,!0),window.addEventListener("click",this._unblockFunc,!0),window.addEventListener("keydown",this._unblockFunc,
!0),this._hasAttachedUnblockEvents=!0)}_DetachUnblockEvents(){this._hasAttachedUnblockEvents&&(this._hasUnblocked=!0,window.removeEventListener("pointerup",this._unblockFunc,!0),window.removeEventListener("touchend",this._unblockFunc,!0),window.removeEventListener("click",this._unblockFunc,!0),window.removeEventListener("keydown",this._unblockFunc,!0),this._hasAttachedUnblockEvents=!1)}_UnblockAudioContext(){if(!this._hasUnblocked){var a=this._audioContext;"suspended"===a.state&&a.resume&&a.resume();
var b=a.createBuffer(1,220,22050),e=a.createBufferSource();e.buffer=b;e.connect(a.destination);e.start(0);"running"===a.state&&this._DetachUnblockEvents()}}GetAudioContext(){return this._audioContext}GetAudioCurrentTime(){return this._audioContext.currentTime}GetDestinationNode(){return this._destinationNode}GetDestinationForTag(a){return(a=this._effects.get(a.toLowerCase()))?a[0].GetInputNode():this.GetDestinationNode()}AddEffectForTag(a,b){a=a.toLowerCase();let e=this._effects.get(a);e||(e=[],this._effects.set(a,
e));b._SetIndex(e.length);b._SetTag(a);e.push(b);this._ReconnectEffects(a)}_ReconnectEffects(a){let b=this.GetDestinationNode();const e=this._effects.get(a);if(e&&e.length){b=e[0].GetInputNode();for(let k=0,w=e.length;k<w;++k){const y=e[k];k+1===w?y.ConnectTo(this.GetDestinationNode()):y.ConnectTo(e[k+1].GetInputNode())}}for(const k of this.audioInstancesByTag(a))k.Reconnect(b);this._microphoneSource&&this._microphoneTag===a&&(this._microphoneSource.disconnect(),this._microphoneSource.connect(b))}GetMasterVolume(){return this._masterVolume}IsSilent(){return this._isSilent}GetTimeScaleMode(){return this._timeScaleMode}GetTimeScale(){return this._timeScale}GetGameTime(){return this._gameTime}IsPlayMusicAsSound(){return this._playMusicAsSound}SupportsWebMOpus(){return this._supportsWebMOpus}_SetHasAnySoftwareDecodedMusic(){this._hasAnySoftwareDecodedMusic=
!0}GetPanningModel(){return this._panningModel}GetDistanceModel(){return this._distanceModel}GetReferenceDistance(){return this._refDistance}GetMaxDistance(){return this._maxDistance}GetRolloffFactor(){return this._rolloffFactor}DecodeAudioData(a,b){return b?this._iRuntime._WasmDecodeWebMOpus(a).then(e=>{const k=this._audioContext.createBuffer(1,e.length,48E3);k.getChannelData(0).set(e);return k}):new Promise((e,k)=>{this._audioContext.decodeAudioData(a,e,k)})}TryPlayMedia(a){this._iRuntime.TryPlayMedia(a)}RemovePendingPlay(a){this._iRuntime.RemovePendingPlay(a)}ReleaseInstancesForBuffer(a){let b=
0;for(let e=0,k=this._audioInstances.length;e<k;++e){const w=this._audioInstances[e];this._audioInstances[b]=w;w.GetBuffer()===a?w.Release():++b}this._audioInstances.length=b}ReleaseAllMusicBuffers(){let a=0;for(let b=0,e=this._audioBuffers.length;b<e;++b){const k=this._audioBuffers[b];this._audioBuffers[a]=k;k.IsMusic()?k.Release():++a}this._audioBuffers.length=a}*audioInstancesByTag(a){if(a)for(const b of this._audioInstances)self.AudioDOMHandler.EqualsNoCase(b.GetTag(),a)&&(yield b);else this._lastAudioInstance&&
!this._lastAudioInstance.HasEnded()&&(yield this._lastAudioInstance)}async _GetAudioBuffer(a,b,e,k,w){for(const y of this._audioBuffers)if(y.GetUrl()===b)return await y.Load(),y;if(w)return null;k&&(this._playMusicAsSound||this._hasAnySoftwareDecodedMusic)&&this.ReleaseAllMusicBuffers();a=self.C3AudioBuffer.Create(this,a,b,e,k);this._audioBuffers.push(a);await a.Load();return a}async _GetAudioInstance(a,b,e,k,w){for(const y of this._audioInstances)if(y.GetUrl()===b&&(y.CanBeRecycled()||w))return y.SetTag(k),
y;a=(await this._GetAudioBuffer(a,b,e,w)).CreateInstance(k);this._audioInstances.push(a);return a}_AddPendingTag(a){let b=this._pendingTags.get(a);if(!b){let e=null;b={pendingCount:0,promise:new Promise(k=>e=k),resolve:e};this._pendingTags.set(a,b)}b.pendingCount++}_RemovePendingTag(a){const b=this._pendingTags.get(a);if(!b)throw Error("expected pending tag");b.pendingCount--;0===b.pendingCount&&(b.resolve(),this._pendingTags.delete(a))}TagReady(a){a||(a=this._lastPlayedTag);return(a=this._pendingTags.get(a))?
a.promise:Promise.resolve()}_MaybeStartTicking(){if(0<this._analysers.size)this._StartTicking();else for(const a of this._audioInstances)if(a.IsActive()){this._StartTicking();break}}Tick(){for(var a of this._analysers)a.Tick();a=this.GetAudioCurrentTime();for(var b of this._audioInstances)b.Tick(a);b=this._audioInstances.filter(e=>e.IsActive()).map(e=>e.GetState());this.PostToRuntime("state",{tickCount:this._lastTickCount,audioInstances:b,analysers:[...this._analysers].map(e=>e.GetData())});0===b.length&&
0===this._analysers.size&&this._StopTicking()}PostTrigger(a,b,e){this.PostToRuntime("trigger",{type:a,tag:b,aiid:e})}async _Play(a){const b=a.originalUrl,e=a.url,k=a.type,w=a.isMusic,y=a.tag,h=a.isLooping,m=a.vol,c=a.pos,f=a.panning;let t=a.off;0<t&&!a.trueClock&&(this._audioContext.getOutputTimestamp?(a=this._audioContext.getOutputTimestamp(),t=t-a.performanceTime/1E3+a.contextTime):t=t-performance.now()/1E3+this._audioContext.currentTime);this._lastPlayedTag=y;this._AddPendingTag(y);try{this._lastAudioInstance=
await this._GetAudioInstance(b,e,k,y,w),f?(this._lastAudioInstance.SetPannerEnabled(!0),this._lastAudioInstance.SetPan(f.x,f.y,f.angle,f.innerAngle,f.outerAngle,f.outerGain),f.hasOwnProperty("uid")&&this._lastAudioInstance.SetUID(f.uid)):this._lastAudioInstance.SetPannerEnabled(!1),this._lastAudioInstance.Play(h,m,c,t)}catch(z){console.error("[Construct 3] Audio: error starting playback: ",z);return}finally{this._RemovePendingTag(y)}this._StartTicking()}_Stop(a){a=a.tag;for(const b of this.audioInstancesByTag(a))b.Stop()}_StopAll(){for(const a of this._audioInstances)a.Stop()}_SetPaused(a){const b=
a.tag;a=a.paused;for(const e of this.audioInstancesByTag(b))a?e.Pause():e.Resume();this._MaybeStartTicking()}_SetVolume(a){const b=a.tag;a=a.vol;for(const e of this.audioInstancesByTag(b))e.SetVolume(a)}async _FadeVolume(a){const b=a.tag,e=a.vol,k=a.duration;a=a.stopOnEnd;await this.TagReady(b);for(const w of this.audioInstancesByTag(b))w.FadeVolume(e,k,a);this._MaybeStartTicking()}_SetMasterVolume(a){this._masterVolume=a.vol;for(const b of this._audioInstances)b._UpdateVolume()}_SetMuted(a){const b=
a.tag;a=a.isMuted;for(const e of this.audioInstancesByTag(b))e.SetMuted(a)}_SetSilent(a){this._isSilent=a.isSilent;this._iRuntime.SetSilent(this._isSilent);for(const b of this._audioInstances)b._UpdateMuted()}_SetLooping(a){const b=a.tag;a=a.isLooping;for(const e of this.audioInstancesByTag(b))e.SetLooping(a)}async _SetPlaybackRate(a){const b=a.tag;a=a.rate;await this.TagReady(b);for(const e of this.audioInstancesByTag(b))e.SetPlaybackRate(a)}async _Seek(a){const b=a.tag;a=a.pos;await this.TagReady(b);
for(const e of this.audioInstancesByTag(b))e.Seek(a)}async _Preload(a){const b=a.originalUrl,e=a.url,k=a.type;a=a.isMusic;try{await this._GetAudioInstance(b,e,k,"",a)}catch(w){console.error("[Construct 3] Audio: error preloading: ",w)}}async _Unload(a){if(a=await this._GetAudioBuffer("",a.url,a.type,a.isMusic,!0))a.Release(),a=this._audioBuffers.indexOf(a),-1!==a&&this._audioBuffers.splice(a,1)}_UnloadAll(){for(const a of this._audioBuffers)a.Release();this._audioBuffers.length=0}_SetSuspended(a){a=
a.isSuspended;!a&&this._audioContext.resume&&this._audioContext.resume();for(const b of this._audioInstances)b.SetSuspended(a);a&&this._audioContext.suspend&&this._audioContext.suspend()}_GetSuspended(){return this._audioContext?this._audioContext.state:"suspended"}_OnTick(a){this._timeScale=a.timeScale;this._gameTime=a.gameTime;this._lastTickCount=a.tickCount;if(0!==this._timeScaleMode)for(var b of this._audioInstances)b._UpdatePlaybackRate();(b=a.listenerPos)&&this._audioContext.listener.setPosition(b[0],
b[1],b[2]);for(const e of a.instPans){a=e.uid;for(const k of this._audioInstances)k.GetUID()===a&&k.SetPanXYA(e.x,e.y,e.angle)}}async _AddEffect(a){var b=a.type;const e=a.tag;var k=a.params;if("filter"===b)k=new self.C3AudioFilterFX(this,...k);else if("delay"===b)k=new self.C3AudioDelayFX(this,...k);else if("convolution"===b){b=null;try{b=await this._GetAudioBuffer(a.bufferOriginalUrl,a.bufferUrl,a.bufferType,!1)}catch(w){console.log("[Construct 3] Audio: error loading convolution: ",w);return}k=
new self.C3AudioConvolveFX(this,b.GetAudioBuffer(),...k);k._SetBufferInfo(a.bufferOriginalUrl,a.bufferUrl,a.bufferType)}else if("flanger"===b)k=new self.C3AudioFlangerFX(this,...k);else if("phaser"===b)k=new self.C3AudioPhaserFX(this,...k);else if("gain"===b)k=new self.C3AudioGainFX(this,...k);else if("tremolo"===b)k=new self.C3AudioTremoloFX(this,...k);else if("ringmod"===b)k=new self.C3AudioRingModFX(this,...k);else if("distortion"===b)k=new self.C3AudioDistortionFX(this,...k);else if("compressor"===
b)k=new self.C3AudioCompressorFX(this,...k);else if("analyser"===b)k=new self.C3AudioAnalyserFX(this,...k);else throw Error("invalid effect type");this.AddEffectForTag(e,k);this._PostUpdatedFxState()}_SetEffectParam(a){const b=a.index,e=a.param,k=a.value,w=a.ramp,y=a.time;a=this._effects.get(a.tag);!a||0>b||b>=a.length||(a[b].SetParam(e,k,w,y),this._PostUpdatedFxState())}_RemoveEffects(a){a=a.tag.toLowerCase();const b=this._effects.get(a);if(b&&b.length){for(const e of b)e.Release();this._effects.delete(a);
this._ReconnectEffects(a)}}_AddAnalyser(a){this._analysers.add(a);this._MaybeStartTicking()}_RemoveAnalyser(a){this._analysers.delete(a)}_PostUpdatedFxState(){this._isPendingPostFxState||(this._isPendingPostFxState=!0,Promise.resolve().then(()=>this._DoPostUpdatedFxState()))}_DoPostUpdatedFxState(){const a={};for(const [b,e]of this._effects)a[b]=e.map(k=>k.GetState());this.PostToRuntime("fxstate",{fxstate:a});this._isPendingPostFxState=!1}async _OnLoadState(a){const b=a.saveLoadMode;if(3!==b)for(var e of this._audioInstances)e.IsMusic()&&
1===b||(e.IsMusic()||2!==b)&&e.Stop();for(const k of this._effects.values())for(const w of k)w.Release();this._effects.clear();this._timeScale=a.timeScale;this._gameTime=a.gameTime;e=a.listenerPos;this._audioContext.listener.setPosition(e[0],e[1],e[2]);this._isSilent=a.isSilent;this._iRuntime.SetSilent(this._isSilent);this._masterVolume=a.masterVolume;e=[];for(const k of Object.values(a.effects))e.push(Promise.all(k.map(w=>this._AddEffect(w))));await Promise.all(e);await Promise.all(a.playing.map(k=>
this._LoadAudioInstance(k,b)));this._MaybeStartTicking()}async _LoadAudioInstance(a,b){if(3!==b){var e=a.bufferOriginalUrl,k=a.bufferUrl,w=a.bufferType,y=a.isMusic,h=a.tag,m=a.isLooping,c=a.volume,f=a.playbackTime;if(!y||1!==b)if(y||2!==b){b=null;try{b=await this._GetAudioInstance(e,k,w,h,y)}catch(t){console.error("[Construct 3] Audio: error loading audio state: ",t);return}b.LoadPanState(a.pan);b.Play(m,c,f,0);a.isPlaying||b.Pause();b._LoadAdditionalState(a)}}}_OnMicrophoneStream(a,b){this._microphoneSource&&
this._microphoneSource.disconnect();this._microphoneTag=b.toLowerCase();this._microphoneSource=this._audioContext.createMediaStreamSource(a);this._microphoneSource.connect(this.GetDestinationForTag(this._microphoneTag))}_OnGetOutputStream(){this._destMediaStreamNode||(this._destMediaStreamNode=this._audioContext.createMediaStreamDestination(),this._destinationNode.connect(this._destMediaStreamNode));return this._destMediaStreamNode.stream}static EqualsNoCase(a,b){return a.length!==b.length?!1:a===
b?!0:a.toLowerCase()===b.toLowerCase()}static ToDegrees(a){return a*d}static DbToLinearNoCap(a){return Math.pow(10,a/20)}static DbToLinear(a){return Math.max(Math.min(self.AudioDOMHandler.DbToLinearNoCap(a),1),0)}static LinearToDbNoCap(a){return Math.log(a)/Math.log(10)*20}static LinearToDb(a){return self.AudioDOMHandler.LinearToDbNoCap(Math.max(Math.min(a,1),0))}static e4(a,b){return 1-Math.exp(-b*a)}};self.RuntimeInterface.AddDOMHandlerClass(self.AudioDOMHandler)}"use strict";
self.C3AudioBuffer=class{constructor(d,a,b,e,k){this._audioDomHandler=d;this._originalUrl=a;this._url=b;this._type=e;this._isMusic=k;this._api="";this._loadState="not-loaded";this._loadPromise=null}Release(){this._loadState="not-loaded";this._loadPromise=this._audioDomHandler=null}static Create(d,a,b,e,k){const w="audio/webm; codecs=opus"===e&&!d.SupportsWebMOpus();k&&w&&d._SetHasAnySoftwareDecodedMusic();return!k||d.IsPlayMusicAsSound()||w?new self.C3WebAudioBuffer(d,a,b,e,k,w):new self.C3Html5AudioBuffer(d,
a,b,e,k)}CreateInstance(d){return"html5"===this._api?new self.C3Html5AudioInstance(this._audioDomHandler,this,d):new self.C3WebAudioInstance(this._audioDomHandler,this,d)}_Load(){}Load(){this._loadPromise||(this._loadPromise=this._Load());return this._loadPromise}IsLoaded(){}IsLoadedAndDecoded(){}HasFailedToLoad(){return"failed"===this._loadState}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}GetApi(){return this._api}GetOriginalUrl(){return this._originalUrl}GetUrl(){return this._url}GetContentType(){return this._type}IsMusic(){return this._isMusic}GetDuration(){}};
"use strict";
self.C3Html5AudioBuffer=class extends self.C3AudioBuffer{constructor(d,a,b,e,k){super(d,a,b,e,k);this._api="html5";this._audioElem=new Audio;this._audioElem.crossOrigin="anonymous";this._audioElem.autoplay=!1;this._audioElem.preload="auto";this._loadReject=this._loadResolve=null;this._reachedCanPlayThrough=!1;this._audioElem.addEventListener("canplaythrough",()=>this._reachedCanPlayThrough=!0);this._outNode=this.GetAudioContext().createGain();this._mediaSourceNode=null;this._audioElem.addEventListener("canplay",()=>
{this._loadResolve&&(this._loadState="loaded",this._loadResolve(),this._loadReject=this._loadResolve=null);!this._mediaSourceNode&&this._audioElem&&(this._mediaSourceNode=this.GetAudioContext().createMediaElementSource(this._audioElem),this._mediaSourceNode.connect(this._outNode))});this.onended=null;this._audioElem.addEventListener("ended",()=>{if(this.onended)this.onended()});this._audioElem.addEventListener("error",w=>this._OnError(w))}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this);
this._outNode.disconnect();this._outNode=null;this._mediaSourceNode.disconnect();this._mediaSourceNode=null;this._audioElem&&!this._audioElem.paused&&this._audioElem.pause();this._audioElem=this.onended=null;super.Release()}_Load(){this._loadState="loading";return new Promise((d,a)=>{this._loadResolve=d;this._loadReject=a;this._audioElem.src=this._url})}_OnError(d){console.error(`[Construct 3] Audio '${this._url}' error: `,d);this._loadReject&&(this._loadState="failed",this._loadReject(d),this._loadReject=
this._loadResolve=null)}IsLoaded(){const d=4<=this._audioElem.readyState;d&&(this._reachedCanPlayThrough=!0);return d||this._reachedCanPlayThrough}IsLoadedAndDecoded(){return this.IsLoaded()}GetAudioElement(){return this._audioElem}GetOutputNode(){return this._outNode}GetDuration(){return this._audioElem.duration}};"use strict";
self.C3WebAudioBuffer=class extends self.C3AudioBuffer{constructor(d,a,b,e,k,w){super(d,a,b,e,k);this._api="webaudio";this._audioBuffer=this._audioData=null;this._needsSoftwareDecode=!!w}Release(){this._audioDomHandler.ReleaseInstancesForBuffer(this);this._audioBuffer=this._audioData=null;super.Release()}async _Fetch(){if(this._audioData)return this._audioData;var d=this._audioDomHandler.GetRuntimeInterface();if("cordova"===d.GetExportType()&&d.IsRelativeURL(this._url)&&d.IsFileProtocol())this._audioData=
await d.CordovaFetchLocalFileAsArrayBuffer(this._url);else{d=await fetch(this._url);if(!d.ok)throw Error(`error fetching audio data: ${d.status} ${d.statusText}`);this._audioData=await d.arrayBuffer()}}async _Decode(){if(this._audioBuffer)return this._audioBuffer;this._audioBuffer=await this._audioDomHandler.DecodeAudioData(this._audioData,this._needsSoftwareDecode);this._audioData=null}async _Load(){try{this._loadState="loading",await this._Fetch(),await this._Decode(),this._loadState="loaded"}catch(d){this._loadState=
"failed",console.error(`[Construct 3] Failed to load audio '${this._url}': `,d)}}IsLoaded(){return!(!this._audioData&&!this._audioBuffer)}IsLoadedAndDecoded(){return!!this._audioBuffer}GetAudioBuffer(){return this._audioBuffer}GetDuration(){return this._audioBuffer?this._audioBuffer.duration:0}};"use strict";
{let d=0;self.C3AudioInstance=class{constructor(a,b,e){this._audioDomHandler=a;this._buffer=b;this._tag=e;this._aiId=d++;this._gainNode=this.GetAudioContext().createGain();this._gainNode.connect(this.GetDestinationNode());this._pannerNode=null;this._isPannerEnabled=!1;this._pannerPosition=[0,0,0];this._pannerOrientation=[0,0,0];this._isStopped=!0;this._isLooping=this._resumeMe=this._isPaused=!1;this._volume=1;this._isMuted=!1;this._playbackRate=1;a=this._audioDomHandler.GetTimeScaleMode();this._isTimescaled=
1===a&&!this.IsMusic()||2===a;this._fadeEndTime=this._instUid=-1;this._stopOnFadeEnd=!1}Release(){this._buffer=this._audioDomHandler=null;this._pannerNode&&(this._pannerNode.disconnect(),this._pannerNode=null);this._gainNode.disconnect();this._gainNode=null}GetAudioContext(){return this._audioDomHandler.GetAudioContext()}GetDestinationNode(){return this._audioDomHandler.GetDestinationForTag(this._tag)}GetMasterVolume(){return this._audioDomHandler.GetMasterVolume()}GetCurrentTime(){return this._isTimescaled?
this._audioDomHandler.GetGameTime():performance.now()/1E3}GetOriginalUrl(){return this._buffer.GetOriginalUrl()}GetUrl(){return this._buffer.GetUrl()}GetContentType(){return this._buffer.GetContentType()}GetBuffer(){return this._buffer}IsMusic(){return this._buffer.IsMusic()}SetTag(a){this._tag=a}GetTag(){return this._tag}GetAiId(){return this._aiId}HasEnded(){}CanBeRecycled(){}IsPlaying(){return!this._isStopped&&!this._isPaused&&!this.HasEnded()}IsActive(){return!this._isStopped&&!this.HasEnded()}GetPlaybackTime(){}GetDuration(a){let b=
this._buffer.GetDuration();a&&(b/=this._playbackRate||.001);return b}Play(a,b,e,k){}Stop(){}Pause(){}IsPaused(){return this._isPaused}Resume(){}SetVolume(a){this._volume=a;this._gainNode.gain.cancelScheduledValues(0);this._fadeEndTime=-1;this._gainNode.gain.value=this.GetOverallVolume()}FadeVolume(a,b,e){if(!this.IsMuted()){a*=this.GetMasterVolume();var k=this._gainNode.gain;k.cancelScheduledValues(0);var w=this._audioDomHandler.GetAudioCurrentTime();b=w+b;k.setValueAtTime(k.value,w);k.linearRampToValueAtTime(a,
b);this._volume=a;this._fadeEndTime=b;this._stopOnFadeEnd=e}}_UpdateVolume(){this.SetVolume(this._volume)}Tick(a){-1!==this._fadeEndTime&&a>=this._fadeEndTime&&(this._fadeEndTime=-1,this._stopOnFadeEnd&&this.Stop(),this._audioDomHandler.PostTrigger("fade-ended",this._tag,this._aiId))}GetOverallVolume(){const a=this._volume*this.GetMasterVolume();return isFinite(a)?a:0}SetMuted(a){a=!!a;this._isMuted!==a&&(this._isMuted=a,this._UpdateMuted())}IsMuted(){return this._isMuted}IsSilent(){return this._audioDomHandler.IsSilent()}_UpdateMuted(){}SetLooping(a){}IsLooping(){return this._isLooping}SetPlaybackRate(a){this._playbackRate!==
a&&(this._playbackRate=a,this._UpdatePlaybackRate())}_UpdatePlaybackRate(){}GetPlaybackRate(){return this._playbackRate}Seek(a){}SetSuspended(a){}SetPannerEnabled(a){a=!!a;this._isPannerEnabled!==a&&((this._isPannerEnabled=a)?(this._pannerNode||(this._pannerNode=this.GetAudioContext().createPanner(),this._pannerNode.panningModel=this._audioDomHandler.GetPanningModel(),this._pannerNode.distanceModel=this._audioDomHandler.GetDistanceModel(),this._pannerNode.refDistance=this._audioDomHandler.GetReferenceDistance(),
this._pannerNode.maxDistance=this._audioDomHandler.GetMaxDistance(),this._pannerNode.rolloffFactor=this._audioDomHandler.GetRolloffFactor()),this._gainNode.disconnect(),this._gainNode.connect(this._pannerNode),this._pannerNode.connect(this.GetDestinationNode())):(this._pannerNode.disconnect(),this._gainNode.disconnect(),this._gainNode.connect(this.GetDestinationNode())))}SetPan(a,b,e,k,w,y){this._isPannerEnabled&&(this.SetPanXYA(a,b,e),a=self.AudioDOMHandler.ToDegrees,this._pannerNode.coneInnerAngle=
a(k),this._pannerNode.coneOuterAngle=a(w),this._pannerNode.coneOuterGain=y)}SetPanXYA(a,b,e){this._isPannerEnabled&&(this._pannerPosition[0]=a,this._pannerPosition[1]=b,this._pannerPosition[2]=0,this._pannerOrientation[0]=Math.cos(e),this._pannerOrientation[1]=Math.sin(e),this._pannerOrientation[2]=0,this._pannerNode.setPosition(...this._pannerPosition),this._pannerNode.setOrientation(...this._pannerOrientation))}SetUID(a){this._instUid=a}GetUID(){return this._instUid}GetResumePosition(){}Reconnect(a){const b=
this._pannerNode||this._gainNode;b.disconnect();b.connect(a)}GetState(){return{aiid:this.GetAiId(),tag:this._tag,duration:this.GetDuration(),volume:this._volume,isPlaying:this.IsPlaying(),playbackTime:this.GetPlaybackTime(),playbackRate:this.GetPlaybackRate(),uid:this._instUid,bufferOriginalUrl:this.GetOriginalUrl(),bufferUrl:"",bufferType:this.GetContentType(),isMusic:this.IsMusic(),isLooping:this.IsLooping(),isMuted:this.IsMuted(),resumePosition:this.GetResumePosition(),pan:this.GetPanState()}}_LoadAdditionalState(a){this.SetPlaybackRate(a.playbackRate);
this.SetMuted(a.isMuted)}GetPanState(){if(!this._pannerNode)return null;const a=this._pannerNode;return{pos:this._pannerPosition,orient:this._pannerOrientation,cia:a.coneInnerAngle,coa:a.coneOuterAngle,cog:a.coneOuterGain,uid:this._instUid}}LoadPanState(a){if(a){this.SetPannerEnabled(!0);a=this._pannerNode;var b=a.pos;this._pannerPosition[0]=b[0];this._pannerPosition[1]=b[1];this._pannerPosition[2]=b[2];b=a.orient;this._pannerOrientation[0]=b[0];this._pannerOrientation[1]=b[1];this._pannerOrientation[2]=
b[2];a.setPosition(...this._pannerPosition);a.setOrientation(...this._pannerOrientation);a.coneInnerAngle=a.cia;a.coneOuterAngle=a.coa;a.coneOuterGain=a.cog;this._instUid=a.uid}else this.SetPannerEnabled(!1)}}}"use strict";
self.C3Html5AudioInstance=class extends self.C3AudioInstance{constructor(d,a,b){super(d,a,b);this._buffer.GetOutputNode().connect(this._gainNode);this._buffer.onended=()=>this._OnEnded()}Release(){this.Stop();this._buffer.GetOutputNode().disconnect();super.Release()}GetAudioElement(){return this._buffer.GetAudioElement()}_OnEnded(){this._isStopped=!0;this._instUid=-1;this._audioDomHandler.PostTrigger("ended",this._tag,this._aiId)}HasEnded(){return this.GetAudioElement().ended}CanBeRecycled(){return this._isStopped?
!0:this.HasEnded()}GetPlaybackTime(){let d=this.GetAudioElement().currentTime;this._isLooping||(d=Math.min(d,this.GetDuration()));return d}Play(d,a,b,e){e=this.GetAudioElement();1!==e.playbackRate&&(e.playbackRate=1);e.loop!==d&&(e.loop=d);this.SetVolume(a);e.muted&&(e.muted=!1);if(e.currentTime!==b)try{e.currentTime=b}catch(k){console.warn(`[Construct 3] Exception seeking audio '${this._buffer.GetUrl()}' to position '${b}': `,k)}this._audioDomHandler.TryPlayMedia(e);this._isPaused=this._isStopped=
!1;this._isLooping=d;this._playbackRate=1}Stop(){const d=this.GetAudioElement();d.paused||d.pause();this._audioDomHandler.RemovePendingPlay(d);this._isStopped=!0;this._isPaused=!1;this._instUid=-1}Pause(){if(!(this._isPaused||this._isStopped||this.HasEnded())){var d=this.GetAudioElement();d.paused||d.pause();this._audioDomHandler.RemovePendingPlay(d);this._isPaused=!0}}Resume(){!this._isPaused||this._isStopped||this.HasEnded()||(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._isPaused=
!1)}_UpdateMuted(){this.GetAudioElement().muted=this._isMuted||this.IsSilent()}SetLooping(d){d=!!d;this._isLooping!==d&&(this._isLooping=d,this.GetAudioElement().loop=d)}_UpdatePlaybackRate(){let d=this._playbackRate;this._isTimescaled&&(d*=this._audioDomHandler.GetTimeScale());try{this.GetAudioElement().playbackRate=d}catch(a){console.warn(`[Construct 3] Unable to set playback rate '${d}':`,a)}}Seek(d){if(!this._isStopped&&!this.HasEnded())try{this.GetAudioElement().currentTime=d}catch(a){console.warn(`[Construct 3] Error seeking audio to '${d}': `,
a)}}GetResumePosition(){return this.GetPlaybackTime()}SetSuspended(d){d?this.IsPlaying()?(this.GetAudioElement().pause(),this._resumeMe=!0):this._resumeMe=!1:this._resumeMe&&(this._audioDomHandler.TryPlayMedia(this.GetAudioElement()),this._resumeMe=!1)}};"use strict";
self.C3WebAudioInstance=class extends self.C3AudioInstance{constructor(d,a,b){super(d,a,b);this._bufferSource=null;this._onended_handler=e=>this._OnEnded(e);this._hasPlaybackEnded=!0;this._activeSource=null;this._resumePosition=this._playFromSeekPos=this._playStartTime=0;this._muteVol=1}Release(){this.Stop();this._ReleaseBufferSource();this._onended_handler=null;super.Release()}_ReleaseBufferSource(){this._bufferSource&&this._bufferSource.disconnect();this._activeSource=this._bufferSource=null}_OnEnded(d){this._isPaused||
this._resumeMe||d.target!==this._activeSource||(this._isStopped=this._hasPlaybackEnded=!0,this._instUid=-1,this._ReleaseBufferSource(),this._audioDomHandler.PostTrigger("ended",this._tag,this._aiId))}HasEnded(){return!this._isStopped&&this._bufferSource&&this._bufferSource.loop||this._isPaused?!1:this._hasPlaybackEnded}CanBeRecycled(){return!this._bufferSource||this._isStopped?!0:this.HasEnded()}GetPlaybackTime(){let d;d=this._isPaused?this._resumePosition:this._playFromSeekPos+(this.GetCurrentTime()-
this._playStartTime)*this._playbackRate;this._isLooping||(d=Math.min(d,this.GetDuration()));return d}Play(d,a,b,e){this._muteVol=1;this.SetVolume(a);this._ReleaseBufferSource();this._bufferSource=this.GetAudioContext().createBufferSource();this._bufferSource.buffer=this._buffer.GetAudioBuffer();this._bufferSource.connect(this._gainNode);this._activeSource=this._bufferSource;this._bufferSource.onended=this._onended_handler;this._bufferSource.loop=d;this._bufferSource.start(e,b);this._isPaused=this._isStopped=
this._hasPlaybackEnded=!1;this._isLooping=d;this._playbackRate=1;this._playStartTime=this.GetCurrentTime();this._playFromSeekPos=b}Stop(){if(this._bufferSource)try{this._bufferSource.stop(0)}catch(d){}this._isStopped=!0;this._isPaused=!1;this._instUid=-1}Pause(){this._isPaused||this._isStopped||this.HasEnded()||(this._resumePosition=this.GetPlaybackTime(),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._isPaused=!0,this._bufferSource.stop(0))}Resume(){!this._isPaused||this._isStopped||
this.HasEnded()||(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._bufferSource.start(0,this._resumePosition),this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=this._resumePosition,
this._isPaused=!1)}GetOverallVolume(){return super.GetOverallVolume()*this._muteVol}_UpdateMuted(){this._muteVol=this._isMuted||this.IsSilent()?0:1;this._UpdateVolume()}SetLooping(d){d=!!d;this._isLooping!==d&&(this._isLooping=d,this._bufferSource&&(this._bufferSource.loop=d))}_UpdatePlaybackRate(){let d=this._playbackRate;this._isTimescaled&&(d*=this._audioDomHandler.GetTimeScale());this._bufferSource&&(this._bufferSource.playbackRate.value=d)}Seek(d){this._isStopped||this.HasEnded()||(this._isPaused?
this._resumePosition=d:(this.Pause(),this._resumePosition=d,this.Resume()))}GetResumePosition(){return this._resumePosition}SetSuspended(d){d?this.IsPlaying()?(this._resumeMe=!0,this._resumePosition=this.GetPlaybackTime(),this._isLooping&&(this._resumePosition%=this.GetDuration()),this._bufferSource.stop(0)):this._resumeMe=!1:this._resumeMe&&(this._ReleaseBufferSource(),this._bufferSource=this.GetAudioContext().createBufferSource(),this._bufferSource.buffer=this._buffer.GetAudioBuffer(),this._bufferSource.connect(this._gainNode),
this._activeSource=this._bufferSource,this._bufferSource.onended=this._onended_handler,this._bufferSource.loop=this._isLooping,this._UpdateVolume(),this._UpdatePlaybackRate(),this._bufferSource.start(0,this._resumePosition),this._playStartTime=this.GetCurrentTime(),this._playFromSeekPos=this._resumePosition,this._resumeMe=!1)}_LoadAdditionalState(d){super._LoadAdditionalState(d);this._resumePosition=d.resumePosition}};"use strict";
{class d{constructor(a){this._audioDomHandler=a;this._audioContext=a.GetAudioContext();this._index=-1;this._type=this._tag="";this._params=null}Release(){this._audioContext=null}_SetIndex(a){this._index=a}GetIndex(){return this._index}_SetTag(a){this._tag=a}GetTag(){return this._tag}CreateGain(){return this._audioContext.createGain()}GetInputNode(){}ConnectTo(a){}SetAudioParam(a,b,e,k){a.cancelScheduledValues(0);if(0===k)a.value=b;else{var w=this._audioContext.currentTime;k+=w;switch(e){case 0:a.setValueAtTime(b,
k);break;case 1:a.setValueAtTime(a.value,w);a.linearRampToValueAtTime(b,k);break;case 2:a.setValueAtTime(a.value,w),a.exponentialRampToValueAtTime(b,k)}}}GetState(){return{type:this._type,tag:this._tag,params:this._params}}}self.C3AudioFilterFX=class extends d{constructor(a,b,e,k,w,y,h){super(a);this._type="filter";this._params=[b,e,k,w,y,h];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=h;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-h;this._filterNode=
this._audioContext.createBiquadFilter();this._filterNode.type=b;this._filterNode.frequency.value=e;this._filterNode.detune.value=k;this._filterNode.Q.value=w;this._filterNode.gain.vlaue=y;this._inputNode.connect(this._filterNode);this._inputNode.connect(this._dryNode);this._filterNode.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._filterNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);
this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[5]=b;this.SetAudioParam(this._wetNode.gain,b,e,k);this.SetAudioParam(this._dryNode.gain,1-b,e,k);break;case 1:this._params[1]=b;this.SetAudioParam(this._filterNode.frequency,b,e,k);break;case 2:this._params[2]=b;this.SetAudioParam(this._filterNode.detune,b,e,k);break;case 3:this._params[3]=b;this.SetAudioParam(this._filterNode.Q,
b,e,k);break;case 4:this._params[4]=b,this.SetAudioParam(this._filterNode.gain,b,e,k)}}};self.C3AudioDelayFX=class extends d{constructor(a,b,e,k){super(a);this._type="delay";this._params=[b,e,k];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=k;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-k;this._mainNode=this.CreateGain();this._delayNode=this._audioContext.createDelay(b);this._delayNode.delayTime.value=b;this._delayGainNode=this.CreateGain();
this._delayGainNode.gain.value=e;this._inputNode.connect(this._mainNode);this._inputNode.connect(this._dryNode);this._mainNode.connect(this._wetNode);this._mainNode.connect(this._delayNode);this._delayNode.connect(this._delayGainNode);this._delayGainNode.connect(this._mainNode)}Release(){this._inputNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();this._mainNode.disconnect();this._delayNode.disconnect();this._delayGainNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();
this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,e,k){const w=self.AudioDOMHandler.DbToLinear;switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[2]=b;this.SetAudioParam(this._wetNode.gain,b,e,k);this.SetAudioParam(this._dryNode.gain,1-b,e,k);break;case 4:this._params[1]=w(b);this.SetAudioParam(this._delayGainNode.gain,w(b),e,k);break;case 5:this._params[0]=b,this.SetAudioParam(this._delayNode.delayTime,b,e,k)}}};
self.C3AudioConvolveFX=class extends d{constructor(a,b,e,k){super(a);this._type="convolution";this._params=[e,k];this._bufferType=this._bufferUrl=this._bufferOriginalUrl="";this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=k;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-k;this._convolveNode=this._audioContext.createConvolver();this._convolveNode.normalize=e;this._convolveNode.buffer=b;this._inputNode.connect(this._convolveNode);this._inputNode.connect(this._dryNode);
this._convolveNode.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._convolveNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0),this._params[1]=b,this.SetAudioParam(this._wetNode.gain,b,e,k),this.SetAudioParam(this._dryNode.gain,
1-b,e,k)}}_SetBufferInfo(a,b,e){this._bufferOriginalUrl=a;this._bufferUrl=b;this._bufferType=e}GetState(){const a=super.GetState();a.bufferOriginalUrl=this._bufferOriginalUrl;a.bufferUrl="";a.bufferType=this._bufferType;return a}};self.C3AudioFlangerFX=class extends d{constructor(a,b,e,k,w,y){super(a);this._type="flanger";this._params=[b,e,k,w,y];this._inputNode=this.CreateGain();this._dryNode=this.CreateGain();this._dryNode.gain.value=1-y/2;this._wetNode=this.CreateGain();this._wetNode.gain.value=
y/2;this._feedbackNode=this.CreateGain();this._feedbackNode.gain.value=w;this._delayNode=this._audioContext.createDelay(b+e);this._delayNode.delayTime.value=b;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=k;this._oscGainNode=this.CreateGain();this._oscGainNode.gain.value=e;this._inputNode.connect(this._delayNode);this._inputNode.connect(this._dryNode);this._delayNode.connect(this._wetNode);this._delayNode.connect(this._feedbackNode);this._feedbackNode.connect(this._delayNode);
this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._delayNode.delayTime);this._oscNode.start(0)}Release(){this._oscNode.stop(0);this._inputNode.disconnect();this._delayNode.disconnect();this._oscNode.disconnect();this._oscGainNode.disconnect();this._dryNode.disconnect();this._wetNode.disconnect();this._feedbackNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,
b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[4]=b;this.SetAudioParam(this._wetNode.gain,b/2,e,k);this.SetAudioParam(this._dryNode.gain,1-b/2,e,k);break;case 6:this._params[1]=b/1E3;this.SetAudioParam(this._oscGainNode.gain,b/1E3,e,k);break;case 7:this._params[2]=b;this.SetAudioParam(this._oscNode.frequency,b,e,k);break;case 8:this._params[3]=b/100,this.SetAudioParam(this._feedbackNode.gain,b/100,e,k)}}};self.C3AudioPhaserFX=class extends d{constructor(a,b,e,k,w,y,h){super(a);
this._type="phaser";this._params=[b,e,k,w,y,h];this._inputNode=this.CreateGain();this._dryNode=this.CreateGain();this._dryNode.gain.value=1-h/2;this._wetNode=this.CreateGain();this._wetNode.gain.value=h/2;this._filterNode=this._audioContext.createBiquadFilter();this._filterNode.type="allpass";this._filterNode.frequency.value=b;this._filterNode.detune.value=e;this._filterNode.Q.value=k;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=y;this._oscGainNode=this.CreateGain();
this._oscGainNode.gain.value=w;this._inputNode.connect(this._filterNode);this._inputNode.connect(this._dryNode);this._filterNode.connect(this._wetNode);this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._filterNode.frequency);this._oscNode.start(0)}Release(){this._oscNode.stop(0);this._inputNode.disconnect();this._filterNode.disconnect();this._oscNode.disconnect();this._oscGainNode.disconnect();this._dryNode.disconnect();this._wetNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();
this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[5]=b;this.SetAudioParam(this._wetNode.gain,b/2,e,k);this.SetAudioParam(this._dryNode.gain,1-b/2,e,k);break;case 1:this._params[0]=b;this.SetAudioParam(this._filterNode.frequency,b,e,k);break;case 2:this._params[1]=b;this.SetAudioParam(this._filterNode.detune,b,e,k);break;case 3:this._params[2]=b;this.SetAudioParam(this._filterNode.Q,
b,e,k);break;case 6:this._params[3]=b;this.SetAudioParam(this._oscGainNode.gain,b,e,k);break;case 7:this._params[4]=b,this.SetAudioParam(this._oscNode.frequency,b,e,k)}}};self.C3AudioGainFX=class extends d{constructor(a,b){super(a);this._type="gain";this._params=[b];this._node=this.CreateGain();this._node.gain.value=b}Release(){this._node.disconnect();super.Release()}ConnectTo(a){this._node.disconnect();this._node.connect(a)}GetInputNode(){return this._node}SetParam(a,b,e,k){const w=self.AudioDOMHandler.DbToLinear;
switch(a){case 4:this._params[0]=w(b),this.SetAudioParam(this._node.gain,w(b),e,k)}}};self.C3AudioTremoloFX=class extends d{constructor(a,b,e){super(a);this._type="tremolo";this._params=[b,e];this._node=this.CreateGain();this._node.gain.value=1-e/2;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=b;this._oscGainNode=this.CreateGain();this._oscGainNode.gain.value=e/2;this._oscNode.connect(this._oscGainNode);this._oscGainNode.connect(this._node.gain);this._oscNode.start(0)}Release(){this._oscNode.stop(0);
this._oscNode.disconnect();this._oscGainNode.disconnect();this._node.disconnect();super.Release()}ConnectTo(a){this._node.disconnect();this._node.connect(a)}GetInputNode(){return this._node}SetParam(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[1]=b;this.SetAudioParam(this._node.gain,1-b/2,e,k);this.SetAudioParam(this._oscGainNode.gain,b/2,e,k);break;case 7:this._params[0]=b,this.SetAudioParam(this._oscNode.frequency,b,e,k)}}};self.C3AudioRingModFX=class extends d{constructor(a,
b,e){super(a);this._type="ringmod";this._params=[b,e];this._inputNode=this.CreateGain();this._wetNode=this.CreateGain();this._wetNode.gain.value=e;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-e;this._ringNode=this.CreateGain();this._ringNode.gain.value=0;this._oscNode=this._audioContext.createOscillator();this._oscNode.frequency.value=b;this._oscNode.connect(this._ringNode.gain);this._oscNode.start(0);this._inputNode.connect(this._ringNode);this._inputNode.connect(this._dryNode);this._ringNode.connect(this._wetNode)}Release(){this._oscNode.stop(0);
this._oscNode.disconnect();this._ringNode.disconnect();this._inputNode.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/100,1),0);this._params[1]=b;this.SetAudioParam(this._wetNode.gain,b,e,k);this.SetAudioParam(this._dryNode.gain,1-b,e,k);break;case 7:this._params[0]=
b,this.SetAudioParam(this._oscNode.frequency,b,e,k)}}};self.C3AudioDistortionFX=class extends d{constructor(a,b,e,k,w,y){super(a);this._type="distortion";this._params=[b,e,k,w,y];this._inputNode=this.CreateGain();this._preGain=this.CreateGain();this._postGain=this.CreateGain();this._SetDrive(k,w);this._wetNode=this.CreateGain();this._wetNode.gain.value=y;this._dryNode=this.CreateGain();this._dryNode.gain.value=1-y;this._waveShaper=this._audioContext.createWaveShaper();this._curve=new Float32Array(65536);
this._GenerateColortouchCurve(b,e);this._waveShaper.curve=this._curve;this._inputNode.connect(this._preGain);this._inputNode.connect(this._dryNode);this._preGain.connect(this._waveShaper);this._waveShaper.connect(this._postGain);this._postGain.connect(this._wetNode)}Release(){this._inputNode.disconnect();this._preGain.disconnect();this._waveShaper.disconnect();this._postGain.disconnect();this._wetNode.disconnect();this._dryNode.disconnect();super.Release()}_SetDrive(a,b){.01>a&&(a=.01);this._preGain.gain.value=
a;this._postGain.gain.value=Math.pow(1/a,.6)*b}_GenerateColortouchCurve(a,b){for(let e=0;32768>e;++e){let k=e/32768;k=this._Shape(k,a,b);this._curve[32768+e]=k;this._curve[32768-e-1]=-k}}_Shape(a,b,e){e=1.05*e*b-b;const k=0>a?-1:1;a=0>a?-a:a;return(a<b?a:b+e*self.AudioDOMHandler.e4(a-b,1/e))*k}ConnectTo(a){this._wetNode.disconnect();this._wetNode.connect(a);this._dryNode.disconnect();this._dryNode.connect(a)}GetInputNode(){return this._inputNode}SetParam(a,b,e,k){switch(a){case 0:b=Math.max(Math.min(b/
100,1),0),this._params[4]=b,this.SetAudioParam(this._wetNode.gain,b,e,k),this.SetAudioParam(this._dryNode.gain,1-b,e,k)}}};self.C3AudioCompressorFX=class extends d{constructor(a,b,e,k,w,y){super(a);this._type="compressor";this._params=[b,e,k,w,y];this._node=this._audioContext.createDynamicsCompressor();this._node.threshold.value=b;this._node.knee.value=e;this._node.ratio.value=k;this._node.attack.value=w;this._node.release.value=y}Release(){this._node.disconnect();super.Release()}ConnectTo(a){this._node.disconnect();
this._node.connect(a)}GetInputNode(){return this._node}SetParam(a,b,e,k){}};self.C3AudioAnalyserFX=class extends d{constructor(a,b,e){super(a);this._type="analyser";this._params=[b,e];this._node=this._audioContext.createAnalyser();this._node.fftSize=b;this._node.smoothingTimeConstant=e;this._freqBins=new Float32Array(this._node.frequencyBinCount);this._signal=new Uint8Array(b);this._rms=this._peak=0;this._audioDomHandler._AddAnalyser(this)}Release(){this._audioDomHandler._RemoveAnalyser(this);this._node.disconnect();
super.Release()}Tick(){this._node.getFloatFrequencyData(this._freqBins);this._node.getByteTimeDomainData(this._signal);const a=this._node.fftSize;let b=this._peak=0;for(var e=0;e<a;++e){let k=(this._signal[e]-128)/128;0>k&&(k=-k);this._peak<k&&(this._peak=k);b+=k*k}e=self.AudioDOMHandler.LinearToDb;this._peak=e(this._peak);this._rms=e(Math.sqrt(b/a))}ConnectTo(a){this._node.disconnect();this._node.connect(a)}GetInputNode(){return this._node}SetParam(a,b,e,k){}GetData(){return{tag:this.GetTag(),index:this.GetIndex(),
peak:this._peak,rms:this._rms,binCount:this._node.frequencyBinCount,freqBins:this._freqBins}}}}"use strict";
{function d(a){a.stopPropagation()}self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMElementHandler{constructor(a){super(a,"list");this.AddDOMElementMessageHandler("set-selected-index",(b,e)=>this._OnSetSelectedIndex(b,e.selectedIndex));this.AddDOMElementMessageHandler("add-item",(b,e)=>this._OnAddItem(b,e));this.AddDOMElementMessageHandler("remove-item",(b,e)=>this._OnRemoveItem(b,e));this.AddDOMElementMessageHandler("set-item",(b,e)=>this._OnSetItem(b,e));this.AddDOMElementMessageHandler("clear",
b=>this._OnClear(b));this.AddDOMElementMessageHandler("load-state",(b,e)=>this._OnLoadState(b,e))}CreateElement(a,b){const e=b.isDropdown,k=b.isMultiSelect,w=b.items,y=document.createElement("select");y.style.position="absolute";y.style.userSelect="none";y.style.webkitUserSelect="none";y.multiple=k;e||(y.size=2);for(const h of w)y.add(this._CreateOption(h));y.addEventListener("touchstart",d);y.addEventListener("touchmove",d);y.addEventListener("touchend",d);y.addEventListener("mousedown",d);y.addEventListener("mouseup",
d);y.addEventListener("click",h=>{h.stopPropagation();this._PostToRuntimeElementMaybeSync("click",a,this._GetSelectionState(y))});y.addEventListener("dblclick",h=>{h.stopPropagation();this._PostToRuntimeElementMaybeSync("dblclick",a,this._GetSelectionState(y))});y.addEventListener("change",()=>this.PostToRuntimeElement("change",a,this._GetSelectionState(y)));b.id&&(y.id=b.id);this.UpdateState(y,b);return y}_CreateOption(a){const b=document.createElement("option");b.text=a;return b}_GetSelectionState(a){const b=
a.selectedIndex,e=[];for(let k=0,w=a.length;k<w;++k)a.options[k].selected&&e.push(k);return{selectedIndex:b,selectedIndices:e}}UpdateState(a,b){a.title=b.title;a.disabled=!b.isEnabled;a.multiple=!!b.isMultiSelect}_OnSetSelectedIndex(a,b){a.selectedIndex=b}_OnAddItem(a,b){const e=b.index;b=this._CreateOption(b.text);0>e?a.add(b):a.add(b,e)}_OnRemoveItem(a,b){a.remove(b.index)}_OnSetItem(a,b){a.options[b.index].text=b.text}_OnClear(a){a.innerHTML=""}_OnLoadState(a,b){a.innerHTML="";for(const e of b.items)a.add(this._CreateOption(e));
a.selectedIndex=b.selectedIndex;for(const e of b.selectedIndices)if(b=a.options[e])b.selected=!0}})}"use strict";
{function d(){const a=self.RealFile||self.File;return"function"===typeof navigator.canShare&&navigator.canShare({files:[new a(["test file"],"test.txt",{})]})}self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(a){super(a,"share");a=!!this._GetSharePlugin();this._isSupported=(this._isWebShareSupported="function"===typeof navigator.share)||a;this._isFilesSupported=(this._isWebShareFilesSupported=d())||a;this.AddRuntimeMessageHandlers([["init",b=>this._OnInit(b)],["share",
b=>this._OnShare(b)],["request-rate",b=>this._OnRateApp(b)],["request-store",b=>this._OnShowStore(b)]])}_OnInit(){return{isSupported:this._isSupported,isFilesSupported:this._isFilesSupported}}_GetSharePlugin(){return window.plugins&&window.plugins.socialsharing}_GetRatePlugin(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.RateApp}async _OnShare(a){var b=a.text;const e=a.title,k=a.url;a=a.files.slice(0);const w=0<a.length,y=this._GetSharePlugin();if(y){const m={};b&&(m.message=
b);e&&(m.subject=e);k&&(m.url=k);if(w){b=0;for(var h of a)b+=h.size;try{const c=await this._CordovaGetTempDirEntry(Math.floor(1.25*b));m.files=await Promise.all(a.map(f=>this._CordovaWriteTempFile(f,c)))}catch(c){console.log("[Share plugin] Share failed: ",c);this.PostToRuntime("share-failed");return}}y.shareWithOptions(m,()=>{this.PostToRuntime("share-completed")},c=>{console.log("[Share plugin] Share failed: ",c);this.PostToRuntime("share-failed")})}else{h={};b&&(h.text=b);e&&(h.title=e);k&&(h.url=
k);w&&(h.files=a);try{await navigator.share(h),this.PostToRuntime("share-completed")}catch(m){console.log("[Share plugin] Share failed: ",m),this.PostToRuntime("share-failed")}}}_OnRateApp(a){const b=a.body,e=a.confirm,k=a.cancel;a=a.appID;const w=this._GetRatePlugin();w&&w.Rate(b,e,k,a)}_OnShowStore(a){a=a.appID;const b=this._GetRatePlugin();b&&b.Store(a)}_CordovaGetTempDirEntry(a){return new Promise((b,e)=>{window.requestFileSystem(window.TEMPORARY,a,k=>b(k.root),e)})}_CordovaWriteTempFile(a,b){return new Promise((e,
k)=>{b.getFile(a.name,{create:!0,exclusive:!1},w=>{const y=w.toURL();w.createWriter(h=>{h.onwriteend=()=>e(y);h.onerror=k;h.write(a)})},k)})}})}"use strict";
self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(d){super(d,"googleplay");this.AddRuntimeMessageHandlers([["load",([a])=>this._Load(a)],["signin",()=>this._SignIn()],["signout",()=>this._SignOut()],["getplayer",()=>this._RequestPlayerDetails()],["submitscore",a=>this._SubmitScore(a)],["requestscores",a=>this._RequestHiScores(a)],["requestachievements",a=>this._RequestAchievements(a)],["requestmetadata",a=>this._RequestAchievementMetaData(a)],["reveal",a=>this._RevealAchievement(a)],
["unlock",a=>this._UnlockAchievement(a)],["increment",a=>this._IncrementAchievement(a)],["setsteps",a=>this._SetSteps(a)],["showleaderboard",a=>this._ShowLeaderboard(a)],["showachievements",a=>this._ShowAchievements(a)]]);this._playinterface=null;this._isLoaded=this._isSignedIn=!1}async _RequestPlayerDetails(){if(!this._isSignedIn)return null;const d={id:"",display:"",avatar:"",givenName:"",familyName:""};let a;a=window.cordova?await this._CallNativeAPIMethod("getPlayerData"):await this._CallWebAPIMethod("players/me");
d.id=a.playerId||"";d.display=a.displayName||"";d.avatar=a.avatarImageUrl||"";a.name&&(d.givenName=a.name.givenName||"",d.familyName=a.name.familyName||"");return d}_SignIn(){if(!this._isLoaded||this._isSignedIn)return null;this.playInterface?this.playInterface.signin():self.gapi.auth.signIn({callback:window.googlePlaySigninCallback})}_SignOut(){if(!this._isSignedIn)return null;this.playInterface?this.playInterface.signout():self.gapi.auth.signOut()}_SubmitScore(d){return this._isSignedIn?this.playInterface?
this._CallNativeAPIMethod("submitScore",d):this._CallWebAPIMethod(`leaderboards/${d.leaderboardId}/scores`,d,"post"):null}async _RequestHiScores(d){if(!this._isSignedIn)return null;const a={page:[],total:0,best:0,formattedbest:"",besttag:"",rank:0,formattedrank:""};d=this.playInterface?await this._CallNativeAPIMethod("getHiScores",d):await this._CallWebAPIMethod(`leaderboards/${d.leaderboardId}/${d.type}/${d.collection}`,d);a.total=parseInt(d.numScores,10)||0;d.playerScore&&(a.best=parseInt(d.playerScore.scoreValue,
10)||0,a.formattedbest=d.playerScore.formattedScore||"",a.besttag=d.playerScore.scoreTag||"",a.rank=parseInt(d.playerScore.scoreRank,10)||0,a.formattedrank=d.playerScore.formattedScoreRank||"");a.page=d.items;return a}async _RequestAchievements(d){const a=d.which;if(!this._isSignedIn)return null;if(this.playInterface){d=await this._CallNativeAPIMethod("getAchievements",d);const b=new Map,e=d.items;for(const k of d.items)b.set(k.id,{name:k.name,description:k.description,type:k.achievementType,totalSteps:k.totalSteps,
revealedUrl:k.revealedIconUrl,unlockedUrl:k.unlockedIconUrl});return{page:e.filter(k=>k.state===a),id:b}}return{page:(await this._CallWebAPIMethod("players/me/achievements",d)).items.filter(b=>b.state===a),id:null}}async _RequestAchievementMetaData(d){d=d.reload;if(!this._isSignedIn)return null;if(this.playInterface)return this._RequestAchievements({which:"ALL",reload:d});{d=await this._CallWebAPIMethod("achievements");const a=new Map;for(const b of d.items)a.set(b.id,{name:b.name,description:b.description,
type:b.achievementType,totalSteps:b.totalSteps,revealedUrl:b.revealedIconUrl,unlockedUrl:b.unlockedIconUrl});return{page:null,id:a}}}async _RevealAchievement(d){d=d.id;if(!this._isSignedIn)return null;this.playInterface?await this._CallNativeAPIMethod("revealAchievement",{achievementId:d}):await this._CallWebAPIMethod(`achievements/${d}/reveal`,null,"post");return!0}async _UnlockAchievement(d){d=d.id;if(!this._isSignedIn)return null;this.playInterface?await this._CallNativeAPIMethod("unlockAchievement",
{achievementId:d}):await this._CallWebAPIMethod(`achievements/${d}/unlock`,null,"post");return!0}async _IncrementAchievement(d){const a=d.id;d=d.steps;if(!this._isSignedIn)return null;this.playInterface?await this._CallNativeAPIMethod("incrementAchievement",{achievementId:a,numSteps:d}):await this._CallWebAPIMethod(`achievements/${a}/increment`,{stepsToIncrement:d},"post");return!0}async _SetSteps(d){const a=d.id;d=d.steps;if(!this._isSignedIn)return null;this.playInterface?await this._CallNativeAPIMethod("setStepsAchievement",
{achievementId:a,numSteps:d}):await this._CallWebAPIMethod(`achievements/${a}/setStepsAtLeast`,{steps:d},"post");return!0}_ShowLeaderboard(d){d=d.id;if(!this._isSignedIn)return null;if(this.playInterface)return null!=d?this._CallNativeAPIMethod("showLeaderboard",{leaderboardId:d}):this._CallNativeAPIMethod("showLeaderboards");throw Error("not available");}_ShowAchievements(){if(!this._isSignedIn)return null;if(this.playInterface)return this._CallNativeAPIMethod("showAchievements");throw Error("not available");
}_CallWebAPIMethod(d,a,b="get"){return new Promise((e,k)=>{self.gapi.client.request({path:"/games/v1/"+d,method:b,params:a,callback:function(w){let y=w?w.error:"no_response";y?("object"===typeof y?y="string"===typeof y.message?y.message:"unknown":"string"!==typeof y&&(y="unknown"),k(y)):e(w)}})})}_CallNativeAPIMethod(d,a={}){return new Promise((b,e)=>{this.playInterface[d](a,(k,w)=>{k?e(k):b(w)})})}_Load(d){return new Promise((a,b)=>{const e=(k,w)=>{this._isSignedIn=w;this.PostToRuntime("login",{state:w,
error:k})};window.cordova?this._LoadCordovaAPI(a,b,e):this._LoadWebAPI(d,a,b,e)})}_LoadWebAPI(d,a,b,e){const k=(w,y)=>{const h=document.createElement("meta");h.setAttribute("name","google-signin-"+w);h.setAttribute("content",y);document.head.appendChild(h)};window.googlePlayLoadCallback=(...w)=>{this._isLoaded=!0;a(...w)};window.googlePlaySigninCallback=w=>{w.status&&w.status.signed_in?e("",!0):e(w.error+"",!1)};k("clientid",d);k("cookiepolicy","single_host_origin");k("callback","googlePlaySigninCallback");
k("scope","https://www.googleapis.com/auth/games");d=document.createElement("script");d.setAttribute("type","text/javascript");d.setAttribute("async","");d.setAttribute("src","https://apis.google.com/js/client.js?onload=googlePlayLoadCallback");d.addEventListener("error",()=>b("failed to load script"));document.head.appendChild(d)}_LoadCordovaAPI(d,a,b){const e=window.cordova.plugins.ConstructPlayGames;if(e)this.playInterface=e,d(),this._isLoaded=!0;else return a();e.setCallback(b);e.silentSignIn()}});
"use strict";
{const d={};let a=null,b=null;const e={banner:"ca-app-pub-3940256099942544/2934735716",interstitial:"ca-app-pub-3940256099942544/4411468910",rewarded:"ca-app-pub-3940256099942544/1712485313",rewardedInterstitial:"ca-app-pub-3940256099942544/6978759866"};let k=!1;function w(m,c){m(c,null)}function y(m,c){d[m]=c;self.admob.configRequest(d)}async function h(){if("android"===self.cordova.platformId)return self.C3AdUtilsMD5(self.device.uuid).toUpperCase();if("ios"===self.cordova.platformId){const m=await self.cordova.plugins.idfa.getInfo();
if(!m.trackingLimited)return k=!0,self.C3AdUtilsMD5(m.idfa).toUpperCase()}}self.C3AdUtils={Success:function(m,c){m(null,c)},Failure:w,StartAdmobPlus:async function(m,c){c="undefined"!==typeof c?c:a.debug;return b?b:b=new Promise((f,t)=>{document.addEventListener("deviceready",async()=>{try{const z=setTimeout(()=>{f(!1);w(m,"failure to initialize")},2E3);await self.admob.start();clearTimeout(z);if(c){const g=await h();y("testDeviceIds",[g])}f(!0)}catch(z){f(!1),w(m,"Initialization failure")}})})},
UpdateAdmobPlusRequest:y,SetInitConfigureOptions:function(m,c,f,t,z,g,l){a||(a={id:m,pubID:c,privacyPolicy:f,showFree:t,showConsent:z,debug:g,debugLocation:l},Object.freeze(a))},HasInitConfigurationOptions:function(){return!!a},GetAdUnit:function(m,c){if("android"===self.cordova.platformId)return m;if("ios"===self.cordova.platformId){const f=!!e[c];return a.debug&&!k&&f?(console.log("[C3 advert]","USING TEST AD UNITS"),e[c]):m}},get ConfigurationOptions(){return a},get TestId(){return h()}}}"use strict";
{const d=self.C3AdUtils,a=d.Success,b=d.Failure,e={get LOAD(){return self.admob.Events.bannerLoad},get LOAD_FAIL(){return self.admob.Events.bannerLoadFail}};class k{constructor(y,h,m,c){if(!y)return b(c,"Unit ID not specified");if(!h)return b(c,"Ad size not specified");if(!m)return b(c,"Ad position not specified");this._adUnitId=y;this._position=m;this._size="";switch(h){case "portrait":this._size=5;break;case "landscape":this._size=5;break;case "standard":this._size=0;break;case "large":this._size=
1;break;case "medium":this._size=2;break;case "full":this._size=3;break;case "leaderboard":this._size=4;break;default:this._size=5}this._ad=null;this._adShowing=this._adLoading=!1}Load(y,h){if(this._ad)return a(h,"banner ad loaded");w.call(this,h);y={adUnitId:d.GetAdUnit(this._adUnitId,"banner"),size:this._size,position:this._position,offset:0,npa:"NON_PERSONALIZED"===y?"1":"0"};this._ad=new self.admob.BannerAd(y);this._ad.load()}async Show(y){if(!this._ad)return b(y,"banner ad not created");if(this._adLoading)return b(y,
"banner ad still loading");if(this._adShowing)return a(y,"banner ad already shown");await this._ad.show();this._adShowing=!0;a(y,"banner shown")}async Hide(y){if(!this._ad)return b(y,"banner ad not created");if(this._adLoading)return b(y,"banner ad still loading");if(!this._adShowing)return a(y,"banner ad not being shown");await this._ad.hide();this._adShowing=!1;a(y,"banner ad hidden")}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}function w(y){const h=c=>{this._adLoading=
!1;a(y,"banner ad loaded");document.removeEventListener(e.LOAD,h);document.removeEventListener(e.LOAD_FAIL,m)},m=c=>{this._ad=null;this._adLoading=!1;b(y,"banner ad failed to load");document.removeEventListener(e.LOAD,h);document.removeEventListener(e.LOAD_FAIL,m)};document.addEventListener(e.LOAD,h);document.addEventListener(e.LOAD_FAIL,m)}self.C3BannerAd=k}"use strict";
{const d=self.C3AdUtils,a=d.Success,b=d.Failure,e={get LOAD(){return self.admob.Events.interstitialLoad},get LOAD_FAIL(){return self.admob.Events.interstitialLoadFail},get SHOW(){return self.admob.Events.interstitialShow},get SHOW_FAIL(){return self.admob.Events.interstitialShowFail},get DISMISS(){return self.admob.Events.interstitialDismiss}};class k{constructor(h,m){if(!h)return b(m,"Unit ID not specified");this._adUnitId=h;this._ad=null;this._loadSuccess=this._adShowing=this._adLoading=!1;this._loadPromiseResolver=
null;this._loadPromise=this.GetLoadPromise();document.addEventListener(e.DISMISS,async c=>{this._adShowing=!1;this._adLoading=!0;this._loadSuccess=!1;this._loadPromise=null;this._loadPromise=this.GetLoadPromise();w.call(this);await this._ad.load()})}GetLoadPromise(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise(h=>{this._loadPromiseResolver=h})}ResolveLoadPromise(h){this._loadSuccess=h;this._loadPromiseResolver&&this._loadPromiseResolver(h);this._loadPromiseResolver=this._loadPromise=
null;this._loadPromise=this.GetLoadPromise()}Load(h,m){h={adUnitId:d.GetAdUnit(this._adUnitId,"interstitial"),npa:"NON_PERSONALIZED"===h?"1":"0"};this._adLoading=!0;this._loadSuccess=this._adShowing=!1;this._loadPromise=null;this._loadPromise=this.GetLoadPromise();this._ad=new self.admob.InterstitialAd(h);w.call(this,m);this._ad.load()}async Show(h){if(!this._ad)return b(h,"interstitial ad not created");if(this._adShowing)return a(h,"interstitial ad already shown");this._adLoading&&await this.GetLoadPromise();
await (async()=>{this._loadSuccess?(y.call(this,h),await this._ad.show()):(w.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad.load(),await this.GetLoadPromise(),this._loadSuccess?(y.call(this,h),await this._ad.show()):b(h,"interstitial ad failed to load"))})()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}function w(h){const m=f=>{this._adLoading=!1;this.ResolveLoadPromise(!0);h&&a(h,"interstitial ad load");document.removeEventListener(e.LOAD,m);document.removeEventListener(e.LOAD_FAIL,
c)},c=f=>{this._adLoading=!1;this.ResolveLoadPromise(!1);h&&b(h,"interstitial ad failed to load");document.removeEventListener(e.LOAD,m);document.removeEventListener(e.LOAD_FAIL,c)};document.addEventListener(e.LOAD,m);document.addEventListener(e.LOAD_FAIL,c)}function y(h){const m=f=>{this._adShowing=!0;h&&a(h,"interstitial ad show");document.removeEventListener(e.SHOW,m);document.removeEventListener(e.SHOW_FAIL,c)},c=f=>{this._adShowing=!1;h&&b(h,"interstitial ad failed to show");document.removeEventListener(e.SHOW,
m);document.removeEventListener(e.SHOW_FAIL,c)};document.addEventListener(e.SHOW,m);document.addEventListener(e.SHOW_FAIL,c)}self.C3InterstitialAd=k}"use strict";
{const d=self.C3AdUtils,a=d.Success,b=d.Failure,e={get LOAD(){return self.admob.Events.rewardedLoad},get LOAD_FAIL(){return self.admob.Events.rewardedLoadFail},get SHOW(){return self.admob.Events.rewardedShow},get SHOW_FAIL(){return self.admob.Events.rewardedShowFail},get DISMISS(){return self.admob.Events.rewardedDismiss},get REWARD(){return self.admob.Events.rewardedReward}};class k{constructor(h,m){if(!h)return b(m,"Unit ID not specified");this._adUnitId=h;this._ad=null;this._loadSuccess=this._adShowing=
this._adLoading=!1;this._loadPromiseResolver=null;this._loadPromise=this.GetLoadPromise();this._reward=null}GetLoadPromise(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise(h=>{this._loadPromiseResolver=h})}ResolveLoadPromise(h){this._loadSuccess=h;this._loadPromiseResolver&&this._loadPromiseResolver(h);this._loadPromiseResolver=this._loadPromise=null;this._loadPromise=this.GetLoadPromise()}Load(h,m){h={adUnitId:d.GetAdUnit(this._adUnitId,"rewarded"),npa:"NON_PERSONALIZED"===
h?"1":"0"};this._adLoading=!0;this._loadSuccess=this._adShowing=!1;this._loadPromise=null;this._loadPromise=this.GetLoadPromise();this._ad=new self.admob.RewardedAd(h);w.call(this,m);this._ad.load()}async Show(h){if(!this._ad)return b(h,"rewarded ad not created");if(this._adShowing)return a(h,"rewarded ad already shown");this._adLoading&&await this.GetLoadPromise();await (async()=>{this._loadSuccess?(y.call(this,h),await this._ad.show()):(w.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad.load(),
await this.GetLoadPromise(),this._loadSuccess?(y.call(this,h),await this._ad.show()):b(h,"rewarded ad failed to load"))})()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}function w(h){const m=f=>{this._adLoading=!1;this.ResolveLoadPromise(!0);h&&a(h,"rewarded ad load");document.removeEventListener(e.LOAD,m);document.removeEventListener(e.LOAD_FAIL,c)},c=f=>{this._adLoading=!1;this.ResolveLoadPromise(!1);h&&b(h,"rewarded ad failed to load");document.removeEventListener(e.LOAD,
m);document.removeEventListener(e.LOAD_FAIL,c)};document.addEventListener(e.LOAD,m);document.addEventListener(e.LOAD_FAIL,c)}function y(h){const m=z=>{this._adShowing=!0},c=z=>{this._reward=z.reward},f=z=>{this._adShowing=!1;h&&b(h,"rewarded ad failed to show");document.removeEventListener(e.SHOW,m);document.removeEventListener(e.SHOW_FAIL,f);document.removeEventListener(e.REWARD,c);document.removeEventListener(e.DISMISS,t)},t=z=>{if(null!==this._reward){z=String(this._reward.type);const g=String(this._reward.amount);
h&&a(h,JSON.stringify([z,g]))}else h&&b(h,"closed with no reward");this._reward=null;this._adShowing=!1;this._adLoading=!0;this._loadSuccess=!1;this._loadPromise=null;this._loadPromise=this.GetLoadPromise();w.call(this);this._ad.load();document.removeEventListener(e.SHOW,m);document.removeEventListener(e.SHOW_FAIL,f);document.removeEventListener(e.REWARD,c);document.removeEventListener(e.DISMISS,t)};document.addEventListener(e.SHOW,m);document.addEventListener(e.SHOW_FAIL,f);document.addEventListener(e.REWARD,
c);document.addEventListener(e.DISMISS,t)}self.C3RewardedAd=k}"use strict";
{const d=self.C3AdUtils,a=d.Success,b=d.Failure,e={get LOAD(){return self.admob.Events.rewardedInterstitialLoad},get LOAD_FAIL(){return self.admob.Events.rewardedInterstitialLoadFail},get SHOW(){return self.admob.Events.rewardedInterstitialShow},get SHOW_FAIL(){return self.admob.Events.rewardedInterstitialShowFail},get DISMISS(){return self.admob.Events.rewardedInterstitialDismiss},get REWARD(){return self.admob.Events.rewardedInterstitialReward}};class k{constructor(h,m){if(!h)return b(m,"Unit ID not specified");
this._adUnitId=h;this._ad=null;this._loadSuccess=this._adShowing=this._adLoading=!1;this._loadPromiseResolver=null;this._loadPromise=this.GetLoadPromise();this._reward=null}GetLoadPromise(){return this._loadPromise?this._loadPromise:this._loadPromise=new Promise(h=>{this._loadPromiseResolver=h})}ResolveLoadPromise(h){this._loadSuccess=h;this._loadPromiseResolver&&this._loadPromiseResolver(h);this._loadPromiseResolver=this._loadPromise=null;this._loadPromise=this.GetLoadPromise()}Load(h,m){h={adUnitId:d.GetAdUnit(this._adUnitId,
"rewardedInterstitial"),npa:"NON_PERSONALIZED"===h?"1":"0"};this._adLoading=!0;this._loadSuccess=this._adShowing=!1;this._loadPromise=null;this._loadPromise=this.GetLoadPromise();this._ad=new self.admob.RewardedInterstitialAd(h);w.call(this,m);this._ad.load()}async Show(h){if(!this._ad)return b(h,"rewarded interstitial ad not created");if(this._adShowing)return a(h,"rewarded interstitial ad already shown");this._adLoading&&await this.GetLoadPromise();await (async()=>{this._loadSuccess?(y.call(this,
h),await this._ad.show()):(w.call(this),this._loadSuccess=!1,this._loadPromise=null,this._ad.load(),await this.GetLoadPromise(),this._loadSuccess?(y.call(this,h),await this._ad.show()):b(h,"rewarded interstitial ad failed to load"))})()}IsLoading(){return this._adLoading}IsShowing(){return this._adShowing}}function w(h){const m=f=>{this._adLoading=!1;this.ResolveLoadPromise(!0);h&&a(h,"rewarded interstitial ad load");document.removeEventListener(e.LOAD,m);document.removeEventListener(e.LOAD_FAIL,
c)},c=f=>{this._adLoading=!1;this.ResolveLoadPromise(!1);h&&b(h,"rewarded interstitial ad failed to load");document.removeEventListener(e.LOAD,m);document.removeEventListener(e.LOAD_FAIL,c)};document.addEventListener(e.LOAD,m);document.addEventListener(e.LOAD_FAIL,c)}function y(h){const m=z=>{this._adShowing=!0},c=z=>{this._reward=z.reward},f=z=>{this._adShowing=!1;h&&b(h,"rewarded interstitial ad failed to show");document.removeEventListener(e.SHOW,m);document.removeEventListener(e.SHOW_FAIL,f);
document.removeEventListener(e.REWARD,c);document.removeEventListener(e.DISMISS,t)},t=z=>{if(null!==this._reward){z=String(this._reward.type);const g=String(this._reward.amount);h&&a(h,JSON.stringify([z,g]))}else h&&b(h,"closed with no reward");this._reward=null;this._adShowing=!1;this._adLoading=!0;this._loadSuccess=!1;this._loadPromise=null;this._loadPromise=this.GetLoadPromise();w.call(this);this._ad.load();document.removeEventListener(e.SHOW,m);document.removeEventListener(e.SHOW_FAIL,f);document.removeEventListener(e.REWARD,
c);document.removeEventListener(e.DISMISS,t)};document.addEventListener(e.SHOW,m);document.addEventListener(e.SHOW_FAIL,f);document.addEventListener(e.REWARD,c);document.addEventListener(e.DISMISS,t)}self.C3RewardedInterstitialAd=k}"use strict";
{const d=self.C3AdUtils,a=d.Success,b=d.Failure,e=self.cordova?"ios"===self.cordova.platformId:!1,k=self.cordova?"android"===self.cordova.platformId:!1;class w{constructor(){this._adPersonalization="UNKNOWN";this._inEEAorUnknown="";this._consentStatusIndex=0;this._consentStatusString="UNKNOWN";this._trackingStatusString="not-determined";this._hasConsentForm=!1}async Reset(){d.ConfigurationOptions.debug&&await self.consent.reset()}GetAdPersonalization(){return this._adPersonalization}async RequestTrackingAuthorization(){e&&
await self.admob.requestTrackingAuthorization()}async GetTrackingAuthorizationStatus(){if(k)return this._trackingStatusString="not-determined";const g=self.cordova.plugins.idfa,l=await g.getInfo();if(!l.trackingLimited)return this._trackingStatusString="authorized";switch(l.trackingPermission){case g.TRACKING_PERMISSION_NOT_DETERMINED:return this._trackingStatusString="not-determined";case g.TRACKING_PERMISSION_RESTRICTED:return this._trackingStatusString="denied";case g.TRACKING_PERMISSION_DENIED:return this._trackingStatusString=
"denied";case g.TRACKING_PERMISSION_AUTHORIZED:return this._trackingStatusString="authorized"}}async RequestIDFA(g){if(k)return a(g,"not-determined");if(e)return await f.call(this),"true"===this._inEEAorUnknown?await this.RequestTrackingAuthorization():(await this.GetTrackingAuthorizationStatus(),"not-determined"===this._trackingStatusString&&(await y.call(this),this._hasConsentForm?await this.ShowIDFAMessage():await this.RequestTrackingAuthorization())),await this.GetTrackingAuthorizationStatus(),
a(g,this._trackingStatusString)}async RequestInfoUpdateForTesting(g,l,p){return await z.call(this,g,l,u=>{u?"object"===typeof u?b(p,u.message):b(p,u):b(p,"requestInfoUpdate error")})}async RequestInfoUpdateForTestingSkipErrors(g,l,p){await z.call(this,g,l)}async ShowConsentForm(g,l=!1){await h.call(this);switch(g){case "eu":l=await y.call(this);m.call(this)&&l&&await (await self.consent.loadForm()).show();break;case "always":{g=await y.call(this);const p=await f.call(this);g&&"true"===p?await (await self.consent.loadForm()).show():
g&&l&&await (await self.consent.loadForm()).show()}}await h.call(this);await f.call(this);await c.call(this)}async ShowIDFAMessage(g){await this.ShowConsentForm("always",!0)}async UpdateConsentStatus(){await h.call(this);await f.call(this);await c.call(this)}async SuccessResponse(g){await this.GetTrackingAuthorizationStatus();a(g,`${this._consentStatusString}&&${this._trackingStatusString}&&${this._inEEAorUnknown}`)}async FailureResponse(g,l){b(g,l)}async StatusUpdateSuccessResponse(g){await this.UpdateConsentStatus();
await this.GetTrackingAuthorizationStatus();a(g,`${this._consentStatusString}&&${this._trackingStatusString}&&${this._inEEAorUnknown}`)}}async function y(){return this._hasConsentForm=await self.consent.getFormStatus()===self.consent.FormStatus.Available}async function h(){this._consentStatusIndex=await self.consent.getConsentStatus();switch(this._consentStatusIndex){case 1:return this._consentStatusString="REQUIRED";case 2:return this._consentStatusString="NOT_REQUIRED";case 3:return this._consentStatusString=
"OBTAINED";case 0:return this._consentStatusString="UNKNOWN"}}function m(){switch(this._consentStatusIndex){case 1:return!0;case 2:return!1;case 3:return!1;case 0:return!0}}function c(){switch(this._consentStatusIndex){case 1:return this._adPersonalization="NON_PERSONALIZED";case 2:return this._adPersonalization="PERSONALIZED";case 3:return this._adPersonalization="PERSONALIZED";case 0:return this._adPersonalization="NON_PERSONALIZED"}}async function f(){if(k)switch(this._consentStatusIndex){case 1:return this._inEEAorUnknown=
"true";case 2:return this._inEEAorUnknown="false";case 3:return this._inEEAorUnknown="true";case 0:return this._inEEAorUnknown="true"}if(e)return await t.call(this,"IABTCF_gdprApplies","getInt")?this._inEEAorUnknown="true":this._inEEAorUnknown="false"}async function t(g,l){return new Promise((p,u)=>{self.NativeStorage[l](g,x=>p(x),x=>p(1))})}async function z(g,l,p){let u="",x=null;if(g){switch(l){case "EEA":u=self.consent.DebugGeography.EEA;break;case "NOT_EEA":u=self.consent.DebugGeography.NotEEA;
break;default:u=self.consent.DebugGeography.Disabled}x=[await d.TestId]}try{return g?await self.consent.requestInfoUpdate({debugGeography:u,testDeviceIds:x}):await self.consent.requestInfoUpdate(),!0}catch(B){return p&&p(B),!1}}self.C3Consent=new w}"use strict";
{const d=(g,l)=>{let p=g[0],u=g[1],x=g[2],B=g[3];p=b(p,u,x,B,l[0],7,-680876936);B=b(B,p,u,x,l[1],12,-389564586);x=b(x,B,p,u,l[2],17,606105819);u=b(u,x,B,p,l[3],22,-1044525330);p=b(p,u,x,B,l[4],7,-176418897);B=b(B,p,u,x,l[5],12,1200080426);x=b(x,B,p,u,l[6],17,-1473231341);u=b(u,x,B,p,l[7],22,-45705983);p=b(p,u,x,B,l[8],7,1770035416);B=b(B,p,u,x,l[9],12,-1958414417);x=b(x,B,p,u,l[10],17,-42063);u=b(u,x,B,p,l[11],22,-1990404162);p=b(p,u,x,B,l[12],7,1804603682);B=b(B,p,u,x,l[13],12,-40341101);x=b(x,B,
p,u,l[14],17,-1502002290);u=b(u,x,B,p,l[15],22,1236535329);p=e(p,u,x,B,l[1],5,-165796510);B=e(B,p,u,x,l[6],9,-1069501632);x=e(x,B,p,u,l[11],14,643717713);u=e(u,x,B,p,l[0],20,-373897302);p=e(p,u,x,B,l[5],5,-701558691);B=e(B,p,u,x,l[10],9,38016083);x=e(x,B,p,u,l[15],14,-660478335);u=e(u,x,B,p,l[4],20,-405537848);p=e(p,u,x,B,l[9],5,568446438);B=e(B,p,u,x,l[14],9,-1019803690);x=e(x,B,p,u,l[3],14,-187363961);u=e(u,x,B,p,l[8],20,1163531501);p=e(p,u,x,B,l[13],5,-1444681467);B=e(B,p,u,x,l[2],9,-51403784);
x=e(x,B,p,u,l[7],14,1735328473);u=e(u,x,B,p,l[12],20,-1926607734);p=k(p,u,x,B,l[5],4,-378558);B=k(B,p,u,x,l[8],11,-2022574463);x=k(x,B,p,u,l[11],16,1839030562);u=k(u,x,B,p,l[14],23,-35309556);p=k(p,u,x,B,l[1],4,-1530992060);B=k(B,p,u,x,l[4],11,1272893353);x=k(x,B,p,u,l[7],16,-155497632);u=k(u,x,B,p,l[10],23,-1094730640);p=k(p,u,x,B,l[13],4,681279174);B=k(B,p,u,x,l[0],11,-358537222);x=k(x,B,p,u,l[3],16,-722521979);u=k(u,x,B,p,l[6],23,76029189);p=k(p,u,x,B,l[9],4,-640364487);B=k(B,p,u,x,l[12],11,-421815835);
x=k(x,B,p,u,l[15],16,530742520);u=k(u,x,B,p,l[2],23,-995338651);p=w(p,u,x,B,l[0],6,-198630844);B=w(B,p,u,x,l[7],10,1126891415);x=w(x,B,p,u,l[14],15,-1416354905);u=w(u,x,B,p,l[5],21,-57434055);p=w(p,u,x,B,l[12],6,1700485571);B=w(B,p,u,x,l[3],10,-1894986606);x=w(x,B,p,u,l[10],15,-1051523);u=w(u,x,B,p,l[1],21,-2054922799);p=w(p,u,x,B,l[8],6,1873313359);B=w(B,p,u,x,l[15],10,-30611744);x=w(x,B,p,u,l[6],15,-1560198380);u=w(u,x,B,p,l[13],21,1309151649);p=w(p,u,x,B,l[4],6,-145523070);B=w(B,p,u,x,l[11],10,
-1120210379);x=w(x,B,p,u,l[2],15,718787259);u=w(u,x,B,p,l[9],21,-343485551);g[0]=z(p,g[0]);g[1]=z(u,g[1]);g[2]=z(x,g[2]);g[3]=z(B,g[3])},a=(g,l,p,u,x,B)=>{l=z(z(l,g),z(u,B));return z(l<<x|l>>>32-x,p)},b=(g,l,p,u,x,B,G)=>a(l&p|~l&u,g,l,x,B,G),e=(g,l,p,u,x,B,G)=>a(l&u|p&~u,g,l,x,B,G),k=(g,l,p,u,x,B,G)=>a(l^p^u,g,l,x,B,G),w=(g,l,p,u,x,B,G)=>a(p^(l|~u),g,l,x,B,G),y=g=>{const l=g.length,p=[1732584193,-271733879,-1732584194,271733878];let u;for(u=64;u<=g.length;u+=64)d(p,h(g.substring(u-64,u)));g=g.substring(u-
64);const x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(u=0;u<g.length;u++)x[u>>2]|=g.charCodeAt(u)<<(u%4<<3);x[u>>2]|=128<<(u%4<<3);if(55<u)for(d(p,x),u=0;16>u;u++)x[u]=0;x[14]=8*l;d(p,x);return p},h=g=>{const l=[];for(let p=0;64>p;p+=4)l[p>>2]=g.charCodeAt(p)+(g.charCodeAt(p+1)<<8)+(g.charCodeAt(p+2)<<16)+(g.charCodeAt(p+3)<<24);return l},m="0123456789abcdef".split(""),c=g=>{let l="";for(let p=0;4>p;p++)l+=m[g>>8*p+4&15]+m[g>>8*p&15];return l},f=g=>{for(let l=0;l<g.length;l++)g[l]=c(g[l]);return g.join("")},
t=g=>f(y(g));let z=(g,l)=>g+l&4294967295;t("hello");self.C3AdUtilsMD5=t}"use strict";
{const d=self.C3AdUtils,a=self.C3Consent,b=self.C3BannerAd,e=self.C3InterstitialAd,k=self.C3RewardedAd,w=self.C3RewardedInterstitialAd;let y=null,h=null,m=null,c=null,f=null;const t={},z=(g,l)=>{t[g]=l};z("CreateBannerAdvert",async(g,l,p,u,x)=>{await d.StartAdmobPlus(x,p)&&(p=await a.GetAdPersonalization(),y||(y=new b(g,l,u,x)),y.Load(p,x))});z("ShowBannerAdvert",async g=>{if(!y)return d.Failure(g,"banner ad not created");y.Show(g)});z("HideBannerAdvert",async g=>{if(!y)return d.Failure(g,"banner ad not created");
y.Hide(g)});z("CreateInterstitialAdvert",async(g,l,p)=>{if(h)return d.Success(p,"interstitial ad already created");await d.StartAdmobPlus(p,l)&&(l=await a.GetAdPersonalization(),h=new e(g,p),h.Load(l,p))});z("ShowInterstitialAdvert",async g=>{if(!h)return d.Failure(g,"interstitial ad not created");h.Show(g)});z("CreateVideoAdvert",async(g,l,p)=>{if(m||c)return d.Success(p,"video ad already created");await d.StartAdmobPlus(p,l)&&(l=await a.GetAdPersonalization(),m=new k(g,p),m.Load(l,p))});z("ShowVideoAdvert",
async g=>{if(!m)return d.Failure(g,"video ad not created");m.Show(g)});z("CreateRewardedAdvert",async(g,l,p)=>{if(c||m)return d.Success(p,"rewarded ad already created");await d.StartAdmobPlus(p,l)&&(l=await a.GetAdPersonalization(),c=new k(g,p),c.Load(l,p))});z("ShowRewardedAdvert",async g=>{if(!c)return d.Failure(g,"rewarded ad not created");c.Show(g)});z("CreateRewardedInterstitialAdvert",async(g,l,p)=>{if(f)return d.Success(p,"rewarded interstitial ad already created");await d.StartAdmobPlus(p,
l)&&(l=await a.GetAdPersonalization(),f=new w(g,p),f.Load(l,p))});z("ShowRewardedInterstitialAdvert",async g=>{if(!f)return d.Failure(g,"rewarded interstitial ad not created");f.Show(g)});z("Configure",async(g,l,p,u,x,B,G,q,r)=>{const n=!d.HasInitConfigurationOptions();d.SetInitConfigureOptions(g,l,p,u,x,B,G);if(!await d.StartAdmobPlus(r,B))return a.FailureResponse(r,"failure to initialize");n&&await a.Reset();if(!await a.RequestInfoUpdateForTesting(B,G,r))return a.FailureResponse(r,"failure to update consent information");
n?q?await a.ShowConsentForm("eu"):await a.UpdateConsentStatus():await a.ShowConsentForm("always");await a.SuccessResponse(r)});z("RequestConsent",async g=>{t.Configure(d.ConfigurationOptions.id,d.ConfigurationOptions.pubID,d.ConfigurationOptions.privacyPolicy,d.ConfigurationOptions.showFree,"always",d.ConfigurationOptions.debug,d.ConfigurationOptions.debugLocation,!1,g)});z("SetMaxAdContentRating",async(g,l)=>{if(await d.StartAdmobPlus(l)){if(!g)return d.Failure(l,"Label not specified");try{d.UpdateAdmobPlusRequest("maxAdContentRating",
g),d.Success(l,"")}catch(p){d.Failure(l,"invalid label")}}});z("TagForChildDirectedTreatment",async(g,l)=>{if(await d.StartAdmobPlus(l))try{d.UpdateAdmobPlusRequest("tagForChildDirectedTreatment",1===g?!0:!1),d.Success(l,"")}catch(p){d.Failure(l,"invalid label")}});z("TagForUnderAgeOfConsent",async(g,l)=>{if(await d.StartAdmobPlus(l))try{d.UpdateAdmobPlusRequest("tagForUnderAgeOfConsent",1===g?!0:!1),d.Success(l,"")}catch(p){d.Failure(l,"invalid label")}});z("RequestIDFA",async g=>{await d.StartAdmobPlus(g)&&
a.RequestIDFA(g)});z("StatusUpdate",async(g,l,p)=>{if(!await d.StartAdmobPlus(p,g))return a.FailureResponse(p,"failure to initialize");await a.RequestInfoUpdateForTestingSkipErrors(g,l,p);await a.StatusUpdateSuccessResponse(p)});self.C3MobileAdvertsAPI||(self.C3MobileAdvertsAPI={});self.C3MobileAdvertsAPI.real=t}"use strict";
{const d={},a=(c,f)=>d[c]=f,b=c=>new Promise(f=>setTimeout(f,c));let e=null,k=null,w=null,y=null,h=null;function m(c,f){const t=f.slice(0,-1);f=f[f.length-1];console.log(c,t);return[t,f]}a("CreateBannerAdvert",async(...c)=>{[,c]=m("CreateBannerAdvert",c);await b(50);e?c("Banner already exists"):(e="ready",c(null,"Created banner"))});a("ShowBannerAdvert",async(...c)=>{[,c]=m("ShowBannerAdvert",c);await b(50);"ready"!=e?c("Banner cannot be shown"):(e="shown",c(null,"Showed banner"))});a("HideBannerAdvert",
async(...c)=>{[,c]=m("HideBannerAdvert",c);await b(50);"shown"!=e?c("Banner cannot be hidden"):(e=null,c(null,"Hid banner"))});a("CreateInterstitialAdvert",async(...c)=>{[,c]=m("CreateInterstitialAdvert",c);await b(50);k?c("Intersitial already exists"):(k="ready",c(null,"Created interstitial"))});a("ShowInterstitialAdvert",async(...c)=>{[,c]=m("ShowInterstitialAdvert",c);await b(50);"ready"!=k?c("Cannot show interstitial"):(k=null,c(null,"Interstitial shown"))});a("CreateVideoAdvert",async(...c)=>
{[,c]=m("CreateVideoAdvert",c);await b(50);w?c("Video already exists"):(w="ready",c(null,"Created video"))});a("ShowVideoAdvert",async(...c)=>{[,c]=m("ShowVideoAdvert",c);await b(50);"ready"!=w?c("Cannot show video"):(w=null,c(null,'["example type", 20]'))});a("CreateRewardedAdvert",async(...c)=>{[,c]=m("CreateRewardedAdvert",c);await b(50);y?c("Rewarded already exists"):(y="ready",c(null,"Created rewarded"))});a("ShowRewardedAdvert",async(...c)=>{[,c]=m("ShowRewardedAdvert",c);await b(50);"ready"!=
y?c("Cannot show rewarded"):(y=null,c(null,'["example type", 20]'))});a("CreateRewardedInterstitialAdvert",async(...c)=>{[,c]=m("CreateRewardedInterstitialAdvert",c);await b(50);h?c("Rewarded intersitial already exists"):(h="ready",c(null,"Created rewarded interstitial"))});a("ShowRewardedInterstitialAdvert",async(...c)=>{[,c]=m("ShowRewardedInterstitialAdvert",c);await b(50);"ready"!=h?c("Cannot show rewarded interstitial"):(h=null,c(null,"Rewarded interstitial shown"))});a("Configure",async(...c)=>
{[,c]=m("Configure",c);await b(50);c(null,"PERSONALIZED&&true")});a("RequestConsent",async(...c)=>{[,c]=m("RequestConsent",c);await b(50);c(null,"PERSONALIZED&&true")});a("RequestIDFA",async(...c)=>{[,c]=m("RequestIDFA",c);await b(50);c(null,"authorized")});self.C3MobileAdvertsAPI||(self.C3MobileAdvertsAPI={});self.C3MobileAdvertsAPI.fake=d}"use strict";
{const d=self.C3AdUtils,a={},b=(m,c)=>{a[m]=c};let e=!1,k=null;const w=async m=>{if(!a.webAdsScriptLoaded)return d.Failure(m,"advert script not loaded, likely blocked by an ad blocker"),!1;e||(self.adsbygoogle=self.adsbygoogle||[],self.adBreak=self.adConfig=c=>self.adsbygoogle.push(c),e=!0);return k?k:k=new Promise((c,f)=>{self.adConfig({preloadAdBreaks:"on",onReady:()=>c(!0)})})},y=m=>{a.domSideHandler.GetRuntimeInterface().PostToRuntimeComponent("runtime","visibilitychange",{hidden:!0})},h=m=>{a.domSideHandler.GetRuntimeInterface().PostToRuntimeComponent("runtime",
"visibilitychange",{hidden:!1})};b("CreateBannerAdvert",async(m,c,f,t,z)=>{d.Failure(z,"banner ads not supported in web platform")});b("ShowBannerAdvert",async m=>{d.Failure(m,"banner ads not supported in web platform")});b("HideBannerAdvert",async m=>{d.Failure(m,"banner ads not supported in web platform")});b("CreateInterstitialAdvert",async(m,c,f)=>{await w(f)&&d.Success(f,"interstitial ad created")});b("ShowInterstitialAdvert",async m=>{await w(m)&&self.adBreak({type:"next",beforeAd:()=>y(),afterAd:()=>
h(),adBreakDone:c=>{switch(c.breakStatus){case "viewed":case "dismissed":d.Success(m,"interstitial ad show");break;default:console.table(c),d.Failure(m,"interstitial ad failed to show")}}})});b("CreateVideoAdvert",async(m,c,f)=>{d.Failure(f,"video ads are deprecated")});b("ShowVideoAdvert",async m=>{d.Failure(m,"video ads are deprecated")});b("CreateRewardedAdvert",async(m,c,f)=>{await w(f)&&d.Success(f,"rewarded ad created")});b("ShowRewardedAdvert",async m=>{await w(m)&&self.adBreak({type:"reward",
beforeAd:()=>y(),afterAd:()=>h(),adBreakDone:c=>{switch(c.breakStatus){case "viewed":case "dismissed":d.Success(m,"rewarded ad show");break;case "ignored":d.Failure(m,"rewarded ad ignored");break;default:console.table(c),d.Failure(m,"rewarded ad failed to show")}},beforeReward:c=>{c()},adDismissed:()=>{d.Failure(m,"closed with no reward")},adViewed:()=>{d.Success(m,JSON.stringify(["Reward",1]))}})});b("CreateRewardedInterstitialAdvert",async(m,c,f)=>{await w(f)&&d.Success(f,"rewarded interstitial ad created")});
b("ShowRewardedInterstitialAdvert",async m=>{await w(m)&&self.adBreak({type:"reward",beforeAd:()=>y(),afterAd:()=>h(),adBreakDone:c=>{switch(c.breakStatus){case "viewed":case "dismissed":d.Success(m,"rewarded interstitial ad show");break;case "ignored":d.Failure(m,"rewarded interstitial ad ignored");break;default:console.table(c),d.Failure(m,"rewarded interstitial ad failed to show")}},beforeReward:c=>{c()},adDismissed:()=>{d.Failure(m,"closed with no reward")},adViewed:()=>{d.Success(m,JSON.stringify(["Reward",
1]))}})});b("Configure",async(m,c,f,t,z,g,l,p,u)=>{a.webAdsScriptLoaded?d.Success(u,"UNKNOWN&&not-determined&&true"):d.Failure(u,"advert script not loaded, likely blocked by an ad blocker")});b("RequestConsent",async m=>{d.Success(m,"UNKNOWN&&not-determined&&true")});b("SetMaxAdContentRating",async(m,c)=>{d.Failure(c,"setting max ad content rating not supported in web platform")});b("TagForChildDirectedTreatment",async(m,c)=>{d.Failure(c,"tagging for children not supported in web platform")});b("TagForUnderAgeOfConsent",
async(m,c)=>{d.Failure(c,"tagging for under age of consent not supported in web platform")});b("RequestIDFA",async m=>{d.Success(m,"not-determined")});b("StatusUpdate",async(m,c,f)=>{d.Success(f,"UNKNOWN&&not-determined&&true")});self.C3MobileAdvertsAPI||(self.C3MobileAdvertsAPI={});self.C3MobileAdvertsAPI.web=a}"use strict";
{let d=!1;self.RuntimeInterface.AddDOMHandlerClass(class extends self.DOMHandler{constructor(a){super(a,"advert");a=b=>[b,e=>this._CallMethod(b,e)];this.AddRuntimeMessageHandlers([a("CreateBannerAdvert"),a("ShowBannerAdvert"),a("HideBannerAdvert"),a("CreateInterstitialAdvert"),a("ShowInterstitialAdvert"),a("CreateVideoAdvert"),a("ShowVideoAdvert"),a("CreateRewardedAdvert"),a("ShowRewardedAdvert"),a("CreateRewardedInterstitialAdvert"),a("ShowRewardedInterstitialAdvert"),a("Configure"),a("RequestConsent"),
a("SetUserPersonalisation"),a("SetMaxAdContentRating"),a("TagForChildDirectedTreatment"),a("TagForUnderAgeOfConsent"),a("RequestIDFA"),a("StatusUpdate"),(b=>[b,e=>this._AddScript(e[0],e[1])])("AddScript")])}_GetApi(){if(self.cordova)return self.C3MobileAdvertsAPI.real;if(!self.cordova)return self.C3MobileAdvertsAPI.web}async _CallMethod(a,b){const e=this._GetApi();e.domSideHandler||(e.domSideHandler=this);if(!e)throw d||(d=!0,console.warn("The Mobile Advert plugin is not loaded. Please note that it only works in Android or iOS exports")),
Error("advert plugin not loaded");return new Promise((k,w)=>{(0,e[a])(...b,(y,h)=>{y?w(y):k(h)})})}async _AddScript(a,b=null){const e=this._GetApi();e.webAdsScriptLoaded=!1;return new Promise((k,w)=>{w=document.createElement("script");if(b)for(let y in b)w.setAttribute(y,b[y]);w.onload=function(){e.webAdsScriptLoaded=!0;k()};w.onerror=function(y){e.webAdsScriptLoaded=!1;k()};w.src=a;document.head.appendChild(w)})}})};
